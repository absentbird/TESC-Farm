import{V as R,a as z,_ as L,f as b}from"./VSwitch-Cv7wEqZu.js";import{V as H,a as J}from"./VTextField-7-p8-azj.js";import{g as A,f as $}from"./VDivider-odZKMi8a.js";import{d as C,r,i as S,w as F,j as q,k as I,l as k,F as T,c as p,t as y,q as c,s as h,y as w,z as V,A as W,J as G,v as E,b as K,U as P,o as Q}from"./index-Dr_Z-5RT.js";import{a as N}from"./VGrid-i-kZP7zF.js";import{a as x}from"./apicall-RBbVqa6h.js";import"./VMenu-KK7wNQFQ.js";const X=C({__name:"FilterSearch",props:{items:{type:Array,required:!0},focus:{type:Array,required:!1}},emits:["filter"],setup(g,{emit:_}){const s=r(""),i=r(!1),o=r([]),f=g,v=_,m=S(()=>{const a=new Set;for(const e of f.items)for(const t of e.tags)a.add(t.name);return Array.from(a)}),n=S(()=>{let a=f.items;return f.focus&&!i.value?(a=a.filter(e=>f.focus.includes(e.ID)),a.sort((e,t)=>f.focus.indexOf(e.ID)-f.focus.indexOf(t.ID))):a.sort((e,t)=>e.name.localeCompare(t.name)),o.value.length>0&&(a=a.filter(e=>e.tags.some(t=>o.value.includes(t.name)))),s.value&&(a=a.filter(e=>(e.name+e.description).toUpperCase().includes(s.value.toUpperCase()))),a});return F(n,(a,e)=>{e!=a&&v("filter",n.value)}),q(()=>{v("filter",n.value)}),(a,e)=>(k(),I(T,null,[p(A,{cols:"12",sm:"6",md:"8"},{default:y(()=>[p(H,{id:"search",modelValue:c(s),"onUpdate:modelValue":e[0]||(e[0]=t=>h(s)?s.value=t:null),clearable:"",label:"Search",hint:"Search for items by name or description"},null,8,["modelValue"])]),_:1}),p(A,{cols:"6",sm:"3",md:"2"},{default:y(()=>[p(R,{clearable:"",chips:"",multiple:"",label:"Tags",modelValue:c(o),"onUpdate:modelValue":e[1]||(e[1]=t=>h(o)?o.value=t:null),items:c(m)},null,8,["modelValue","items"])]),_:1}),p(A,{cols:"6",sm:"3",md:"2",class:"d-flex align-self-start"},{default:y(()=>[g.focus?(k(),w(z,{key:0,inset:"",label:"Show All",color:"secondary",modelValue:c(i),"onUpdate:modelValue":e[2]||(e[2]=t=>h(i)?i.value=t:null)},null,8,["modelValue"])):V("",!0)]),_:1})],64))}}),Y=C({__name:"TaskSelector",props:{tasks:{type:Array,required:!0},focus:{type:Array,required:!1},search:{type:Boolean,required:!1}},emits:["select"],setup(g,{emit:_}){const s=g,i=r(s.tasks),o=r(s.tasks),f=S(()=>{if(o.value.length==0)return-1;const m=Array.from(o.value).find(n=>n.selected);return m?m.ID:0});F(s,()=>{i.value=s.tasks,s.search||(o.value=s.tasks)});const v=m=>{o.value=m};return(m,n)=>{const a=X,e=L;return k(),w(J,{fluid:"",class:"taskpanel d-flex flex-column align-center"},{default:y(()=>[g.search?(k(),w($,{key:0,id:"filters",class:"align-center d-flex w-100 flex-grow-0"},{default:y(()=>[p(a,{items:c(i),focus:g.focus,onFilter:v},null,8,["items","focus"])]),_:1})):V("",!0),p($,{id:"main-content",align:"center",justify:"center",class:"d-flex flex-row w-100"},{default:y(()=>[(k(!0),I(T,null,W(c(o),t=>(k(),w(e,{task:t,onSelect:D=>m.$emit("select",t.ID)},null,8,["task","onSelect"]))),256)),p(A,{cols:"12"},{default:y(()=>[p(N,{class:G(["bigbutton",{selected:c(f)==0}]),variant:"tonal",onClick:n[0]||(n[0]=t=>m.$emit("select",0))},{default:y(()=>n[1]||(n[1]=[E(" Not Tracking Time ")])),_:1},8,["class"])]),_:1})]),_:1})]),_:1})}}}),re=C({__name:"mobile",setup(g){const _=r(Array.from(b));K();const s=r(!1),i=r(0),o=r(""),f=r(""),v=r(Array()),m=r(Array()),n=r(Array()),a=r(0),e=async()=>{s.value=!0;const d=Array.from(await x("/hours/working")),u=[];v.value.forEach(l=>{u[l.ID]=0}),d.forEach(l=>{u[l.task_id]++,l.worker.barcode==o.value&&(i.value=l.task_id)}),v.value.forEach(l=>{l.working=u[l.ID],l.selected=l.ID==i.value}),t(),s.value=!1},t=()=>{m.value=v.value.filter(d=>d.tags.some(u=>u.name=="Management Unit"))},D=async()=>{s.value=!0,v.value=Array.from(await x("/tasks")),e(),s.value=!1},O=async()=>{const d=await x("/worker/lookup",{barcode:f.value});o.value=d.barcode},j=async d=>{let u=v.value.filter(l=>b.includes(l.ID));u.sort((l,U)=>b.indexOf(l.ID)-b.indexOf(U.ID)),a.value=d,n.value=u},M=async d=>{i.value!=d&&(i.value=d,await x("/hours/punch",{anum:f,task:d}),e())};P(()=>{O(),D()});let B;return q(()=>{f.value=localStorage.getItem("anumber"),B=setInterval(e,6e4)}),Q(()=>{clearInterval(B)}),(d,u)=>{const l=Y;return k(),I(T,null,[c(a)?V("",!0):(k(),w(l,{key:0,tasks:c(m),onSelect:j},null,8,["tasks"])),c(a)?(k(),w(N,{key:1,onClick:u[0]||(u[0]=U=>a.value=0),variant:"tonal",class:"ml-7"},{default:y(()=>u[1]||(u[1]=[E("Back to Areas")])),_:1})):V("",!0),c(a)?(k(),w(l,{key:2,search:"",tasks:c(n),focus:c(_),onSelect:M},null,8,["tasks","focus"])):V("",!0)],64)}}});export{re as default};
