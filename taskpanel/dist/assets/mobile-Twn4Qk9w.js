import{u as fe,c as $,m as me,d as ve,f as ge,e as z,g as M,h as K,V as pe,a as Ve,_ as ke,b as be}from"./VSwitch-Ev9pgo0P.js";import{g as he,p as we,D as ye,f as d,k as oe,I as xe,E as q,A as Ce,a as Se,G as U,c as t,H as Ee,d as Ae,C as Te,i as B,j as Ie,b as P,o as y,w as l,q as s,n as C,x,y as Pe,t as D,l as De,F as O,s as F,v as Oe,z as Le,J as Ne}from"./index-Otowk1Gi.js";import{f as Ue,V as G,a as Be}from"./VTextField-DjNowcNy.js";import{a as Fe,V as S,b as Q}from"./VBtn-BjHShccG.js";import{c as je,b as X,d as Y,e as Z,f as _e,g as ee,V as te,a as A}from"./VRow-Dd4OLhoh.js";import"./ssrBoot-BpBvHDye.js";import"./tag-CG2zx-Ob.js";const ae=je("v-spacer","div","VSpacer"),Re=we({fullscreen:Boolean,retainFocus:{type:Boolean,default:!0},scrollable:Boolean,...me({origin:"center center",scrollStrategy:"block",transition:{component:ve},zIndex:2400})},"VDialog"),le=he()({name:"VDialog",props:Re(),emits:{"update:modelValue":u=>!0,afterEnter:()=>!0,afterLeave:()=>!0},setup(u,L){let{emit:V,slots:v}=L;const w=ye(u,"modelValue"),{scopeId:E}=fe(),i=d();function b(n){var h,p;const g=n.relatedTarget,m=n.target;if(g!==m&&((h=i.value)!=null&&h.contentEl)&&((p=i.value)!=null&&p.globalTop)&&![document,i.value.contentEl].includes(m)&&!i.value.contentEl.contains(m)){const f=Ee(i.value.contentEl);if(!f.length)return;const k=f[0],N=f[f.length-1];g===k?N.focus():k.focus()}}oe(()=>{document.removeEventListener("focusin",b)}),xe&&q(()=>w.value&&u.retainFocus,n=>{n?document.addEventListener("focusin",b):document.removeEventListener("focusin",b)},{immediate:!0});function r(){var n;V("afterEnter"),(n=i.value)!=null&&n.contentEl&&!i.value.contentEl.contains(document.activeElement)&&i.value.contentEl.focus({preventScroll:!0})}function I(){V("afterLeave")}return q(w,async n=>{var g;n||(await Ce(),(g=i.value.activatorEl)==null||g.focus({preventScroll:!0}))}),Se(()=>{const n=$.filterProps(u),g=U({"aria-haspopup":"dialog"},u.activatorProps),m=U({tabindex:-1},u.contentProps);return t($,U({ref:i,class:["v-dialog",{"v-dialog--fullscreen":u.fullscreen,"v-dialog--scrollable":u.scrollable},u.class],style:u.style},n,{modelValue:w.value,"onUpdate:modelValue":h=>w.value=h,"aria-modal":"true",activatorProps:g,contentProps:m,height:u.fullscreen?void 0:u.height,width:u.fullscreen?void 0:u.width,maxHeight:u.fullscreen?void 0:u.maxHeight,maxWidth:u.fullscreen?void 0:u.maxWidth,role:"dialog",onAfterEnter:r,onAfterLeave:I},E),{activator:v.activator,default:function(){for(var h=arguments.length,p=new Array(h),f=0;f<h;f++)p[f]=arguments[f];return t(Fe,{root:"VDialog"},{default:()=>{var k;return[(k=v.default)==null?void 0:k.call(v,...p)]}})}})}),Ue({},i)}}),qe=Ae({__name:"mobile",setup(u){const L=Te(),V=d(!1),v=d(!1),w=d(!1),E=d(!1),i=d([]),b=d(""),r=d(""),I=d(""),n=d(0),g=d("mdi-form-textbox"),m=d(!1),h=d("error"),p=d(""),f=d({}),k=d({}),N=async()=>{const a=await fetch("https://api.tesc.farm/logout",{credentials:"include"});a.ok?Ne.push("/login"):(p.value=a.statusText,m.value=!0)},ne=async()=>{const a=await fetch("https://api.tesc.farm/hours/punchoutall",{credentials:"include"});a.ok||(p.value=a.statusText,m.value=!0),T(),v.value=!1,n.value=0},se=d([{title:"Edit A#",action:()=>{V.value=!0},users:["worker","admin"]},{title:"Stop Tracking All",action:()=>{v.value=!0},users:["admin"]},{title:"Logout",action:N,users:["worker","admin"]}]),j=B(()=>{const a=L.meta.userstatus;return se.value.filter(e=>e.users.includes(a))}),ue=B(()=>{const a=new Set;for(const e of Array.from(f.value))for(const c of e.tags)a.add(c.name);return Array.from(a)}),re=B(()=>{let a=Array.from(f.value);return E.value||(a=a.filter(e=>ge.includes(e.ID))),i.value.length>0&&(a=a.filter(e=>e.tags.some(c=>i.value.includes(c.name)))),b.value&&(a=a.filter(e=>(e.name+e.description).toUpperCase().includes(b.value.toUpperCase()))),a}),_=a=>{n.value!=a&&(n.value=a,n.value>0?ce(n.value):de())},ie=async()=>{w.value=!0;try{const a=await fetch("https://api.tesc.farm/tasks");a.ok||console.log(a.status),f.value=await a.json(),f.value.forEach(e=>{k.value[e.ID]=0})}catch(a){console.log(a)}finally{T()}},T=async()=>{w.value=!0;try{const a=await fetch("https://api.tesc.farm/hours/working");a.ok||console.log(a.status),f.value.forEach(c=>{k.value[c.ID]=0}),(await a.json()).forEach(c=>{k.value[c.task_id]++,c.worker.barcode==I.value&&(n.value=c.task_id)})}catch(a){console.log(a)}finally{w.value=!1}},R=()=>{r.value!=""&&(localStorage.setItem("anumber",r.value),V.value=!1,H())},W=()=>{r.value.length==9&&r.value[0]=="A"&&!isNaN(Number(r.value.substring(1)))?g.value="mdi-check-circle":g.value="mdi-form-textbox"},ce=async a=>{const e={barcode:r.value,task:a},c=await fetch("https://api.tesc.farm/hours/punch",{method:"POST",credentials:"include",body:JSON.stringify(e)});c.ok||(p.value=c.statusText,m.value=!0,console.log(c)),T()},de=async()=>{const a={barcode:r.value},e=await fetch("https://api.tesc.farm/hours/punch",{method:"POST",credentials:"include",body:JSON.stringify(a)});e.ok||(p.value=e.statusText,m.value=!0,console.log(e)),T()},H=async()=>{const a={barcode:r.value},e=await fetch("https://api.tesc.farm/worker/lookup",{method:"POST",credentials:"include",body:JSON.stringify(a)});e.ok||console.log(e);const c=await e.json();I.value=c.barcode};let J;return Ie(()=>{r.value=localStorage.getItem("anumber"),r.value?(W(),H()):V.value=!0,ie(),J=setInterval(T,6e4)}),oe(()=>{clearInterval(J)}),(a,e)=>{const c=ke;return y(),P(O,null,[t(Be,{fluid:"",id:"taskpanel",class:"fill-height d-flex flex-column"},{default:l(()=>[t(le,{modelValue:s(V),"onUpdate:modelValue":e[2]||(e[2]=o=>C(V)?V.value=o:null),persistent:!s(r)},{default:l(()=>[t(X,{class:"ma-auto w-100","max-width":"400","prepend-icon":"mdi-settings"},{default:l(()=>[t(Y,null,{default:l(()=>e[10]||(e[10]=[x("Edit A#")])),_:1}),t(Z,null,{default:l(()=>e[11]||(e[11]=[x("Set your A# to track tasks")])),_:1}),t(_e,null,{default:l(()=>[t(G,{id:"anum",ref:"anum","prepend-icon":s(g),modelValue:s(r),"onUpdate:modelValue":e[0]||(e[0]=o=>C(r)?r.value=o:null),onInput:W,onKeyup:Pe(R,["enter"]),hint:"Enter the A# from your student ID",label:"A#"},null,8,["prepend-icon","modelValue"])]),_:1}),t(ee,null,{default:l(()=>[s(r)?(y(),D(S,{key:0,class:"ms-auto",text:"Close",onClick:e[1]||(e[1]=o=>V.value=!1)})):De("",!0),t(ae),t(S,{class:"ms-auto",text:"Save",onClick:R})]),_:1})]),_:1})]),_:1},8,["modelValue","persistent"]),t(le,{modelValue:s(v),"onUpdate:modelValue":e[4]||(e[4]=o=>C(v)?v.value=o:null)},{default:l(()=>[t(X,{class:"ma-auto w-100","max-width":"400","prepend-icon":"mdi-settings"},{default:l(()=>[t(Y,null,{default:l(()=>e[12]||(e[12]=[x("Punch Out All Active Workers?")])),_:1}),t(Z,null,{default:l(()=>e[13]||(e[13]=[x("Are you Sure?")])),_:1}),t(ee,null,{default:l(()=>[t(S,{class:"ms-auto",text:"Cancel",onClick:e[3]||(e[3]=o=>v.value=!1)}),t(ae),t(S,{class:"ms-auto",text:"Confirm",onClick:ne})]),_:1})]),_:1})]),_:1},8,["modelValue"]),t(te,{id:"filters",class:"align-self-start d-flex w-100 flex-grow-0"},{default:l(()=>[t(A,{cols:"9",sm:"4",md:"7"},{default:l(()=>[t(G,{id:"search",modelValue:s(b),"onUpdate:modelValue":e[5]||(e[5]=o=>C(b)?b.value=o:null),clearable:"",label:"Search",hint:"Search for tasks by name or description"},null,8,["modelValue"])]),_:1}),t(A,{cols:"3",class:"mt-2 d-flex d-sm-none"},{default:l(()=>[t(S,{variant:"tonal"},{default:l(()=>[t(Q,null,{default:l(()=>e[14]||(e[14]=[x("mdi-cog")])),_:1}),t(z,{activator:"parent"},{default:l(()=>[t(M,null,{default:l(()=>[(y(!0),P(O,null,F(s(j),o=>(y(),D(K,{title:o.title,onClick:o.action},null,8,["title","onClick"]))),256))]),_:1})]),_:1})]),_:1})]),_:1}),t(A,{cols:"6",sm:"3",md:"2"},{default:l(()=>[t(pe,{clearable:"",chips:"",multiple:"",label:"Tags",modelValue:s(i),"onUpdate:modelValue":e[6]||(e[6]=o=>C(i)?i.value=o:null),items:s(ue)},null,8,["modelValue","items"])]),_:1}),t(A,{cols:"6",sm:"3",md:"2",class:"d-flex align-self-start"},{default:l(()=>[t(Ve,{label:"Show All",inset:"",color:"secondary",modelValue:s(E),"onUpdate:modelValue":e[7]||(e[7]=o=>C(E)?E.value=o:null)},null,8,["modelValue"])]),_:1}),t(A,{cols:"1",class:"mt-2 d-none d-sm-flex"},{default:l(()=>[t(S,{variant:"tonal"},{default:l(()=>[t(Q,null,{default:l(()=>e[15]||(e[15]=[x("mdi-cog")])),_:1}),t(z,{activator:"parent"},{default:l(()=>[t(M,null,{default:l(()=>[(y(!0),P(O,null,F(s(j),o=>(y(),D(K,{title:o.title,onClick:o.action},null,8,["title","onClick"]))),256))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(te,{id:"main-content",align:"center",justify:"center",class:"d-flex flex-row w-100"},{default:l(()=>[(y(!0),P(O,null,F(s(re),o=>(y(),D(c,{task:o,anumber:s(r),working:s(k)[o.ID],selected:s(n)==o.ID,onSelect:_},null,8,["task","anumber","working","selected"]))),256)),t(A,{cols:"12"},{default:l(()=>[t(S,{class:Oe(["bigbutton",{selected:s(n)==0}]),variant:"tonal",onClick:e[8]||(e[8]=o=>_(0))},{default:l(()=>e[16]||(e[16]=[x(" Not Tracking Time ")])),_:1},8,["class"])]),_:1})]),_:1})]),_:1}),t(be,{modelValue:s(m),"onUpdate:modelValue":e[9]||(e[9]=o=>C(m)?m.value=o:null),timeout:"2000",location:"top",color:s(h)},{default:l(()=>[x(Le(s(p)),1)]),_:1},8,["modelValue","color"])],64)}}});export{qe as default};
