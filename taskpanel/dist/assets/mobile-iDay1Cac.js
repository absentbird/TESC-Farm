import{V as j,a as M,_ as R,f as V}from"./VSwitch-CQ80koh1.js";import{V as z,a as L}from"./VTextField-_HiXIyNs.js";import{g as b,f as B}from"./VDivider-DWiRGwIx.js";import{d as I,r,i as S,w as F,j as $,k as T,l as k,F as C,c as v,t as y,q as m,s as A,y as _,z as x,A as H,J,v as W,b as G,U as K,o as P}from"./index-BPadVx_3.js";import{a as Q}from"./VGrid-pi-9tooK.js";import{a as h}from"./apicall-B_5ENNFL.js";import"./VMenu-BIEtxcDn.js";const X=I({__name:"FilterSearch",props:{items:{type:Array,required:!0},focus:{type:Array,required:!1}},emits:["filter"],setup(g,{emit:w}){const s=r(""),u=r(!1),o=r([]),c=g,d=w,i=S(()=>{const a=new Set;for(const e of c.items)for(const t of e.tags)a.add(t.name);return Array.from(a)}),n=S(()=>{let a=c.items;return c.focus&&!u.value?(a=a.filter(e=>c.focus.includes(e.ID)),a.sort((e,t)=>c.focus.indexOf(e.ID)-c.focus.indexOf(t.ID))):a.sort((e,t)=>e.name.localeCompare(t.name)),o.value.length>0&&(a=a.filter(e=>e.tags.some(t=>o.value.includes(t.name)))),s.value&&(a=a.filter(e=>(e.name+e.description).toUpperCase().includes(s.value.toUpperCase()))),a});return F(n,(a,e)=>{e!=a&&d("filter",n.value)}),$(()=>{d("filter",n.value)}),(a,e)=>(k(),T(C,null,[v(b,{cols:"12",sm:"6",md:"8"},{default:y(()=>[v(z,{id:"search",modelValue:m(s),"onUpdate:modelValue":e[0]||(e[0]=t=>A(s)?s.value=t:null),clearable:"",label:"Search",hint:"Search for items by name or description"},null,8,["modelValue"])]),_:1}),v(b,{cols:"6",sm:"3",md:"2"},{default:y(()=>[v(j,{clearable:"",chips:"",multiple:"",label:"Tags",modelValue:m(o),"onUpdate:modelValue":e[1]||(e[1]=t=>A(o)?o.value=t:null),items:m(i)},null,8,["modelValue","items"])]),_:1}),v(b,{cols:"6",sm:"3",md:"2",class:"d-flex align-self-start"},{default:y(()=>[g.focus?(k(),_(M,{key:0,inset:"",label:"Show All",color:"secondary",modelValue:m(u),"onUpdate:modelValue":e[2]||(e[2]=t=>A(u)?u.value=t:null)},null,8,["modelValue"])):x("",!0)]),_:1})],64))}}),Y=I({__name:"TaskSelector",props:{tasks:{type:Array,required:!0},focus:{type:Array,required:!1},search:{type:Boolean,required:!1}},emits:["select"],setup(g,{emit:w}){const s=g,u=r(s.tasks),o=r(s.tasks),c=S(()=>{if(o.value.length==0)return-1;const i=Array.from(o.value).find(n=>n.selected);return i?i.ID:0});F(s,()=>{u.value=s.tasks,s.search||(o.value=s.tasks)});const d=i=>{o.value=i};return(i,n)=>{const a=X,e=R;return k(),_(L,{fluid:"",class:"taskpanel d-flex flex-column align-center"},{default:y(()=>[g.search?(k(),_(B,{key:0,id:"filters",class:"align-center d-flex w-100 flex-grow-0"},{default:y(()=>[v(a,{items:m(u),focus:g.focus,onFilter:d},null,8,["items","focus"])]),_:1})):x("",!0),v(B,{id:"main-content",align:"center",justify:"center",class:"d-flex flex-row w-100"},{default:y(()=>[(k(!0),T(C,null,H(m(o),t=>(k(),_(e,{task:t,onSelect:D=>i.$emit("select",t.ID)},null,8,["task","onSelect"]))),256)),v(b,{cols:"12"},{default:y(()=>[v(Q,{class:J(["bigbutton",{selected:m(c)==0}]),variant:"tonal",onClick:n[0]||(n[0]=t=>i.$emit("select",0))},{default:y(()=>n[1]||(n[1]=[W(" Not Tracking Time ")])),_:1},8,["class"])]),_:1})]),_:1})]),_:1})}}}),re=I({__name:"mobile",setup(g){const w=r(Array.from(V));G();const s=r(!1),u=r(0),o=r(""),c=r(""),d=r(Array()),i=r(Array()),n=r(Array()),a=r(0),e=async()=>{s.value=!0;const f=Array.from(await h("/hours/working")),p=[];d.value.forEach(l=>{p[l.ID]=0}),f.forEach(l=>{p[l.task_id]++,l.worker.barcode==o.value&&(u.value=l.task_id)}),d.value.forEach(l=>{l.working=p[l.ID],l.selected=l.ID==u.value}),t(),s.value=!1},t=()=>{i.value=d.value.filter(f=>f.tags.some(p=>p.name=="Management Unit"))},D=async()=>{s.value=!0,d.value=Array.from(await h("/tasks")),e(),s.value=!1},q=async()=>{const f=await h("/worker/lookup",{barcode:c.value});o.value=f.barcode},E=async f=>{let p=d.value.filter(l=>V.includes(l.ID));p.sort((l,O)=>V.indexOf(l.ID)-V.indexOf(O.ID)),a.value=f,n.value=p},N=async f=>{u.value!=f&&(u.value=f,await h("/hours/punch",{anum:c,task:f}),e())};K(()=>{q(),D()});let U;return $(()=>{c.value=localStorage.getItem("anumber"),U=setInterval(e,6e4)}),P(()=>{clearInterval(U)}),(f,p)=>{const l=Y;return k(),T(C,null,[m(a)?x("",!0):(k(),_(l,{key:0,tasks:m(i),onSelect:E},null,8,["tasks"])),m(a)?(k(),_(l,{key:1,search:"",tasks:m(n),focus:m(w),onSelect:N},null,8,["tasks","focus"])):x("",!0)],64)}}});export{re as default};
