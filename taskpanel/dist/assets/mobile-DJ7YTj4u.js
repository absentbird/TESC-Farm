import{g as ae,p as le,D as oe,e as i,j as Y,I as ne,E as L,z as se,a as re,G as N,c as a,H as ue,d as ie,h as R,i as ce,k as $,o as I,w as n,n as r,q as C,v as k,y as de,b as O,l as H,F as W,s as fe,t as _,x as T}from"./index-Yc2QcWEI.js";import{k as me,u as ve,l as z,m as ge,n as pe,f as Ve,d as J,g as K,h as M,e as q,o as be,V as G,a as h,b as ke,c as xe,i as ye,j as he}from"./VSwitch-OARsKg6f.js";import{c as we,f as Se,V as Q,a as D,d as X,b as Ce}from"./VContainer-gUiOu9Vr.js";import"./tag-CN4RcEDw.js";import"./ssrBoot-_LXArdEm.js";const Ee=me("v-spacer","div","VSpacer"),Ie=le({fullscreen:Boolean,retainFocus:{type:Boolean,default:!0},scrollable:Boolean,...ge({origin:"center center",scrollStrategy:"block",transition:{component:pe},zIndex:2400})},"VDialog"),Te=ae()({name:"VDialog",props:Ie(),emits:{"update:modelValue":s=>!0,afterEnter:()=>!0,afterLeave:()=>!0},setup(s,m){let{emit:w,slots:g}=m;const v=oe(s,"modelValue"),{scopeId:x}=ve(),o=i();function S(u){var c,d;const V=u.relatedTarget,b=u.target;if(V!==b&&((c=o.value)!=null&&c.contentEl)&&((d=o.value)!=null&&d.globalTop)&&![document,o.value.contentEl].includes(b)&&!o.value.contentEl.contains(b)){const f=ue(o.value.contentEl);if(!f.length)return;const y=f[0],P=f[f.length-1];V===y?P.focus():y.focus()}}Y(()=>{document.removeEventListener("focusin",S)}),ne&&L(()=>v.value&&s.retainFocus,u=>{u?document.addEventListener("focusin",S):document.removeEventListener("focusin",S)},{immediate:!0});function p(){var u;w("afterEnter"),(u=o.value)!=null&&u.contentEl&&!o.value.contentEl.contains(document.activeElement)&&o.value.contentEl.focus({preventScroll:!0})}function E(){w("afterLeave")}return L(v,async u=>{var V;u||(await se(),(V=o.value.activatorEl)==null||V.focus({preventScroll:!0}))}),re(()=>{const u=z.filterProps(s),V=N({"aria-haspopup":"dialog"},s.activatorProps),b=N({tabindex:-1},s.contentProps);return a(z,N({ref:o,class:["v-dialog",{"v-dialog--fullscreen":s.fullscreen,"v-dialog--scrollable":s.scrollable},s.class],style:s.style},u,{modelValue:v.value,"onUpdate:modelValue":c=>v.value=c,"aria-modal":"true",activatorProps:V,contentProps:b,height:s.fullscreen?void 0:s.height,width:s.fullscreen?void 0:s.width,maxHeight:s.fullscreen?void 0:s.maxHeight,maxWidth:s.fullscreen?void 0:s.maxWidth,role:"dialog",onAfterEnter:p,onAfterLeave:E},x),{activator:g.activator,default:function(){for(var c=arguments.length,d=new Array(c),f=0;f<c;f++)d[f]=arguments[f];return a(we,{root:"VDialog"},{default:()=>{var y;return[(y=g.default)==null?void 0:y.call(g,...d)]}})}})}),Se({},o)}}),je=ie({__name:"mobile",setup(s){const m=i(!1),w=i(!1),g=i(!1),v=i([]),x=i(""),o=i(""),S=i(""),p=i(0),E=i("mdi-form-textbox"),u=i(!1),V=i("error"),b=i(""),c=i({}),d=i({}),f=R(()=>{const l=new Set;for(const e of Array.from(c.value))for(const t of e.tags)l.add(t.name);return Array.from(l)}),y=R(()=>{let l=Array.from(c.value);return g.value||(l=l.filter(e=>Ve.includes(e.ID))),v.value.length>0&&(l=l.filter(e=>e.tags.some(t=>v.value.includes(t.name)))),x.value&&(l=l.filter(e=>(e.name+e.description).toUpperCase().includes(x.value.toUpperCase()))),l}),P=l=>{p.value!=l&&(p.value=l,p.value>0?ee(p.value):te())},Z=async()=>{w.value=!0;try{const l=await fetch("https://api.tesc.farm/tasks");l.ok||console.log(l.status),c.value=await l.json(),c.value.forEach(e=>{d.value[e.ID]=0})}catch(l){console.log(l)}finally{A()}},A=async()=>{w.value=!0;try{const l=await fetch("https://api.tesc.farm/hours/working");l.ok||console.log(l.status),c.value.forEach(t=>{d.value[t.ID]=0}),(await l.json()).forEach(t=>{d.value[t.task_id]++,t.worker.barcode==S.value&&(p.value=t.task_id)})}catch(l){console.log(l)}finally{w.value=!1}},U=()=>{o.value!=""&&(localStorage.setItem("anumber",o.value),m.value=!1,B())},j=()=>{o.value.length==9&&o.value[0]=="A"&&!isNaN(Number(o.value.substring(1)))?E.value="mdi-check-circle":E.value="mdi-form-textbox"},ee=async l=>{const e={barcode:o.value,task:l},t=await fetch("https://api.tesc.farm/hours/punch",{method:"POST",credentials:"include",body:JSON.stringify(e)});t.ok||(b.value=t.statusText,u.value=!0,console.log(t)),A()},te=async()=>{const l={barcode:o.value},e=await fetch("https://api.tesc.farm/hours/punch",{method:"POST",credentials:"include",body:JSON.stringify(l)});e.ok||(b.value=e.statusText,u.value=!0,console.log(e)),A()},B=async()=>{const l={barcode:o.value},e=await fetch("https://api.tesc.farm/worker/lookup",{method:"POST",credentials:"include",body:JSON.stringify(l)});e.ok||console.log(e);const t=await e.json();S.value=t.barcode};let F;return ce(()=>{o.value=localStorage.getItem("anumber"),o.value?(j(),B()):m.value=!0,Z(),F=setInterval(A,6e4)}),Y(()=>{clearInterval(F)}),(l,e)=>(I(),$(W,null,[a(Ce,{fluid:"",id:"taskpanel",class:"fill-height d-flex flex-column"},{default:n(()=>[a(Te,{modelValue:r(m),"onUpdate:modelValue":e[2]||(e[2]=t=>C(m)?m.value=t:null),persistent:!r(o)},{default:n(()=>[a(J,{class:"ma-auto w-100","max-width":"400","prepend-icon":"mdi-settings"},{default:n(()=>[a(K,null,{default:n(()=>e[10]||(e[10]=[k("Settings")])),_:1}),a(M,null,{default:n(()=>e[11]||(e[11]=[k("Set your A# to track tasks")])),_:1}),a(q,null,{default:n(()=>[a(Q,{id:"anum",ref:"anum","prepend-icon":r(E),modelValue:r(o),"onUpdate:modelValue":e[0]||(e[0]=t=>C(o)?o.value=t:null),onInput:j,onKeyup:de(U,["enter"]),hint:"Enter the A# from your student ID",label:"A#"},null,8,["prepend-icon","modelValue"])]),_:1}),a(be,null,{default:n(()=>[r(o)?(I(),O(D,{key:0,class:"ms-auto",text:"Close",onClick:e[1]||(e[1]=t=>m.value=!1)})):H("",!0),a(Ee),a(D,{class:"ms-auto",text:"Save",onClick:U})]),_:1})]),_:1})]),_:1},8,["modelValue","persistent"]),a(G,{id:"filters",class:"align-self-start d-flex w-100 flex-grow-0"},{default:n(()=>[a(h,{cols:"9",sm:"4",md:"7"},{default:n(()=>[a(Q,{id:"search",modelValue:r(x),"onUpdate:modelValue":e[3]||(e[3]=t=>C(x)?x.value=t:null),clearable:"",label:"Search",hint:"Search for tasks by name or description"},null,8,["modelValue"])]),_:1}),a(h,{cols:"3",class:"mt-2 d-flex d-sm-none"},{default:n(()=>[a(D,{onClick:e[4]||(e[4]=t=>m.value=!0),variant:"tonal"},{default:n(()=>[a(X,null,{default:n(()=>e[12]||(e[12]=[k("mdi-cog")])),_:1})]),_:1})]),_:1}),a(h,{cols:"6",sm:"3",md:"2"},{default:n(()=>[a(ke,{clearable:"",chips:"",multiple:"",label:"Tags",modelValue:r(v),"onUpdate:modelValue":e[5]||(e[5]=t=>C(v)?v.value=t:null),items:r(f)},null,8,["modelValue","items"])]),_:1}),a(h,{cols:"6",sm:"3",md:"2",class:"d-flex align-self-start"},{default:n(()=>[a(xe,{label:"Show All",inset:"",color:"secondary",modelValue:r(g),"onUpdate:modelValue":e[6]||(e[6]=t=>C(g)?g.value=t:null)},null,8,["modelValue"])]),_:1}),a(h,{cols:"1",class:"mt-2 d-none d-sm-flex"},{default:n(()=>[a(D,{onClick:e[7]||(e[7]=t=>m.value=!0),variant:"tonal"},{default:n(()=>[a(X,null,{default:n(()=>e[13]||(e[13]=[k("mdi-cog")])),_:1})]),_:1})]),_:1})]),_:1}),a(G,{align:"center",justify:"center",class:"d-flex flex-row w-100"},{default:n(()=>[(I(!0),$(W,null,fe(r(y),t=>(I(),O(h,{class:"d-flex flex-column",cols:"12",sm:"4",md:"3",lg:"2"},{default:n(()=>[a(J,{class:_(["task-card d-flex flex-column text-center",{selected:r(p)==t.ID}]),variant:"tonal",onClick:De=>P(t.ID)},{default:n(()=>[a(q,null,{default:n(()=>[a(K,null,{default:n(()=>[k(T(t.name),1)]),_:2},1024),r(d)[t.ID]?(I(),O(M,{key:0},{default:n(()=>[k(T(r(d)[t.ID])+" "+T(r(d)[t.ID]>1?"People":"Person")+" working ",1)]),_:2},1024)):H("",!0)]),_:2},1024),a(ye,null,{default:n(()=>[k(T(t.description),1)]),_:2},1024)]),_:2},1032,["class","onClick"])]),_:2},1024))),256)),a(h,{cols:"12"},{default:n(()=>[a(D,{class:_(["bigbutton",{selected:r(p)==0}]),variant:"tonal",onClick:e[8]||(e[8]=t=>P(0))},{default:n(()=>e[14]||(e[14]=[k(" Not Tracking Time ")])),_:1},8,["class"])]),_:1})]),_:1})]),_:1}),a(he,{modelValue:r(u),"onUpdate:modelValue":e[9]||(e[9]=t=>C(u)?u.value=t:null),timeout:"2000",location:"top",color:r(V)},{default:n(()=>[k(T(r(b)),1)]),_:1},8,["modelValue","color"])],64))}});export{je as default};
