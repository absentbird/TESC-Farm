import{f as h,V as j,a as N,_ as q}from"./VSwitch-VJj3gx5a.js";import{V as E}from"./VTextField-BY3mxu5u.js";import{a as V,V as B}from"./VRow-D-QbMUir.js";import{a as x,c as D}from"./VGrid-DrsK6pPy.js";import{b as L,c as M,d as O}from"./VMenu-DCXKYUba.js";import{d as A,r as f,e as S,w as U,i as T,j as p,c as o,l as n,k as v,t as b,q as C,F as I,y as $,v as w,x as F,H as R,B as H,T as z,h as J,o as P}from"./index-jfebRIU0.js";import{V as W}from"./VContainer-DtB8gWTZ.js";import"./VDivider-5qAH9_Ft.js";const G=A({__name:"FilterSearch",props:{items:{type:Array,required:!0}},emits:["filter"],setup(k,{emit:m}){const l=f(""),a=f(!1),r=f([]),d=k,_=m,c=S(()=>{const s=new Set;for(const t of d.items)for(const e of t.tags)s.add(e.name);return Array.from(s)}),u=S(()=>{let s=d.items;return a.value?s.sort((t,e)=>t.name.localeCompare(e.name)):(s=s.filter(t=>h.includes(t.ID)),s.sort((t,e)=>h.indexOf(t.ID)-h.indexOf(e.ID))),r.value.length>0&&(s=s.filter(t=>t.tags.some(e=>r.value.includes(e.name)))),l.value&&(s=s.filter(t=>(t.name+t.description).toUpperCase().includes(l.value.toUpperCase()))),s});return U(u,(s,t)=>{t!=s&&_("filter",u.value)}),(s,t)=>(p(),T(I,null,[o(V,{cols:"9",sm:"4",md:"7"},{default:n(()=>[o(E,{id:"search",modelValue:v(l),"onUpdate:modelValue":t[0]||(t[0]=e=>b(l)?l.value=e:null),clearable:"",label:"Search",hint:"Search for items by name or description"},null,8,["modelValue"])]),_:1}),o(V,{cols:"3",class:"mt-2 d-flex d-sm-none"},{default:n(()=>[o(x,{variant:"tonal"},{default:n(()=>[o(D,null,{default:n(()=>t[3]||(t[3]=[C("mdi-cog")])),_:1}),o(L,{activator:"parent"},{default:n(()=>[o(M,null,{default:n(()=>[(p(!0),T(I,null,$(s.userSettings,e=>(p(),w(O,{title:e.title,onClick:e.action},null,8,["title","onClick"]))),256))]),_:1})]),_:1})]),_:1})]),_:1}),o(V,{cols:"6",sm:"3",md:"2"},{default:n(()=>[o(j,{clearable:"",chips:"",multiple:"",label:"Tags",modelValue:v(r),"onUpdate:modelValue":t[1]||(t[1]=e=>b(r)?r.value=e:null),items:v(c)},null,8,["modelValue","items"])]),_:1}),o(V,{cols:"6",sm:"3",md:"2",class:"d-flex align-self-start"},{default:n(()=>[o(N,{label:"Show All",inset:"",color:"secondary",modelValue:v(a),"onUpdate:modelValue":t[2]||(t[2]=e=>b(a)?a.value=e:null)},null,8,["modelValue"])]),_:1}),o(V,{cols:"1",class:"mt-2 d-none d-sm-flex"},{default:n(()=>[o(x,{variant:"tonal"},{default:n(()=>[o(D,null,{default:n(()=>t[4]||(t[4]=[C("mdi-cog")])),_:1})]),_:1})]),_:1})],64))}}),K=A({__name:"TaskSelector",props:{tasks:{type:Array,required:!0},search:{type:Boolean,required:!1}},emits:["select"],setup(k,{emit:m}){const l=k,a=f(l.tasks),r=f(a.value),d=S(()=>{const c=Array.from(r.value).find(u=>u.selected);return c?c.ID:0});U(l,()=>{a.value=l.tasks});const _=c=>{r.value=c};return(c,u)=>{const s=G,t=q;return p(),w(W,{fluid:"",class:"taskpanel fill-height d-flex flex-column"},{default:n(()=>[k.search?(p(),w(B,{key:0,id:"filters",class:"align-self-start d-flex w-100 flex-grow-0"},{default:n(()=>[o(s,{items:v(a),onFilter:_},null,8,["items"])]),_:1})):F("",!0),v(r)?(p(),w(B,{key:1,id:"main-content",align:"center",justify:"center",class:"d-flex flex-row w-100"},{default:n(()=>[(p(!0),T(I,null,$(v(r),e=>(p(),w(t,{task:e,onSelect:g=>c.$emit("select",e.ID)},null,8,["task","onSelect"]))),256)),o(V,{cols:"12"},{default:n(()=>[o(x,{class:R(["bigbutton",{selected:v(d)==0}]),variant:"tonal",onClick:u[0]||(u[0]=e=>c.$emit("select",0))},{default:n(()=>u[1]||(u[1]=[C(" Not Tracking Time ")])),_:1},8,["class"])]),_:1})]),_:1})):F("",!0)]),_:1})}}});async function y(k,m){let l={};try{if(m){const a=await fetch("https://api.tesc.farm"+k,{method:"POST",credentials:"include",body:JSON.stringify(m)});a.ok?l=await a.json():console.log(a.status)}else{const a=await fetch("https://api.tesc.farm"+k);a.ok?l=await a.json():console.log(a.status)}}catch(a){console.log(a)}finally{return l}}const le=A({__name:"mobile",setup(k){H();const m=f(!1),l=f(0),a=f(""),r=f(""),d=f(Array()),_=async()=>{m.value=!0;const e=Array.from(await y("/hours/working")),g={};d.value.forEach(i=>{g[i.ID]=0}),e.forEach(i=>{g[i.task_id]++,i.worker.barcode==a.value&&(l.value=i.task_id)}),d.value.forEach(i=>{i.working=g[i.ID],i.selected=i.ID==l.value}),m.value=!1},c=async()=>{m.value=!0;let e=Array.from(await y("/tasks"));e=e.filter(g=>g.tags.some(i=>i.name=="Management Unit")),d.value=e,_(),m.value=!1},u=async()=>{const e=await y("/worker/lookup",{barcode:r.value});a.value=e.barcode,console.log(a.value)},s=async e=>{l.value=e,await y("/hours/punch",{anum:r,task:e}),_()};z(()=>{c()});let t;return J(()=>{r.value=localStorage.getItem("anumber"),u(),t=setInterval(c,6e4)}),P(()=>{clearInterval(t)}),(e,g)=>{const i=K;return p(),w(i,{search:"",tasks:v(d),onSelect:s},null,8,["tasks"])}}});export{le as default};
