import{f as h,V as N,a as $,_ as q}from"./VSwitch-Dl6MHZro.js";import{V as E}from"./VTextField-C889d65x.js";import{a as V,V as B}from"./VRow-CiCR3WA5.js";import{a as x,c as F}from"./VGrid-LpqclO5D.js";import{b as L,c as M,d as O}from"./VMenu-DuS4Lv1A.js";import{d as A,r as m,e as T,w as j,i as S,j as f,c as n,l as r,k as d,t as b,q as C,F as I,y as D,v as w,x as U,H as R,B as H,T as z,h as J,o as P}from"./index-jRNJUFEo.js";import{V as W}from"./VContainer-C8fQdCzf.js";import"./VDivider-Cy_Ybe81.js";const G=A({__name:"FilterSearch",props:{items:{type:Array,required:!0}},emits:["filter"],setup(p,{emit:u}){const l=m(""),s=m(!1),i=m([]),c=p,k=u,g=T(()=>{const a=new Set;for(const e of c.items)for(const t of e.tags)a.add(t.name);return Array.from(a)}),_=T(()=>{let a=c.items;return s.value?a.sort((e,t)=>e.name.localeCompare(t.name)):(a=a.filter(e=>h.includes(e.ID)),a.sort((e,t)=>h.indexOf(e.ID)-h.indexOf(t.ID))),i.value.length>0&&(a=a.filter(e=>e.tags.some(t=>i.value.includes(t.name)))),l.value&&(a=a.filter(e=>(e.name+e.description).toUpperCase().includes(l.value.toUpperCase()))),a});return j(_,(a,e)=>{e!=a&&k("filter",_.value)}),(a,e)=>(f(),S(I,null,[n(V,{cols:"9",sm:"4",md:"7"},{default:r(()=>[n(E,{id:"search",modelValue:d(l),"onUpdate:modelValue":e[0]||(e[0]=t=>b(l)?l.value=t:null),clearable:"",label:"Search",hint:"Search for items by name or description"},null,8,["modelValue"])]),_:1}),n(V,{cols:"3",class:"mt-2 d-flex d-sm-none"},{default:r(()=>[n(x,{variant:"tonal"},{default:r(()=>[n(F,null,{default:r(()=>e[3]||(e[3]=[C("mdi-cog")])),_:1}),n(L,{activator:"parent"},{default:r(()=>[n(M,null,{default:r(()=>[(f(!0),S(I,null,D(a.userSettings,t=>(f(),w(O,{title:t.title,onClick:t.action},null,8,["title","onClick"]))),256))]),_:1})]),_:1})]),_:1})]),_:1}),n(V,{cols:"6",sm:"3",md:"2"},{default:r(()=>[n(N,{clearable:"",chips:"",multiple:"",label:"Tags",modelValue:d(i),"onUpdate:modelValue":e[1]||(e[1]=t=>b(i)?i.value=t:null),items:d(g)},null,8,["modelValue","items"])]),_:1}),n(V,{cols:"6",sm:"3",md:"2",class:"d-flex align-self-start"},{default:r(()=>[n($,{label:"Show All",inset:"",color:"secondary",modelValue:d(s),"onUpdate:modelValue":e[2]||(e[2]=t=>b(s)?s.value=t:null)},null,8,["modelValue"])]),_:1}),n(V,{cols:"1",class:"mt-2 d-none d-sm-flex"},{default:r(()=>[n(x,{variant:"tonal"},{default:r(()=>[n(F,null,{default:r(()=>e[4]||(e[4]=[C("mdi-cog")])),_:1})]),_:1})]),_:1})],64))}}),K=A({__name:"TaskSelector",props:{tasks:{type:Array,required:!0},search:{type:Boolean,required:!1}},emits:["select"],setup(p,{emit:u}){const l=p,s=u,i=m(l.tasks),c=m(i.value),k=T(()=>{const a=Array.from(c.value).find(e=>e.selected);return a?a.ID:0});j(l,()=>{i.value=l.tasks});const g=a=>{a!=k.value&&(a>0?s("select",a):s("select",0))},_=a=>{c.value=a};return(a,e)=>{const t=G,v=q;return f(),w(W,{fluid:"",class:"taskpanel fill-height d-flex flex-column"},{default:r(()=>[p.search?(f(),w(B,{key:0,id:"filters",class:"align-self-start d-flex w-100 flex-grow-0"},{default:r(()=>[n(t,{items:d(i),onFilter:_},null,8,["items"])]),_:1})):U("",!0),d(c)?(f(),w(B,{key:1,id:"main-content",align:"center",justify:"center",class:"d-flex flex-row w-100"},{default:r(()=>[(f(!0),S(I,null,D(d(c),o=>(f(),w(v,{task:o,onSelect:g},null,8,["task"]))),256)),n(V,{cols:"12"},{default:r(()=>[n(x,{class:R(["bigbutton",{selected:d(k)==0}]),variant:"tonal",onClick:e[0]||(e[0]=o=>a.$emit("select",0))},{default:r(()=>e[1]||(e[1]=[C(" Not Tracking Time ")])),_:1},8,["class"])]),_:1})]),_:1})):U("",!0)]),_:1})}}});async function y(p,u){let l={};try{if(u){const s=await fetch("https://api.tesc.farm"+p,{method:"POST",credentials:"include",body:JSON.stringify(u)});s.ok?l=await s.json():console.log(s.status)}else{const s=await fetch("https://api.tesc.farm"+p);s.ok?l=await s.json():console.log(s.status)}}catch(s){console.log(s)}finally{return l}}const le=A({__name:"mobile",setup(p){H();const u=m(!1),l=m(0),s=m(""),i=m(""),c=m(Array()),k=async()=>{u.value=!0;const t=Array.from(await y("/hours/working")),v={};c.value.forEach(o=>{v[o.ID]=0}),t.forEach(o=>{v[o.task_id]++,o.worker.barcode==s.value&&(l.value=o.task_id)}),c.value.forEach(o=>{o.working=v[o.ID],o.selected=o.ID==l.value}),u.value=!1},g=async()=>{u.value=!0;let t=Array.from(await y("/tasks"));t=t.filter(v=>v.tags.some(o=>o.name=="Management Unit")),c.value=t,k(),u.value=!1},_=async()=>{const t=await y("/worker/lookup",{barcode:i.value});s.value=t.barcode,console.log(s.value)},a=t=>{l.value=t,y("/hours/punch",{anum:i,task:t}),k()};z(()=>{g()});let e;return J(()=>{i.value=localStorage.getItem("anumber"),_(),e=setInterval(g,6e4)}),P(()=>{clearInterval(e)}),(t,v)=>{const o=K;return f(),w(o,{search:"",tasks:d(c),onSelect:a},null,8,["tasks"])}}});export{le as default};
