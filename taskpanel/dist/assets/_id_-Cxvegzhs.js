import{_ as B}from"./CardSelector.vue_vue_type_script_setup_true_lang-DPfuUsuA.js";import{a as c}from"./apicall-BDFmDRg5.js";import{d as D,T as A,b as E,r,i as d,U as S,j as x,o as C,k as N,l as T,E as V,c as _,H as j,q as s,t as F,v as H,F as M}from"./index-BqBYkQoP.js";import{b as R}from"./VTextField-DIRXKGr2.js";import"./VSwitch-CAezTYW2.js";import"./VMenu-Dna0TubK.js";import"./VContainer-Bt1WHSop.js";const U={class:"pl-8"},P=D({__name:"[id]",setup($){const w=A(),u=E(),n=r(!1),o=r(0),f=r(""),i=r(""),l=r(Array()),v=r(u.params.id),p=d(()=>l.value.filter(a=>a.area_id==u.params.id)),g=d(()=>u.meta.userstatus=="admin"),h=d(()=>{const a=p.value.find(t=>t.area);return a?a.area.name:"Area #"+String(v.value)}),m=async()=>{n.value=!0,o.value=0;const a=Array.from(await c("/hours/working")),t={};l.value.forEach(e=>{t[e.ID]=0}),a.forEach(e=>{t[e.task_id]++,e.worker.barcode==f.value&&(o.value=e.task_id)}),l.value.forEach(e=>{e.working=t[e.ID],e.selected=e.ID==o.value}),n.value=!1},b=async()=>{n.value=!0,l.value=Array.from(await c("/tasks")),m(),n.value=!1},y=async()=>{const a=await c("/worker/lookup",{barcode:i.value});f.value=a.barcode},I=async a=>{o.value!=a&&(await c("/hours/punch",{anum:i,task:a}),m())};S(()=>{y(),b()});let k;return x(()=>{i.value=localStorage.getItem("anumber"),k=setInterval(m,6e4)}),C(()=>{clearInterval(k)}),(a,t)=>{const e=B;return T(),N(M,null,[V("h2",U,j(s(h)),1),_(R,{onClick:t[0]||(t[0]=q=>s(w).push("/area")),variant:"tonal",class:"ml-7"},{default:F(()=>t[1]||(t[1]=[H("Back to Areas")])),_:1}),_(e,{search:"",tracking:"",items:s(p),onSelect:I,newItem:s(g)?"/taskbuilder?area="+s(v):"",selected:s(o)},null,8,["items","newItem","selected"])],64)}}});export{P as default};
