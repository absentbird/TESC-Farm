import{d as q,e as r,f as L,h as w,i as M,j as W,k as C,o as p,c as l,l as _,w as s,n as o,q as k,F as D,s as G,b as N,t as U,v as V,x,y as j,z as H}from"./index-C3nnbfIr.js";import{V as A,a as v,b as Q,c as X,d as Y,e as Z,f as ee,g as ae,h as te}from"./VSwitch-CkxhD3LY.js";import{V as O,a as le,b as se}from"./VContainer-B4_t6u7W.js";import"./tag-Dwyqt6J4.js";import"./ssrBoot-C5O7O2UM.js";const oe={key:0,id:"anumfloat",class:"align-self-end"},fe=q({__name:"index",setup(ne){const B=[12,13,15,19,20,23,27,28,31,33,35,39,42,43,46,48,49,57],y=r(!1),g=r(!1),f=r([]),m=r(""),u=r(""),n=r(0),i=r("mdi-form-textbox"),c=r({}),d=r({}),T=L("anum"),E=w(()=>{const e=new Set;for(const a of Array.from(c.value))for(const t of a.tags)e.add(t.name);return Array.from(e)}),F=w(()=>{let e=Array.from(c.value);return g.value||(e=e.filter(a=>B.includes(a.ID))),f.value.length>0&&(e=e.filter(a=>a.tags.some(t=>f.value.includes(t.name)))),m.value&&(e=e.filter(a=>(a.name+a.description).toUpperCase().includes(m.value.toUpperCase()))),e}),P=w(()=>n.value==0?"None":n.value<0?"Stop Tracking Time":c.value.find(e=>e.ID===n.value).name),b=e=>{n.value=e,e!=0&&H(()=>{T.value.focus()})},K=async()=>{y.value=!0;try{const e=await fetch("https://api.tesc.farm/tasks");e.ok||console.log(e.status),c.value=await e.json(),c.value.forEach(a=>{d.value[a.ID]=0})}catch(e){console.log(e)}finally{h()}},h=async()=>{y.value=!0;try{const e=await fetch("https://api.tesc.farm/hours/working");e.ok||console.log(e.status),c.value.forEach(t=>{d.value[t.ID]=0}),(await e.json()).forEach(t=>{d.value[t.task_id]++})}catch(e){console.log(e)}finally{y.value=!1}},I=()=>{u.value!=""&&(n.value==-1?z(u.value):$(u.value,n.value),u.value="")},R=e=>{u.value.length>8&&(I(),e.target.focus())},$=async(e,a)=>{(await fetch("https://api.tesc.farm/hours/punch",{method:"POST",body:JSON.stringify({barcode:e,task:a})})).ok?i.value="mdi-check-circle":i.value="mdi-alert-circle",setTimeout(()=>{i.value="mdi-form-textbox"},3e3),h()},z=async e=>{(await fetch("https://api.tesc.farm/hours/punch",{method:"POST",body:JSON.stringify({barcode:e})})).ok?i.value="mdi-check-circle":i.value="mdi-alert-circle",setTimeout(()=>{i.value="mdi-form-textbox"},3e3),h()};let S;return M(()=>{K(),S=setInterval(h,6e4)}),W(()=>{clearInterval(S)}),(e,a)=>(p(),C(D,null,[l(se,{fluid:"",id:"taskpanel",class:"fill-height d-flex flex-column withfloat"},{default:s(()=>[l(A,{id:"filters",class:"align-self-start d-flex w-100"},{default:s(()=>[l(v,{cols:"12",sm:"4",md:"8"},{default:s(()=>[l(O,{id:"search",modelValue:o(m),"onUpdate:modelValue":a[0]||(a[0]=t=>k(m)?m.value=t:null),clearable:"",label:"Search",hint:"Search for tasks by name or description"},null,8,["modelValue"])]),_:1}),l(v,{cols:"6",sm:"4",md:"2"},{default:s(()=>[l(Q,{clearable:"",chips:"",multiple:"",label:"Tags",modelValue:o(f),"onUpdate:modelValue":a[1]||(a[1]=t=>k(f)?f.value=t:null),items:o(E)},null,8,["modelValue","items"])]),_:1}),l(v,{cols:"6",sm:"4",md:"2",class:"d-flex align-self-start"},{default:s(()=>[l(X,{label:"Show All",inset:"",color:"secondary",modelValue:o(g),"onUpdate:modelValue":a[2]||(a[2]=t=>k(g)?g.value=t:null)},null,8,["modelValue"])]),_:1})]),_:1}),l(A,{align:"center",justify:"center",class:"d-flex flex-row w-100"},{default:s(()=>[(p(!0),C(D,null,G(o(F),t=>(p(),N(v,{class:"d-flex flex-column",cols:"12",sm:"4",md:"3",lg:"2"},{default:s(()=>[l(Y,{class:U(["task-card d-flex flex-column text-center",{selected:o(n)==t.ID}]),variant:"tonal",onClick:J=>b(t.ID)},{default:s(()=>[l(Z,null,{default:s(()=>[l(ee,null,{default:s(()=>[V(x(t.name),1)]),_:2},1024),o(d)[t.ID]?(p(),N(ae,{key:0},{default:s(()=>[V(x(o(d)[t.ID])+" "+x(o(d)[t.ID]>1?"People":"Person")+" working ",1)]),_:2},1024)):_("",!0)]),_:2},1024),l(te,null,{default:s(()=>[V(x(t.description),1)]),_:2},1024)]),_:2},1032,["class","onClick"])]),_:2},1024))),256)),l(v,{cols:"12"},{default:s(()=>[l(le,{class:U(["bigbutton",{selected:o(n)==-1}]),variant:"tonal",onClick:a[3]||(a[3]=t=>b(-1))},{default:s(()=>a[6]||(a[6]=[V(" Stop Tracking Time ")])),_:1},8,["class"])]),_:1})]),_:1})]),_:1}),o(n)?(p(),C("div",oe,[l(O,{id:"anum",ref_key:"anum",ref:T,"prepend-icon":o(i),modelValue:o(u),"onUpdate:modelValue":a[4]||(a[4]=t=>k(u)?u.value=t:null),onInput:R,onKeyup:j(I,["enter"]),onKeydown:a[5]||(a[5]=j(t=>b(0),["esc"])),hint:"Enter the A# from your student ID",label:o(P)},null,8,["prepend-icon","modelValue","label"])])):_("",!0)],64))}});export{fe as default};
