import{f as x,V as N,a as q,_ as E}from"./VSwitch-BPhlFusQ.js";import{V as L}from"./VTextField-BEjPBO7F.js";import{a as w,V as F}from"./VRow-zDqRUmta.js";import{a as T,c as U}from"./VGrid-B2QB3Mq-.js";import{b as M,c as O,d as R}from"./VMenu-Bojx4-GW.js";import{d as D,r as m,e as C,w as $,i as I,j as g,c as o,l as n,k,t as S,q as A,F as B,y as j,v as y,x as H,H as z,B as J,T as P,h as W,o as G}from"./index-B1rTmADD.js";import{V as K}from"./VContainer-CV5iNO1h.js";import"./VDivider-reVCDhED.js";const Q=D({__name:"FilterSearch",props:{items:{type:Array,required:!0}},emits:["filter"],setup(v,{emit:f}){const l=m(""),a=m(!1),r=m([]),p=v,_=f,i=C(()=>{const s=new Set;for(const e of p.items)for(const t of e.tags)s.add(t.name);return Array.from(s)}),c=C(()=>{let s=p.items;return a.value?s.sort((e,t)=>e.name.localeCompare(t.name)):(s=s.filter(e=>x.includes(e.ID)),s.sort((e,t)=>x.indexOf(e.ID)-x.indexOf(t.ID))),r.value.length>0&&(s=s.filter(e=>e.tags.some(t=>r.value.includes(t.name)))),l.value&&(s=s.filter(e=>(e.name+e.description).toUpperCase().includes(l.value.toUpperCase()))),s});return $(c,(s,e)=>{e!=s&&_("filter",c.value)}),(s,e)=>(g(),I(B,null,[o(w,{cols:"9",sm:"4",md:"7"},{default:n(()=>[o(L,{id:"search",modelValue:k(l),"onUpdate:modelValue":e[0]||(e[0]=t=>S(l)?l.value=t:null),clearable:"",label:"Search",hint:"Search for items by name or description"},null,8,["modelValue"])]),_:1}),o(w,{cols:"3",class:"mt-2 d-flex d-sm-none"},{default:n(()=>[o(T,{variant:"tonal"},{default:n(()=>[o(U,null,{default:n(()=>e[3]||(e[3]=[A("mdi-cog")])),_:1}),o(M,{activator:"parent"},{default:n(()=>[o(O,null,{default:n(()=>[(g(!0),I(B,null,j(s.userSettings,t=>(g(),y(R,{title:t.title,onClick:t.action},null,8,["title","onClick"]))),256))]),_:1})]),_:1})]),_:1})]),_:1}),o(w,{cols:"6",sm:"3",md:"2"},{default:n(()=>[o(N,{clearable:"",chips:"",multiple:"",label:"Tags",modelValue:k(r),"onUpdate:modelValue":e[1]||(e[1]=t=>S(r)?r.value=t:null),items:k(i)},null,8,["modelValue","items"])]),_:1}),o(w,{cols:"6",sm:"3",md:"2",class:"d-flex align-self-start"},{default:n(()=>[o(q,{label:"Show All",inset:"",color:"secondary",modelValue:k(a),"onUpdate:modelValue":e[2]||(e[2]=t=>S(a)?a.value=t:null)},null,8,["modelValue"])]),_:1}),o(w,{cols:"1",class:"mt-2 d-none d-sm-flex"},{default:n(()=>[o(T,{variant:"tonal"},{default:n(()=>[o(U,null,{default:n(()=>e[4]||(e[4]=[A("mdi-cog")])),_:1})]),_:1})]),_:1})],64))}}),X=D({__name:"TaskSelector",props:{tasks:{type:Array,required:!0},search:{type:Boolean,required:!1}},emits:["select"],setup(v,{emit:f}){const l=v,a=m(l.tasks),r=m([]),p=C(()=>{if(r.value.length==0)return-1;const i=Array.from(r.value).find(c=>c.selected);return i?i.ID:0});$(l,()=>{a.value=l.tasks});const _=i=>{r.value=i};return(i,c)=>{const s=Q,e=E;return g(),y(K,{fluid:"",class:"taskpanel fill-height d-flex flex-column"},{default:n(()=>[v.search?(g(),y(F,{key:0,id:"filters",class:"align-self-start d-flex w-100 flex-grow-0"},{default:n(()=>[o(s,{items:k(a),onFilter:_},null,8,["items"])]),_:1})):H("",!0),o(F,{id:"main-content",align:"center",justify:"center",class:"d-flex flex-row w-100"},{default:n(()=>[(g(!0),I(B,null,j(k(r),t=>(g(),y(e,{task:t,onSelect:b=>i.$emit("select",t.ID)},null,8,["task","onSelect"]))),256)),o(w,{cols:"12"},{default:n(()=>[o(T,{class:z(["bigbutton",{selected:k(p)==0}]),variant:"tonal",onClick:c[0]||(c[0]=t=>i.$emit("select",0))},{default:n(()=>c[1]||(c[1]=[A(" Not Tracking Time ")])),_:1},8,["class"])]),_:1})]),_:1})]),_:1})}}});async function h(v,f){let l={};try{if(f){const a=await fetch("https://api.tesc.farm"+v,{method:"POST",credentials:"include",body:JSON.stringify(f)});a.ok?l=await a.json():console.log(a.status)}else{const a=await fetch("https://api.tesc.farm"+v);a.ok?l=await a.json():console.log(a.status)}}catch(a){console.log(a)}finally{return l}}const ne=D({__name:"mobile",setup(v){J();const f=m(!1),l=m(0),a=m(""),r=m(""),p=m(Array()),_=m(Array()),i=async()=>{f.value=!0;const d=Array.from(await h("/hours/working")),V={};p.value.forEach(u=>{V[u.ID]=0}),d.forEach(u=>{V[u.task_id]++,u.worker.barcode==a.value&&(l.value=u.task_id)}),p.value.forEach(u=>{u.working=V[u.ID],u.selected=u.ID==l.value}),c(),f.value=!1},c=()=>{_.value=p.value.filter(d=>d.tags.some(V=>V.name=="Management Unit"))},s=async()=>{f.value=!0,p.value=Array.from(await h("/tasks")),i(),f.value=!1},e=async()=>{const d=await h("/worker/lookup",{barcode:r.value});a.value=d.barcode,console.log(a.value)},t=async d=>{l.value!=d&&(l.value=d,await h("/hours/punch",{anum:r,task:d}),i())};P(()=>{e(),s()});let b;return W(()=>{r.value=localStorage.getItem("anumber"),b=setInterval(i,6e4)}),G(()=>{clearInterval(b)}),(d,V)=>{const u=X;return g(),y(u,{search:"",tasks:k(_),onSelect:t},null,8,["tasks"])}}});export{ne as default};
