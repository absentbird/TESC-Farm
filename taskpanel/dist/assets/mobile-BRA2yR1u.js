import{u as me,c as z,m as ve,d as ge,f as U,e as M,g as K,h as q,V as pe,a as Ve,_ as ke,b as be}from"./VSwitch-bPp1w_MY.js";import{g as he,p as we,D as xe,f as d,k as ne,I as ye,E as G,A as Ce,a as Se,G as B,c as a,H as Ee,d as Ae,C as Te,i as F,j as Ie,b as P,o as x,w as l,q as u,n as C,x as y,y as Pe,t as D,l as De,F as O,s as j,v as Oe,z as Le,J as Ne}from"./index-ZVoXBEJl.js";import{f as Ue,V as Q,a as Be}from"./VTextField-BvLousLF.js";import{a as Fe,V as S,b as X}from"./VBtn-qhzDO-fz.js";import{c as je,b as Y,d as Z,e as ee,f as _e,g as te,V as ae,a as A}from"./VRow-Cc6Jp9ti.js";import"./ssrBoot-5xF2dNNh.js";import"./tag-B2JrnWcc.js";const le=je("v-spacer","div","VSpacer"),Re=we({fullscreen:Boolean,retainFocus:{type:Boolean,default:!0},scrollable:Boolean,...ve({origin:"center center",scrollStrategy:"block",transition:{component:ge},zIndex:2400})},"VDialog"),oe=he()({name:"VDialog",props:Re(),emits:{"update:modelValue":r=>!0,afterEnter:()=>!0,afterLeave:()=>!0},setup(r,L){let{emit:V,slots:v}=L;const w=xe(r,"modelValue"),{scopeId:E}=me(),c=d();function b(s){var h,p;const g=s.relatedTarget,m=s.target;if(g!==m&&((h=c.value)!=null&&h.contentEl)&&((p=c.value)!=null&&p.globalTop)&&![document,c.value.contentEl].includes(m)&&!c.value.contentEl.contains(m)){const f=Ee(c.value.contentEl);if(!f.length)return;const k=f[0],N=f[f.length-1];g===k?N.focus():k.focus()}}ne(()=>{document.removeEventListener("focusin",b)}),ye&&G(()=>w.value&&r.retainFocus,s=>{s?document.addEventListener("focusin",b):document.removeEventListener("focusin",b)},{immediate:!0});function i(){var s;V("afterEnter"),(s=c.value)!=null&&s.contentEl&&!c.value.contentEl.contains(document.activeElement)&&c.value.contentEl.focus({preventScroll:!0})}function I(){V("afterLeave")}return G(w,async s=>{var g;s||(await Ce(),(g=c.value.activatorEl)==null||g.focus({preventScroll:!0}))}),Se(()=>{const s=z.filterProps(r),g=B({"aria-haspopup":"dialog"},r.activatorProps),m=B({tabindex:-1},r.contentProps);return a(z,B({ref:c,class:["v-dialog",{"v-dialog--fullscreen":r.fullscreen,"v-dialog--scrollable":r.scrollable},r.class],style:r.style},s,{modelValue:w.value,"onUpdate:modelValue":h=>w.value=h,"aria-modal":"true",activatorProps:g,contentProps:m,height:r.fullscreen?void 0:r.height,width:r.fullscreen?void 0:r.width,maxHeight:r.fullscreen?void 0:r.maxHeight,maxWidth:r.fullscreen?void 0:r.maxWidth,role:"dialog",onAfterEnter:i,onAfterLeave:I},E),{activator:v.activator,default:function(){for(var h=arguments.length,p=new Array(h),f=0;f<h;f++)p[f]=arguments[f];return a(Fe,{root:"VDialog"},{default:()=>{var k;return[(k=v.default)==null?void 0:k.call(v,...p)]}})}})}),Ue({},c)}}),qe=Ae({__name:"mobile",setup(r){const L=Te(),V=d(!1),v=d(!1),w=d(!1),E=d(!1),c=d([]),b=d(""),i=d(""),I=d(""),s=d(0),g=d("mdi-form-textbox"),m=d(!1),h=d("error"),p=d(""),f=d({}),k=d({}),N=async()=>{const t=await fetch("https://api.tesc.farm/logout",{credentials:"include"});t.ok?Ne.push("/login"):(p.value=t.statusText,m.value=!0)},se=async()=>{const t=await fetch("https://api.tesc.farm/hours/punchoutall",{credentials:"include"});t.ok||(p.value=t.statusText,m.value=!0),T(),v.value=!1,s.value=0},ue=d([{title:"Edit A#",action:()=>{V.value=!0},users:["worker","admin"]},{title:"Stop Tracking All",action:()=>{v.value=!0},users:["admin"]},{title:"Logout",action:N,users:["worker","admin"]}]),_=F(()=>{const t=L.meta.userstatus;return ue.value.filter(e=>e.users.includes(t))}),re=F(()=>{const t=new Set;for(const e of Array.from(f.value))for(const n of e.tags)t.add(n.name);return Array.from(t)}),ie=F(()=>{let t=Array.from(f.value);return E.value?t.sort((e,n)=>e.name.localeCompare(n.name)):(t=t.filter(e=>U.includes(e.ID)),t.sort((e,n)=>U.indexOf(e.ID)-U.indexOf(n.ID))),c.value.length>0&&(t=t.filter(e=>e.tags.some(n=>c.value.includes(n.name)))),b.value&&(t=t.filter(e=>(e.name+e.description).toUpperCase().includes(b.value.toUpperCase()))),t}),R=t=>{s.value!=t&&(s.value=t,s.value>0?de(s.value):fe())},ce=async()=>{w.value=!0;try{const t=await fetch("https://api.tesc.farm/tasks");t.ok||console.log(t.status),f.value=await t.json(),f.value.forEach(e=>{k.value[e.ID]=0})}catch(t){console.log(t)}finally{T()}},T=async()=>{w.value=!0;try{const t=await fetch("https://api.tesc.farm/hours/working");t.ok||console.log(t.status),f.value.forEach(n=>{k.value[n.ID]=0}),(await t.json()).forEach(n=>{k.value[n.task_id]++,n.worker.barcode==I.value&&(s.value=n.task_id)})}catch(t){console.log(t)}finally{w.value=!1}},W=()=>{i.value!=""&&(localStorage.setItem("anumber",i.value),V.value=!1,J())},H=()=>{i.value.length==9&&i.value[0]=="A"&&!isNaN(Number(i.value.substring(1)))?g.value="mdi-check-circle":g.value="mdi-form-textbox"},de=async t=>{const e={barcode:i.value,task:t},n=await fetch("https://api.tesc.farm/hours/punch",{method:"POST",credentials:"include",body:JSON.stringify(e)});n.ok||(p.value=n.statusText,m.value=!0,console.log(n)),T()},fe=async()=>{const t={barcode:i.value},e=await fetch("https://api.tesc.farm/hours/punch",{method:"POST",credentials:"include",body:JSON.stringify(t)});e.ok||(p.value=e.statusText,m.value=!0,console.log(e)),T()},J=async()=>{const t={barcode:i.value},e=await fetch("https://api.tesc.farm/worker/lookup",{method:"POST",credentials:"include",body:JSON.stringify(t)});e.ok||console.log(e);const n=await e.json();I.value=n.barcode};let $;return Ie(()=>{i.value=localStorage.getItem("anumber"),i.value?(H(),J()):V.value=!0,ce(),$=setInterval(T,6e4)}),ne(()=>{clearInterval($)}),(t,e)=>{const n=ke;return x(),P(O,null,[a(Be,{fluid:"",id:"taskpanel",class:"fill-height d-flex flex-column"},{default:l(()=>[a(oe,{modelValue:u(V),"onUpdate:modelValue":e[2]||(e[2]=o=>C(V)?V.value=o:null),persistent:!u(i)},{default:l(()=>[a(Y,{class:"ma-auto w-100","max-width":"400","prepend-icon":"mdi-settings"},{default:l(()=>[a(Z,null,{default:l(()=>e[10]||(e[10]=[y("Edit A#")])),_:1}),a(ee,null,{default:l(()=>e[11]||(e[11]=[y("Set your A# to track tasks")])),_:1}),a(_e,null,{default:l(()=>[a(Q,{id:"anum",ref:"anum","prepend-icon":u(g),modelValue:u(i),"onUpdate:modelValue":e[0]||(e[0]=o=>C(i)?i.value=o:null),onInput:H,onKeyup:Pe(W,["enter"]),hint:"Enter the A# from your student ID",label:"A#"},null,8,["prepend-icon","modelValue"])]),_:1}),a(te,null,{default:l(()=>[u(i)?(x(),D(S,{key:0,class:"ms-auto",text:"Close",onClick:e[1]||(e[1]=o=>V.value=!1)})):De("",!0),a(le),a(S,{class:"ms-auto",text:"Save",onClick:W})]),_:1})]),_:1})]),_:1},8,["modelValue","persistent"]),a(oe,{modelValue:u(v),"onUpdate:modelValue":e[4]||(e[4]=o=>C(v)?v.value=o:null)},{default:l(()=>[a(Y,{class:"ma-auto w-100","max-width":"400","prepend-icon":"mdi-settings"},{default:l(()=>[a(Z,null,{default:l(()=>e[12]||(e[12]=[y("Punch Out All Active Workers?")])),_:1}),a(ee,null,{default:l(()=>e[13]||(e[13]=[y("Are you Sure?")])),_:1}),a(te,null,{default:l(()=>[a(S,{class:"ms-auto",text:"Cancel",onClick:e[3]||(e[3]=o=>v.value=!1)}),a(le),a(S,{class:"ms-auto",text:"Confirm",onClick:se})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(ae,{id:"filters",class:"align-self-start d-flex w-100 flex-grow-0"},{default:l(()=>[a(A,{cols:"9",sm:"4",md:"7"},{default:l(()=>[a(Q,{id:"search",modelValue:u(b),"onUpdate:modelValue":e[5]||(e[5]=o=>C(b)?b.value=o:null),clearable:"",label:"Search",hint:"Search for tasks by name or description"},null,8,["modelValue"])]),_:1}),a(A,{cols:"3",class:"mt-2 d-flex d-sm-none"},{default:l(()=>[a(S,{variant:"tonal"},{default:l(()=>[a(X,null,{default:l(()=>e[14]||(e[14]=[y("mdi-cog")])),_:1}),a(M,{activator:"parent"},{default:l(()=>[a(K,null,{default:l(()=>[(x(!0),P(O,null,j(u(_),o=>(x(),D(q,{title:o.title,onClick:o.action},null,8,["title","onClick"]))),256))]),_:1})]),_:1})]),_:1})]),_:1}),a(A,{cols:"6",sm:"3",md:"2"},{default:l(()=>[a(pe,{clearable:"",chips:"",multiple:"",label:"Tags",modelValue:u(c),"onUpdate:modelValue":e[6]||(e[6]=o=>C(c)?c.value=o:null),items:u(re)},null,8,["modelValue","items"])]),_:1}),a(A,{cols:"6",sm:"3",md:"2",class:"d-flex align-self-start"},{default:l(()=>[a(Ve,{label:"Show All",inset:"",color:"secondary",modelValue:u(E),"onUpdate:modelValue":e[7]||(e[7]=o=>C(E)?E.value=o:null)},null,8,["modelValue"])]),_:1}),a(A,{cols:"1",class:"mt-2 d-none d-sm-flex"},{default:l(()=>[a(S,{variant:"tonal"},{default:l(()=>[a(X,null,{default:l(()=>e[15]||(e[15]=[y("mdi-cog")])),_:1}),a(M,{activator:"parent"},{default:l(()=>[a(K,null,{default:l(()=>[(x(!0),P(O,null,j(u(_),o=>(x(),D(q,{title:o.title,onClick:o.action},null,8,["title","onClick"]))),256))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(ae,{id:"main-content",align:"center",justify:"center",class:"d-flex flex-row w-100"},{default:l(()=>[(x(!0),P(O,null,j(u(ie),o=>(x(),D(n,{task:o,anumber:u(i),working:u(k)[o.ID],selected:u(s)==o.ID,onSelect:R},null,8,["task","anumber","working","selected"]))),256)),a(A,{cols:"12"},{default:l(()=>[a(S,{class:Oe(["bigbutton",{selected:u(s)==0}]),variant:"tonal",onClick:e[8]||(e[8]=o=>R(0))},{default:l(()=>e[16]||(e[16]=[y(" Not Tracking Time ")])),_:1},8,["class"])]),_:1})]),_:1})]),_:1}),a(be,{modelValue:u(m),"onUpdate:modelValue":e[9]||(e[9]=o=>C(m)?m.value=o:null),timeout:"2000",location:"top",color:u(h)},{default:l(()=>[y(Le(u(p)),1)]),_:1},8,["modelValue","color"])],64)}}});export{qe as default};
