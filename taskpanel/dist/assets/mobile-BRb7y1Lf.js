import{V as E,a as M,_ as R,f as _}from"./VSwitch-B0UQB2hB.js";import{V as z,a as H}from"./VTextField-BpdqMzPS.js";import{g as b,f as F}from"./VDivider-DLQHfrc3.js";import{d as T,r as n,h as A,w as U,i as $,j as I,k as y,F as C,c as v,s as g,l as m,q as S,x as w,y as x,z as L,H as J,t as P,b as W,T as G,o as K}from"./index-CHZdWgAM.js";import{a as Q}from"./VGrid-BlS_v7Lu.js";import"./VMenu-qtkikoXf.js";const X=T({__name:"FilterSearch",props:{items:{type:Array,required:!0},focus:{type:Array,required:!1}},emits:["filter"],setup(d,{emit:h}){const a=n(""),t=n(!1),r=n([]),u=d,p=h,i=A(()=>{const s=new Set;for(const e of u.items)for(const l of e.tags)s.add(l.name);return Array.from(s)}),c=A(()=>{let s=u.items;return u.focus&&!t.value?(s=s.filter(e=>u.focus.includes(e.ID)),s.sort((e,l)=>u.focus.indexOf(e.ID)-u.focus.indexOf(l.ID))):s.sort((e,l)=>e.name.localeCompare(l.name)),r.value.length>0&&(s=s.filter(e=>e.tags.some(l=>r.value.includes(l.name)))),a.value&&(s=s.filter(e=>(e.name+e.description).toUpperCase().includes(a.value.toUpperCase()))),s});return U(c,(s,e)=>{e!=s&&p("filter",c.value)}),$(()=>{p("filter",c.value)}),(s,e)=>(y(),I(C,null,[v(b,{cols:"12",sm:"6",md:"8"},{default:g(()=>[v(z,{id:"search",modelValue:m(a),"onUpdate:modelValue":e[0]||(e[0]=l=>S(a)?a.value=l:null),clearable:"",label:"Search",hint:"Search for items by name or description"},null,8,["modelValue"])]),_:1}),v(b,{cols:"6",sm:"3",md:"2"},{default:g(()=>[v(E,{clearable:"",chips:"",multiple:"",label:"Tags",modelValue:m(r),"onUpdate:modelValue":e[1]||(e[1]=l=>S(r)?r.value=l:null),items:m(i)},null,8,["modelValue","items"])]),_:1}),v(b,{cols:"6",sm:"3",md:"2",class:"d-flex align-self-start"},{default:g(()=>[d.focus?(y(),w(M,{key:0,inset:"",label:"Show All",color:"secondary",modelValue:m(t),"onUpdate:modelValue":e[2]||(e[2]=l=>S(t)?t.value=l:null)},null,8,["modelValue"])):x("",!0)]),_:1})],64))}}),Y=T({__name:"TaskSelector",props:{tasks:{type:Array,required:!0},focus:{type:Array,required:!1},search:{type:Boolean,required:!1}},emits:["select"],setup(d,{emit:h}){const a=d,t=n(a.tasks),r=n(a.tasks),u=A(()=>{if(r.value.length==0)return-1;const i=Array.from(r.value).find(c=>c.selected);return i?i.ID:0});U(a,()=>{t.value=a.tasks,a.search||(r.value=a.tasks)});const p=i=>{r.value=i};return(i,c)=>{const s=X,e=R;return y(),w(H,{fluid:"",class:"taskpanel d-flex flex-column"},{default:g(()=>[d.search?(y(),w(F,{key:0,id:"filters",class:"align-self-start d-flex w-100 flex-grow-0"},{default:g(()=>[v(s,{items:m(t),focus:d.focus,onFilter:p},null,8,["items","focus"])]),_:1})):x("",!0),v(F,{id:"main-content",align:"center",justify:"center",class:"d-flex flex-row w-100"},{default:g(()=>[(y(!0),I(C,null,L(m(r),l=>(y(),w(e,{task:l,onSelect:D=>i.$emit("select",l.ID)},null,8,["task","onSelect"]))),256)),v(b,{cols:"12"},{default:g(()=>[v(Q,{class:J(["bigbutton",{selected:m(u)==0}]),variant:"tonal",onClick:c[0]||(c[0]=l=>i.$emit("select",0))},{default:g(()=>c[1]||(c[1]=[P(" Not Tracking Time ")])),_:1},8,["class"])]),_:1})]),_:1})]),_:1})}}});async function V(d,h){let a={};try{if(h){const t=await fetch("https://api.tesc.farm"+d,{method:"POST",credentials:"include",body:JSON.stringify(h)});t.ok?a=await t.json():console.log(t.status)}else{const t=await fetch("https://api.tesc.farm"+d);t.ok?a=await t.json():console.log(t.status)}}catch(t){console.log(t)}finally{return a}}const oe=T({__name:"mobile",setup(d){const h=n(Array.from(_));W();const a=n(!1),t=n(0),r=n(""),u=n(""),p=n(Array()),i=n(Array()),c=n(Array()),s=n(0),e=async()=>{a.value=!0;const f=Array.from(await V("/hours/working")),k={};p.value.forEach(o=>{k[o.ID]=0}),f.forEach(o=>{k[o.task_id]++,o.worker.barcode==r.value&&(t.value=o.task_id)}),p.value.forEach(o=>{o.working=k[o.ID],o.selected=o.ID==t.value}),l(),a.value=!1},l=()=>{i.value=p.value.filter(f=>f.tags.some(k=>k.name=="Management Unit"))},D=async()=>{a.value=!0,p.value=Array.from(await V("/tasks")),e(),a.value=!1},j=async()=>{const f=await V("/worker/lookup",{barcode:u.value});r.value=f.barcode},q=async f=>{let k=p.value.filter(o=>_.includes(o.ID));k.sort((o,N)=>_.indexOf(o.ID)-_.indexOf(N.ID)),s.value=f,c.value=k},O=async f=>{t.value!=f&&(t.value=f,await V("/hours/punch",{anum:u,task:f}),e())};G(()=>{j(),D()});let B;return $(()=>{u.value=localStorage.getItem("anumber"),B=setInterval(e,6e4)}),K(()=>{clearInterval(B)}),(f,k)=>{const o=Y;return y(),I(C,null,[m(s)?x("",!0):(y(),w(o,{key:0,tasks:m(i),onSelect:q},null,8,["tasks"])),m(s)?(y(),w(o,{key:1,search:"",tasks:m(c),focus:m(h),onSelect:O},null,8,["tasks","focus"])):x("",!0)],64)}}});export{oe as default};
