import{V as E,a as M,_ as R,f as _}from"./VSwitch-GAeJGqsJ.js";import{V as z,a as J}from"./VTextField-Br330yhs.js";import{g as b,f as B}from"./VDivider-CE6lxkIn.js";import{d as T,r as n,i as S,w as F,j as $,k as I,l as y,F as C,c as k,t as g,q as m,s as A,y as h,z as x,A as L,J as H,v as P,b as W,U as G,o as K}from"./index-RQMoScwB.js";import{a as Q}from"./VGrid-DvsDVF8D.js";import"./VMenu-DVZQPxnv.js";const X=T({__name:"FilterSearch",props:{items:{type:Array,required:!0},focus:{type:Array,required:!1}},emits:["filter"],setup(d,{emit:w}){const a=n(""),t=n(!1),r=n([]),u=d,p=w,i=S(()=>{const s=new Set;for(const e of u.items)for(const l of e.tags)s.add(l.name);return Array.from(s)}),c=S(()=>{let s=u.items;return u.focus&&!t.value?(s=s.filter(e=>u.focus.includes(e.ID)),s.sort((e,l)=>u.focus.indexOf(e.ID)-u.focus.indexOf(l.ID))):s.sort((e,l)=>e.name.localeCompare(l.name)),r.value.length>0&&(s=s.filter(e=>e.tags.some(l=>r.value.includes(l.name)))),a.value&&(s=s.filter(e=>(e.name+e.description).toUpperCase().includes(a.value.toUpperCase()))),s});return F(c,(s,e)=>{e!=s&&p("filter",c.value)}),$(()=>{p("filter",c.value)}),(s,e)=>(y(),I(C,null,[k(b,{cols:"12",sm:"6",md:"8"},{default:g(()=>[k(z,{id:"search",modelValue:m(a),"onUpdate:modelValue":e[0]||(e[0]=l=>A(a)?a.value=l:null),clearable:"",label:"Search",hint:"Search for items by name or description"},null,8,["modelValue"])]),_:1}),k(b,{cols:"6",sm:"3",md:"2"},{default:g(()=>[k(E,{clearable:"",chips:"",multiple:"",label:"Tags",modelValue:m(r),"onUpdate:modelValue":e[1]||(e[1]=l=>A(r)?r.value=l:null),items:m(i)},null,8,["modelValue","items"])]),_:1}),k(b,{cols:"6",sm:"3",md:"2",class:"d-flex align-self-start"},{default:g(()=>[d.focus?(y(),h(M,{key:0,inset:"",label:"Show All",color:"secondary",modelValue:m(t),"onUpdate:modelValue":e[2]||(e[2]=l=>A(t)?t.value=l:null)},null,8,["modelValue"])):x("",!0)]),_:1})],64))}}),Y=T({__name:"TaskSelector",props:{tasks:{type:Array,required:!0},focus:{type:Array,required:!1},search:{type:Boolean,required:!1}},emits:["select"],setup(d,{emit:w}){const a=d,t=n(a.tasks),r=n(a.tasks),u=S(()=>{if(r.value.length==0)return-1;const i=Array.from(r.value).find(c=>c.selected);return i?i.ID:0});F(a,()=>{t.value=a.tasks,a.search||(r.value=a.tasks)});const p=i=>{r.value=i};return(i,c)=>{const s=X,e=R;return y(),h(J,{fluid:"",class:"taskpanel d-flex flex-column align-center"},{default:g(()=>[d.search?(y(),h(B,{key:0,id:"filters",class:"align-center d-flex w-100 flex-grow-0"},{default:g(()=>[k(s,{items:m(t),focus:d.focus,onFilter:p},null,8,["items","focus"])]),_:1})):x("",!0),k(B,{id:"main-content",align:"center",justify:"center",class:"d-flex flex-row w-100"},{default:g(()=>[(y(!0),I(C,null,L(m(r),l=>(y(),h(e,{task:l,onSelect:D=>i.$emit("select",l.ID)},null,8,["task","onSelect"]))),256)),k(b,{cols:"12"},{default:g(()=>[k(Q,{class:H(["bigbutton",{selected:m(u)==0}]),variant:"tonal",onClick:c[0]||(c[0]=l=>i.$emit("select",0))},{default:g(()=>c[1]||(c[1]=[P(" Not Tracking Time ")])),_:1},8,["class"])]),_:1})]),_:1})]),_:1})}}});async function V(d,w){let a={};try{if(w){const t=await fetch("https://api.tesc.farm"+d,{method:"POST",credentials:"include",body:JSON.stringify(w)});t.ok?a=await t.json():console.log(t.status)}else{const t=await fetch("https://api.tesc.farm"+d);t.ok?a=await t.json():console.log(t.status)}}catch(t){console.log(t)}finally{return a}}const oe=T({__name:"mobile",setup(d){const w=n(Array.from(_));W();const a=n(!1),t=n(0),r=n(""),u=n(""),p=n(Array()),i=n(Array()),c=n(Array()),s=n(0),e=async()=>{a.value=!0;const f=Array.from(await V("/hours/working")),v={};p.value.forEach(o=>{v[o.ID]=0}),f.forEach(o=>{v[o.task_id]++,o.worker.barcode==r.value&&(t.value=o.task_id)}),p.value.forEach(o=>{o.working=v[o.ID],o.selected=o.ID==t.value}),l(),a.value=!1},l=()=>{i.value=p.value.filter(f=>f.tags.some(v=>v.name=="Management Unit"))},D=async()=>{a.value=!0,p.value=Array.from(await V("/tasks")),e(),a.value=!1},j=async()=>{const f=await V("/worker/lookup",{barcode:u.value});r.value=f.barcode},q=async f=>{let v=p.value.filter(o=>_.includes(o.ID));v.sort((o,N)=>_.indexOf(o.ID)-_.indexOf(N.ID)),s.value=f,c.value=v},O=async f=>{t.value!=f&&(t.value=f,await V("/hours/punch",{anum:u,task:f}),e())};G(()=>{j(),D()});let U;return $(()=>{u.value=localStorage.getItem("anumber"),U=setInterval(e,6e4)}),K(()=>{clearInterval(U)}),(f,v)=>{const o=Y;return y(),I(C,null,[m(s)?x("",!0):(y(),h(o,{key:0,tasks:m(i),onSelect:q},null,8,["tasks"])),m(s)?(y(),h(o,{key:1,search:"",tasks:m(c),focus:m(w),onSelect:O},null,8,["tasks","focus"])):x("",!0)],64)}}});export{oe as default};
