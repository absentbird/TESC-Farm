import{g as ge,p as pe,D as Ve,e as c,j as ue,I as ke,E as q,z as xe,a as be,G as U,c as l,H as he,d as ye,B as we,h as B,i as Ce,k as D,o as h,w as o,n,q as w,v as V,y as Se,b as I,l as K,F as O,s as j,t as G,x as T,J as Ee}from"./index-BnubmAt1.js";import{k as Ae,u as Ie,l as Q,m as Te,n as Pe,f as De,d as F,g as _,h as R,e as X,o as Y,V as Z,a as C,p as ee,q as te,r as le,b as Oe,c as Le,i as Ne,j as Ue}from"./VSwitch-B5cqs67c.js";import{c as Be,f as je,V as ae,a as S,d as oe,b as Fe}from"./VContainer-CGefIAz0.js";import"./tag-D__Qbvt4.js";import"./ssrBoot-D4ijSxf0.js";const ne=Ae("v-spacer","div","VSpacer"),_e=pe({fullscreen:Boolean,retainFocus:{type:Boolean,default:!0},scrollable:Boolean,...Te({origin:"center center",scrollStrategy:"block",transition:{component:Pe},zIndex:2400})},"VDialog"),se=ge()({name:"VDialog",props:_e(),emits:{"update:modelValue":u=>!0,afterEnter:()=>!0,afterLeave:()=>!0},setup(u,L){let{emit:k,slots:v}=L;const y=Ve(u,"modelValue"),{scopeId:E}=Ie(),r=c();function x(s){var b,p;const g=s.relatedTarget,f=s.target;if(g!==f&&((b=r.value)!=null&&b.contentEl)&&((p=r.value)!=null&&p.globalTop)&&![document,r.value.contentEl].includes(f)&&!r.value.contentEl.contains(f)){const d=he(r.value.contentEl);if(!d.length)return;const m=d[0],N=d[d.length-1];g===m?N.focus():m.focus()}}ue(()=>{document.removeEventListener("focusin",x)}),ke&&q(()=>y.value&&u.retainFocus,s=>{s?document.addEventListener("focusin",x):document.removeEventListener("focusin",x)},{immediate:!0});function i(){var s;k("afterEnter"),(s=r.value)!=null&&s.contentEl&&!r.value.contentEl.contains(document.activeElement)&&r.value.contentEl.focus({preventScroll:!0})}function P(){k("afterLeave")}return q(y,async s=>{var g;s||(await xe(),(g=r.value.activatorEl)==null||g.focus({preventScroll:!0}))}),be(()=>{const s=Q.filterProps(u),g=U({"aria-haspopup":"dialog"},u.activatorProps),f=U({tabindex:-1},u.contentProps);return l(Q,U({ref:r,class:["v-dialog",{"v-dialog--fullscreen":u.fullscreen,"v-dialog--scrollable":u.scrollable},u.class],style:u.style},s,{modelValue:y.value,"onUpdate:modelValue":b=>y.value=b,"aria-modal":"true",activatorProps:g,contentProps:f,height:u.fullscreen?void 0:u.height,width:u.fullscreen?void 0:u.width,maxHeight:u.fullscreen?void 0:u.maxHeight,maxWidth:u.fullscreen?void 0:u.maxWidth,role:"dialog",onAfterEnter:i,onAfterLeave:P},E),{activator:v.activator,default:function(){for(var b=arguments.length,p=new Array(b),d=0;d<b;d++)p[d]=arguments[d];return l(Be,{root:"VDialog"},{default:()=>{var m;return[(m=v.default)==null?void 0:m.call(v,...p)]}})}})}),je({},r)}}),Me=ye({__name:"mobile",setup(u){const L=we(),k=c(!1),v=c(!1),y=c(!1),E=c(!1),r=c([]),x=c(""),i=c(""),P=c(""),s=c(0),g=c("mdi-form-textbox"),f=c(!1),b=c("error"),p=c(""),d=c({}),m=c({}),N=async()=>{const a=await fetch("https://api.tesc.farm/logout",{credentials:"include"});a.ok?Ee.push("/login"):(p.value=a.statusText,f.value=!0)},re=async()=>{const a=await fetch("https://api.tesc.farm/hours/punchoutall",{credentials:"include"});a.ok||(p.value=a.statusText,f.value=!0),A(),v.value=!1,s.value=0},ie=c([{title:"Edit A#",action:()=>{k.value=!0},users:["worker","admin"]},{title:"Stop Tracking All",action:()=>{v.value=!0},users:["admin"]},{title:"Logout",action:N,users:["worker","admin"]}]),W=B(()=>{const a=L.meta.userstatus;return ie.value.filter(e=>e.users.includes(a))}),ce=B(()=>{const a=new Set;for(const e of Array.from(d.value))for(const t of e.tags)a.add(t.name);return Array.from(a)}),de=B(()=>{let a=Array.from(d.value);return E.value||(a=a.filter(e=>De.includes(e.ID))),r.value.length>0&&(a=a.filter(e=>e.tags.some(t=>r.value.includes(t.name)))),x.value&&(a=a.filter(e=>(e.name+e.description).toUpperCase().includes(x.value.toUpperCase()))),a}),H=a=>{s.value!=a&&(s.value=a,s.value>0?me(s.value):ve())},fe=async()=>{y.value=!0;try{const a=await fetch("https://api.tesc.farm/tasks");a.ok||console.log(a.status),d.value=await a.json(),d.value.forEach(e=>{m.value[e.ID]=0})}catch(a){console.log(a)}finally{A()}},A=async()=>{y.value=!0;try{const a=await fetch("https://api.tesc.farm/hours/working");a.ok||console.log(a.status),d.value.forEach(t=>{m.value[t.ID]=0}),(await a.json()).forEach(t=>{m.value[t.task_id]++,t.worker.barcode==P.value&&(s.value=t.task_id)})}catch(a){console.log(a)}finally{y.value=!1}},J=()=>{i.value!=""&&(localStorage.setItem("anumber",i.value),k.value=!1,z())},$=()=>{i.value.length==9&&i.value[0]=="A"&&!isNaN(Number(i.value.substring(1)))?g.value="mdi-check-circle":g.value="mdi-form-textbox"},me=async a=>{const e={barcode:i.value,task:a},t=await fetch("https://api.tesc.farm/hours/punch",{method:"POST",credentials:"include",body:JSON.stringify(e)});t.ok||(p.value=t.statusText,f.value=!0,console.log(t)),A()},ve=async()=>{const a={barcode:i.value},e=await fetch("https://api.tesc.farm/hours/punch",{method:"POST",credentials:"include",body:JSON.stringify(a)});e.ok||(p.value=e.statusText,f.value=!0,console.log(e)),A()},z=async()=>{const a={barcode:i.value},e=await fetch("https://api.tesc.farm/worker/lookup",{method:"POST",credentials:"include",body:JSON.stringify(a)});e.ok||console.log(e);const t=await e.json();P.value=t.barcode};let M;return Ce(()=>{i.value=localStorage.getItem("anumber"),i.value?($(),z()):k.value=!0,fe(),M=setInterval(A,6e4)}),ue(()=>{clearInterval(M)}),(a,e)=>(h(),D(O,null,[l(Fe,{fluid:"",id:"taskpanel",class:"fill-height d-flex flex-column"},{default:o(()=>[l(se,{modelValue:n(k),"onUpdate:modelValue":e[2]||(e[2]=t=>w(k)?k.value=t:null),persistent:!n(i)},{default:o(()=>[l(F,{class:"ma-auto w-100","max-width":"400","prepend-icon":"mdi-settings"},{default:o(()=>[l(_,null,{default:o(()=>e[10]||(e[10]=[V("Edit A#")])),_:1}),l(R,null,{default:o(()=>e[11]||(e[11]=[V("Set your A# to track tasks")])),_:1}),l(X,null,{default:o(()=>[l(ae,{id:"anum",ref:"anum","prepend-icon":n(g),modelValue:n(i),"onUpdate:modelValue":e[0]||(e[0]=t=>w(i)?i.value=t:null),onInput:$,onKeyup:Se(J,["enter"]),hint:"Enter the A# from your student ID",label:"A#"},null,8,["prepend-icon","modelValue"])]),_:1}),l(Y,null,{default:o(()=>[n(i)?(h(),I(S,{key:0,class:"ms-auto",text:"Close",onClick:e[1]||(e[1]=t=>k.value=!1)})):K("",!0),l(ne),l(S,{class:"ms-auto",text:"Save",onClick:J})]),_:1})]),_:1})]),_:1},8,["modelValue","persistent"]),l(se,{modelValue:n(v),"onUpdate:modelValue":e[4]||(e[4]=t=>w(v)?v.value=t:null)},{default:o(()=>[l(F,{class:"ma-auto w-100","max-width":"400","prepend-icon":"mdi-settings"},{default:o(()=>[l(_,null,{default:o(()=>e[12]||(e[12]=[V("Punch Out All Active Workers?")])),_:1}),l(R,null,{default:o(()=>e[13]||(e[13]=[V("Are you Sure?")])),_:1}),l(Y,null,{default:o(()=>[l(S,{class:"ms-auto",text:"Cancel",onClick:e[3]||(e[3]=t=>v.value=!1)}),l(ne),l(S,{class:"ms-auto",text:"Confirm",onClick:re})]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(Z,{id:"filters",class:"align-self-start d-flex w-100 flex-grow-0"},{default:o(()=>[l(C,{cols:"9",sm:"4",md:"7"},{default:o(()=>[l(ae,{id:"search",modelValue:n(x),"onUpdate:modelValue":e[5]||(e[5]=t=>w(x)?x.value=t:null),clearable:"",label:"Search",hint:"Search for tasks by name or description"},null,8,["modelValue"])]),_:1}),l(C,{cols:"3",class:"mt-2 d-flex d-sm-none"},{default:o(()=>[l(S,{variant:"tonal"},{default:o(()=>[l(oe,null,{default:o(()=>e[14]||(e[14]=[V("mdi-cog")])),_:1}),l(ee,{activator:"parent"},{default:o(()=>[l(te,null,{default:o(()=>[(h(!0),D(O,null,j(n(W),t=>(h(),I(le,{title:t.title,onClick:t.action},null,8,["title","onClick"]))),256))]),_:1})]),_:1})]),_:1})]),_:1}),l(C,{cols:"6",sm:"3",md:"2"},{default:o(()=>[l(Oe,{clearable:"",chips:"",multiple:"",label:"Tags",modelValue:n(r),"onUpdate:modelValue":e[6]||(e[6]=t=>w(r)?r.value=t:null),items:n(ce)},null,8,["modelValue","items"])]),_:1}),l(C,{cols:"6",sm:"3",md:"2",class:"d-flex align-self-start"},{default:o(()=>[l(Le,{label:"Show All",inset:"",color:"secondary",modelValue:n(E),"onUpdate:modelValue":e[7]||(e[7]=t=>w(E)?E.value=t:null)},null,8,["modelValue"])]),_:1}),l(C,{cols:"1",class:"mt-2 d-none d-sm-flex"},{default:o(()=>[l(S,{variant:"tonal"},{default:o(()=>[l(oe,null,{default:o(()=>e[15]||(e[15]=[V("mdi-cog")])),_:1}),l(ee,{activator:"parent"},{default:o(()=>[l(te,null,{default:o(()=>[(h(!0),D(O,null,j(n(W),t=>(h(),I(le,{title:t.title,onClick:t.action},null,8,["title","onClick"]))),256))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),l(Z,{align:"center",justify:"center",class:"d-flex flex-row w-100"},{default:o(()=>[(h(!0),D(O,null,j(n(de),t=>(h(),I(C,{class:"d-flex flex-column",cols:"12",sm:"4",md:"3",lg:"2"},{default:o(()=>[l(F,{class:G(["task-card d-flex flex-column text-center",{selected:n(s)==t.ID}]),variant:"tonal",onClick:Re=>H(t.ID)},{default:o(()=>[l(X,null,{default:o(()=>[l(_,null,{default:o(()=>[V(T(t.name),1)]),_:2},1024),n(m)[t.ID]?(h(),I(R,{key:0},{default:o(()=>[V(T(n(m)[t.ID])+" "+T(n(m)[t.ID]>1?"People":"Person")+" working ",1)]),_:2},1024)):K("",!0)]),_:2},1024),l(Ne,null,{default:o(()=>[V(T(t.description),1)]),_:2},1024)]),_:2},1032,["class","onClick"])]),_:2},1024))),256)),l(C,{cols:"12"},{default:o(()=>[l(S,{class:G(["bigbutton",{selected:n(s)==0}]),variant:"tonal",onClick:e[8]||(e[8]=t=>H(0))},{default:o(()=>e[16]||(e[16]=[V(" Not Tracking Time ")])),_:1},8,["class"])]),_:1})]),_:1})]),_:1}),l(Ue,{modelValue:n(f),"onUpdate:modelValue":e[9]||(e[9]=t=>w(f)?f.value=t:null),timeout:"2000",location:"top",color:n(b)},{default:o(()=>[V(T(n(p)),1)]),_:1},8,["modelValue","color"])],64))}});export{Me as default};
