import{V as H,a as z,_ as J,f as h}from"./VSwitch-CXP4H8mG.js";import{V as P}from"./VTextField-Tzad9CkG.js";import{a as w,V as $}from"./VRow-CRh7nV-r.js";import{a as A,c as j}from"./VGrid-BHrNSwev.js";import{b as W,c as G,d as K}from"./VMenu-D629rLpU.js";import{d as B,r as i,e as C,w as O,h as q,i as b,j as v,F as S,c as n,l as r,k as p,t as T,q as D,y as N,v as V,x as I,H as Q,B as X,T as Y,o as Z}from"./index-DhG7WtGS.js";import{V as ee}from"./VContainer-B7dfdjyI.js";import"./VDivider-B7X9T9Y_.js";const te=B({__name:"FilterSearch",props:{items:{type:Array,required:!0},focus:{type:Array,required:!1}},emits:["filter"],setup(g,{emit:_}){const l=i(""),t=i(!1),u=i([]),f=g,k=_,m=C(()=>{const a=new Set;for(const e of f.items)for(const s of e.tags)a.add(s.name);return Array.from(a)}),c=C(()=>{let a=f.items;return f.focus&&!t.value?(a=a.filter(e=>f.focus.includes(e.ID)),a.sort((e,s)=>f.focus.indexOf(e.ID)-f.focus.indexOf(s.ID))):a.sort((e,s)=>e.name.localeCompare(s.name)),u.value.length>0&&(a=a.filter(e=>e.tags.some(s=>u.value.includes(s.name)))),l.value&&(a=a.filter(e=>(e.name+e.description).toUpperCase().includes(l.value.toUpperCase()))),a});return O(c,(a,e)=>{e!=a&&k("filter",c.value)}),q(()=>{k("filter",c.value)}),(a,e)=>(v(),b(S,null,[n(w,{cols:"9",sm:"4",md:"7"},{default:r(()=>[n(P,{id:"search",modelValue:p(l),"onUpdate:modelValue":e[0]||(e[0]=s=>T(l)?l.value=s:null),clearable:"",label:"Search",hint:"Search for items by name or description"},null,8,["modelValue"])]),_:1}),n(w,{cols:"3",class:"mt-2 d-flex d-sm-none"},{default:r(()=>[n(A,{variant:"tonal"},{default:r(()=>[n(j,null,{default:r(()=>e[3]||(e[3]=[D("mdi-cog")])),_:1}),n(W,{activator:"parent"},{default:r(()=>[n(G,null,{default:r(()=>[(v(!0),b(S,null,N(a.userSettings,s=>(v(),V(K,{title:s.title,onClick:s.action},null,8,["title","onClick"]))),256))]),_:1})]),_:1})]),_:1})]),_:1}),n(w,{cols:"6",sm:"3",md:"2"},{default:r(()=>[n(H,{clearable:"",chips:"",multiple:"",label:"Tags",modelValue:p(u),"onUpdate:modelValue":e[1]||(e[1]=s=>T(u)?u.value=s:null),items:p(m)},null,8,["modelValue","items"])]),_:1}),n(w,{cols:"6",sm:"3",md:"2",class:"d-flex align-self-start"},{default:r(()=>[g.focus?(v(),V(z,{key:0,label:"Show All",inset:"",color:"secondary",modelValue:p(t),"onUpdate:modelValue":e[2]||(e[2]=s=>T(t)?t.value=s:null)},null,8,["modelValue"])):I("",!0)]),_:1}),n(w,{cols:"1",class:"mt-2 d-none d-sm-flex"},{default:r(()=>[n(A,{variant:"tonal"},{default:r(()=>[n(j,null,{default:r(()=>e[4]||(e[4]=[D("mdi-cog")])),_:1})]),_:1})]),_:1})],64))}}),ae=B({__name:"TaskSelector",props:{tasks:{type:Array,required:!0},search:{type:Boolean,required:!1}},emits:["select"],setup(g,{emit:_}){const l=g,t=i(l.tasks),u=i(l.tasks),f=C(()=>{if(u.value.length==0)return-1;const m=Array.from(u.value).find(c=>c.selected);return m?m.ID:0});O(l,()=>{t.value=l.tasks,l.search||(u.value=l.tasks)});const k=m=>{u.value=m};return(m,c)=>{const a=te,e=J;return v(),V(ee,{fluid:"",class:"taskpanel fill-height d-flex flex-column"},{default:r(()=>[g.search?(v(),V($,{key:0,id:"filters",class:"align-self-start d-flex w-100 flex-grow-0"},{default:r(()=>[n(a,{items:p(t),onFilter:k},null,8,["items"])]),_:1})):I("",!0),n($,{id:"main-content",align:"center",justify:"center",class:"d-flex flex-row w-100"},{default:r(()=>[(v(!0),b(S,null,N(p(u),s=>(v(),V(e,{task:s,onSelect:F=>m.$emit("select",s.ID)},null,8,["task","onSelect"]))),256)),n(w,{cols:"12"},{default:r(()=>[n(A,{class:Q(["bigbutton",{selected:p(f)==0}]),variant:"tonal",onClick:c[0]||(c[0]=s=>m.$emit("select",0))},{default:r(()=>c[1]||(c[1]=[D(" Not Tracking Time ")])),_:1},8,["class"])]),_:1})]),_:1})]),_:1})}}});async function x(g,_){let l={};try{if(_){const t=await fetch("https://api.tesc.farm"+g,{method:"POST",credentials:"include",body:JSON.stringify(_)});t.ok?l=await t.json():console.log(t.status)}else{const t=await fetch("https://api.tesc.farm"+g);t.ok?l=await t.json():console.log(t.status)}}catch(t){console.log(t)}finally{return l}}const fe=B({__name:"mobile",setup(g){const _=i(Array.from(h));X();const l=i(!1),t=i(0),u=i(""),f=i(""),k=i(Array()),m=i(Array()),c=i(Array()),a=i(0),e=async()=>{l.value=!0;const d=Array.from(await x("/hours/working")),y={};k.value.forEach(o=>{y[o.ID]=0}),d.forEach(o=>{y[o.task_id]++,o.worker.barcode==u.value&&(t.value=o.task_id)}),k.value.forEach(o=>{o.working=y[o.ID],o.selected=o.ID==t.value}),s(),l.value=!1},s=()=>{m.value=k.value.filter(d=>d.tags.some(y=>y.name=="Management Unit"))},F=async()=>{l.value=!0,k.value=Array.from(await x("/tasks")),e(),l.value=!1},E=async()=>{const d=await x("/worker/lookup",{barcode:f.value});u.value=d.barcode},L=async d=>{let y=k.value.filter(o=>h.includes(o.ID));y.sort((o,R)=>h.indexOf(o.ID)-h.indexOf(R.ID)),a.value=d,c.value=y},M=async d=>{t.value!=d&&(t.value=d,await x("/hours/punch",{anum:f,task:d}),e())};Y(()=>{E(),F()});let U;return q(()=>{f.value=localStorage.getItem("anumber"),U=setInterval(e,6e4)}),Z(()=>{clearInterval(U)}),(d,y)=>{const o=ae;return v(),b(S,null,[p(a)?I("",!0):(v(),V(o,{key:0,tasks:p(m),onSelect:L},null,8,["tasks"])),p(a)?(v(),V(o,{key:1,search:"",tasks:p(c),focus:p(_),onSelect:M},null,8,["tasks","focus"])):I("",!0)],64)}}});export{fe as default};
