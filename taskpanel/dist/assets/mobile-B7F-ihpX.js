import{e as ge,u as pe,g as $,m as ke,h as Ve,f as U,i as z,j as K,k as q,l as he,n as G,V as Q,a as I,o as X,p as Y,q as Z,b as be,c as we,_ as xe,d as ye}from"./VSwitch-4uxv29pi.js";import{g as Se,p as Ce,D as Ee,f as i,k as ne,I as Ae,E as ee,A as Ie,a as Te,G as B,c as a,H as De,d as Pe,C as Oe,J as Le,K as Ne,i as j,j as Ue,b as P,o as b,w as l,q as s,n as S,x as w,y as Be,t as O,l as je,F as L,s as F,v as Fe,z as _e,L as Re}from"./index-CfryiY3W.js";import{c as Me,f as We,V as te,a as C,d as ae,b as He}from"./VTextField-DADaczE3.js";import"./tag-DIZ9IpOV.js";import"./ssrBoot-DKVTDvFD.js";const le=ge("v-spacer","div","VSpacer"),Je=Ce({fullscreen:Boolean,retainFocus:{type:Boolean,default:!0},scrollable:Boolean,...ke({origin:"center center",scrollStrategy:"block",transition:{component:Ve},zIndex:2400})},"VDialog"),oe=Se()({name:"VDialog",props:Je(),emits:{"update:modelValue":u=>!0,afterEnter:()=>!0,afterLeave:()=>!0},setup(u,N){let{emit:E,slots:g}=N;const p=Ee(u,"modelValue"),{scopeId:T}=pe(),c=i();function V(v){var f,y;const d=v.relatedTarget,h=v.target;if(d!==h&&((f=c.value)!=null&&f.contentEl)&&((y=c.value)!=null&&y.globalTop)&&![document,c.value.contentEl].includes(h)&&!c.value.contentEl.contains(h)){const m=De(c.value.contentEl);if(!m.length)return;const k=m[0],A=m[m.length-1];d===k?A.focus():k.focus()}}ne(()=>{document.removeEventListener("focusin",V)}),Ae&&ee(()=>p.value&&u.retainFocus,v=>{v?document.addEventListener("focusin",V):document.removeEventListener("focusin",V)},{immediate:!0});function x(){var v;E("afterEnter"),(v=c.value)!=null&&v.contentEl&&!c.value.contentEl.contains(document.activeElement)&&c.value.contentEl.focus({preventScroll:!0})}function r(){E("afterLeave")}return ee(p,async v=>{var d;v||(await Ie(),(d=c.value.activatorEl)==null||d.focus({preventScroll:!0}))}),Te(()=>{const v=$.filterProps(u),d=B({"aria-haspopup":"dialog"},u.activatorProps),h=B({tabindex:-1},u.contentProps);return a($,B({ref:c,class:["v-dialog",{"v-dialog--fullscreen":u.fullscreen,"v-dialog--scrollable":u.scrollable},u.class],style:u.style},v,{modelValue:p.value,"onUpdate:modelValue":f=>p.value=f,"aria-modal":"true",activatorProps:d,contentProps:h,height:u.fullscreen?void 0:u.height,width:u.fullscreen?void 0:u.width,maxHeight:u.fullscreen?void 0:u.maxHeight,maxWidth:u.fullscreen?void 0:u.maxWidth,role:"dialog",onAfterEnter:x,onAfterLeave:r},T),{activator:g.activator,default:function(){for(var f=arguments.length,y=new Array(f),m=0;m<f;m++)y[m]=arguments[m];return a(Me,{root:"VDialog"},{default:()=>{var k;return[(k=g.default)==null?void 0:k.call(g,...y)]}})}})}),We({},c)}}),Qe=Pe({__name:"mobile",setup(u){const N=Oe(),E=Le(),g=i(!1),p=i(!1),T=i(!1),c=i(!1),V=i([]),x=i(""),r=i(""),v=i(""),d=i(0),h=i("mdi-form-textbox"),f=i(!1),y=i("error"),m=i(""),k=i({}),A=i({}),se=async()=>{const t=await fetch("https://api.tesc.farm/logout",{credentials:"include"});t.ok?Re.push("/login"):(m.value=t.statusText,f.value=!0)},ue=async()=>{const t=await fetch("https://api.tesc.farm/hours/punchoutall",{credentials:"include"});t.ok||(m.value=t.statusText,f.value=!0),D(),p.value=!1,d.value=0},re=()=>{const t=E.global.current.value.dark?"light":"dark";E.global.name.value=t,localStorage.setItem("theme",t)};Ne(()=>{localStorage.getItem("theme")!=null&&(E.global.name.value=localStorage.getItem("theme"))});const ie=i([{title:"Edit A#",action:()=>{g.value=!0},users:["worker","admin"]},{title:"Stop Tracking All",action:()=>{p.value=!0},users:["admin"]},{title:"Light/Dark Mode",action:re,users:["worker","admin"]},{title:"Logout",action:se,users:["worker","admin"]}]),_=j(()=>{const t=N.meta.userstatus;return ie.value.filter(e=>e.users.includes(t))}),ce=j(()=>{const t=new Set;for(const e of Array.from(k.value))for(const n of e.tags)t.add(n.name);return Array.from(t)}),de=j(()=>{let t=Array.from(k.value);return c.value?t.sort((e,n)=>e.name.localeCompare(n.name)):(t=t.filter(e=>U.includes(e.ID)),t.sort((e,n)=>U.indexOf(e.ID)-U.indexOf(n.ID))),V.value.length>0&&(t=t.filter(e=>e.tags.some(n=>V.value.includes(n.name)))),x.value&&(t=t.filter(e=>(e.name+e.description).toUpperCase().includes(x.value.toUpperCase()))),t}),R=t=>{d.value!=t&&(d.value=t,d.value>0?me(d.value):ve())},fe=async()=>{T.value=!0;try{const t=await fetch("https://api.tesc.farm/tasks");t.ok||console.log(t.status),k.value=await t.json(),k.value.forEach(e=>{A.value[e.ID]=0})}catch(t){console.log(t)}finally{D()}},D=async()=>{T.value=!0;try{const t=await fetch("https://api.tesc.farm/hours/working");t.ok||console.log(t.status),k.value.forEach(n=>{A.value[n.ID]=0}),(await t.json()).forEach(n=>{A.value[n.task_id]++,n.worker.barcode==v.value&&(d.value=n.task_id)})}catch(t){console.log(t)}finally{T.value=!1}},M=()=>{r.value!=""&&(localStorage.setItem("anumber",r.value),g.value=!1,H())},W=()=>{r.value.length==9&&r.value[0]=="A"&&!isNaN(Number(r.value.substring(1)))?h.value="mdi-check-circle":h.value="mdi-form-textbox"},me=async t=>{const e={barcode:r.value,task:t},n=await fetch("https://api.tesc.farm/hours/punch",{method:"POST",credentials:"include",body:JSON.stringify(e)});n.ok||(m.value=n.statusText,f.value=!0,console.log(n)),D()},ve=async()=>{const t={barcode:r.value},e=await fetch("https://api.tesc.farm/hours/punch",{method:"POST",credentials:"include",body:JSON.stringify(t)});e.ok||(m.value=e.statusText,f.value=!0,console.log(e)),D()},H=async()=>{const t={barcode:r.value},e=await fetch("https://api.tesc.farm/worker/lookup",{method:"POST",credentials:"include",body:JSON.stringify(t)});e.ok||console.log(e);const n=await e.json();v.value=n.barcode};let J;return Ue(()=>{r.value=localStorage.getItem("anumber"),r.value?(W(),H()):g.value=!0,fe(),J=setInterval(D,6e4)}),ne(()=>{clearInterval(J)}),(t,e)=>{const n=xe;return b(),P(L,null,[a(He,{fluid:"",id:"taskpanel",class:"fill-height d-flex flex-column"},{default:l(()=>[a(oe,{modelValue:s(g),"onUpdate:modelValue":e[2]||(e[2]=o=>S(g)?g.value=o:null),persistent:!s(r)},{default:l(()=>[a(z,{class:"ma-auto w-100","max-width":"400","prepend-icon":"mdi-settings"},{default:l(()=>[a(K,null,{default:l(()=>e[10]||(e[10]=[w("Edit A#")])),_:1}),a(q,null,{default:l(()=>e[11]||(e[11]=[w("Set your A# to track tasks")])),_:1}),a(he,null,{default:l(()=>[a(te,{id:"anum",ref:"anum","prepend-icon":s(h),modelValue:s(r),"onUpdate:modelValue":e[0]||(e[0]=o=>S(r)?r.value=o:null),onInput:W,onKeyup:Be(M,["enter"]),hint:"Enter the A# from your student ID",label:"A#"},null,8,["prepend-icon","modelValue"])]),_:1}),a(G,null,{default:l(()=>[s(r)?(b(),O(C,{key:0,class:"ms-auto",text:"Close",onClick:e[1]||(e[1]=o=>g.value=!1)})):je("",!0),a(le),a(C,{class:"ms-auto",text:"Save",onClick:M})]),_:1})]),_:1})]),_:1},8,["modelValue","persistent"]),a(oe,{modelValue:s(p),"onUpdate:modelValue":e[4]||(e[4]=o=>S(p)?p.value=o:null)},{default:l(()=>[a(z,{class:"ma-auto w-100","max-width":"400","prepend-icon":"mdi-settings"},{default:l(()=>[a(K,null,{default:l(()=>e[12]||(e[12]=[w("Punch Out All Active Workers?")])),_:1}),a(q,null,{default:l(()=>e[13]||(e[13]=[w("Are you Sure?")])),_:1}),a(G,null,{default:l(()=>[a(C,{class:"ms-auto",text:"Cancel",onClick:e[3]||(e[3]=o=>p.value=!1)}),a(le),a(C,{class:"ms-auto",text:"Confirm",onClick:ue})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(Q,{id:"filters",class:"align-self-start d-flex w-100 flex-grow-0"},{default:l(()=>[a(I,{cols:"9",sm:"4",md:"7"},{default:l(()=>[a(te,{id:"search",modelValue:s(x),"onUpdate:modelValue":e[5]||(e[5]=o=>S(x)?x.value=o:null),clearable:"",label:"Search",hint:"Search for tasks by name or description"},null,8,["modelValue"])]),_:1}),a(I,{cols:"3",class:"mt-2 d-flex d-sm-none"},{default:l(()=>[a(C,{variant:"tonal"},{default:l(()=>[a(ae,null,{default:l(()=>e[14]||(e[14]=[w("mdi-cog")])),_:1}),a(X,{activator:"parent"},{default:l(()=>[a(Y,null,{default:l(()=>[(b(!0),P(L,null,F(s(_),o=>(b(),O(Z,{title:o.title,onClick:o.action},null,8,["title","onClick"]))),256))]),_:1})]),_:1})]),_:1})]),_:1}),a(I,{cols:"6",sm:"3",md:"2"},{default:l(()=>[a(be,{clearable:"",chips:"",multiple:"",label:"Tags",modelValue:s(V),"onUpdate:modelValue":e[6]||(e[6]=o=>S(V)?V.value=o:null),items:s(ce)},null,8,["modelValue","items"])]),_:1}),a(I,{cols:"6",sm:"3",md:"2",class:"d-flex align-self-start"},{default:l(()=>[a(we,{label:"Show All",inset:"",color:"secondary",modelValue:s(c),"onUpdate:modelValue":e[7]||(e[7]=o=>S(c)?c.value=o:null)},null,8,["modelValue"])]),_:1}),a(I,{cols:"1",class:"mt-2 d-none d-sm-flex"},{default:l(()=>[a(C,{variant:"tonal"},{default:l(()=>[a(ae,null,{default:l(()=>e[15]||(e[15]=[w("mdi-cog")])),_:1}),a(X,{activator:"parent"},{default:l(()=>[a(Y,null,{default:l(()=>[(b(!0),P(L,null,F(s(_),o=>(b(),O(Z,{title:o.title,onClick:o.action},null,8,["title","onClick"]))),256))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(Q,{id:"main-content",align:"center",justify:"center",class:"d-flex flex-row w-100"},{default:l(()=>[(b(!0),P(L,null,F(s(de),o=>(b(),O(n,{task:o,anumber:s(r),working:s(A)[o.ID],selected:s(d)==o.ID,onSelect:R},null,8,["task","anumber","working","selected"]))),256)),a(I,{cols:"12"},{default:l(()=>[a(C,{class:Fe(["bigbutton",{selected:s(d)==0}]),variant:"tonal",onClick:e[8]||(e[8]=o=>R(0))},{default:l(()=>e[16]||(e[16]=[w(" Not Tracking Time ")])),_:1},8,["class"])]),_:1})]),_:1})]),_:1}),a(ye,{modelValue:s(f),"onUpdate:modelValue":e[9]||(e[9]=o=>S(f)?f.value=o:null),timeout:"2000",location:"top",color:s(y)},{default:l(()=>[w(_e(s(m)),1)]),_:1},8,["modelValue","color"])],64)}}});export{Qe as default};
