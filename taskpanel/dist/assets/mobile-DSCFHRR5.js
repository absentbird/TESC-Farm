import{_ as E}from"./CardSelector.vue_vue_type_script_setup_true_lang-DKtBb_th.js";import{a as u}from"./apicall-ZcDvLpv2.js";import{d as C,T as V,r as o,U as D,j as S,o as $,k as N,l as v,c as j,y as k,z as w,t as I,q as n,v as x,F}from"./index-2V5DHb8u.js";import{l as M}from"./VMenu-CEOIS9lm.js";import{b as R}from"./VTextField-BqCknyMw.js";import"./VSwitch-CefifBqE.js";import"./VContainer-hUYed4Bj.js";const K=C({__name:"mobile",setup(U){V();const c=o(!1),l=o(0),p=o(""),i=o(""),m=o(Array()),d=o(Array()),y=o(Array()),s=o(0),f=async()=>{c.value=!0,b();const a=Array.from(await u("/hours/working")),t={},r={};m.value.forEach(e=>{t[e.ID]=0,r[e.area_id]=0}),a.forEach(e=>{t[e.task_id]++,r[e.task.area_id]++,e.worker.barcode==p.value&&(l.value=e.task_id)}),m.value.forEach(e=>{e.working=t[e.ID],e.selected=e.ID==l.value,e.selected&&d.value.forEach(g=>{g.selected=g.ID==e.area_id})}),d.value.forEach(e=>{e.working=r[e.ID]}),c.value=!1},b=async()=>{d.value=await u("/areas")},h=async()=>{c.value=!0,m.value=Array.from(await u("/tasks")),f(),c.value=!1},A=async()=>{const a=await u("/worker/lookup",{barcode:i.value});p.value=a.barcode},B=async a=>{if(a==0){l.value=0,await u("/hours/punch",{anum:i}),f();return}s.value=a;let t=m.value.filter(r=>r.area_id==s.value);y.value=t},T=async a=>{l.value!=a&&(l.value=a,await u("/hours/punch",{anum:i,task:a}),f())};D(()=>{A(),h()});let _;return S(()=>{i.value=localStorage.getItem("anumber"),_=setInterval(f,6e4)}),$(()=>{clearInterval(_)}),(a,t)=>{const r=E;return v(),N(F,null,[j(M,null,{default:I(()=>[n(s)?w("",!0):(v(),k(r,{key:0,items:n(d),newItem:a.$route.meta.userstatus=="admin"?"/areabuilder":"",timeTracking:!0,onSelect:B},null,8,["items","newItem"]))]),_:1}),n(s)?(v(),k(R,{key:0,onClick:t[0]||(t[0]=e=>s.value=0),variant:"tonal",class:"ml-7"},{default:I(()=>t[1]||(t[1]=[x("Back to Areas")])),_:1})):w("",!0),n(s)?(v(),k(r,{key:1,search:"",items:n(y),onSelect:T,newItem:a.$route.meta.userstatus=="admin"?"/taskbuilder?area="+n(s):"",timeTracking:!0,selected:n(l)},null,8,["items","newItem","selected"])):w("",!0)],64)}}});export{K as default};
