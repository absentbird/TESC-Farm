import{V as P,a as q,_ as H}from"./VSwitch-CAezTYW2.js";import{d as L,r as n,h as M,i as S,j as W,o as G,k as C,l as b,c as o,z as Q,t as i,s as g,q as s,F as U,A as X,y as Y,J as Z,v as A,x as N,H as ee,n as ae}from"./index-BqBYkQoP.js";import{l as j,n as x}from"./VMenu-Dna0TubK.js";import{a as B,b as te}from"./VTextField-DIRXKGr2.js";import{V as le}from"./VContainer-Bt1WHSop.js";import{V as se}from"./VSnackbar-DLNMXxnz.js";const I=[60,61,62,63,64,65,66,23,31,33,39,59,48,49,68,50,67,57],oe={key:0,id:"anumfloat",class:"align-self-end"},fe=L({__name:"index",setup(ne){const w=n(!1),h=n(!1),p=n([]),k=n(""),r=n(""),u=n(0),d=n("mdi-form-textbox"),c=n(!1),m=n("success"),f=n(""),v=n({}),y=n({}),D=M("anum"),E=S(()=>{const a=new Set;for(const e of Array.from(v.value))for(const t of e.tags)a.add(t.name);return Array.from(a)}),F=S(()=>{let a=Array.from(v.value);return h.value?a.sort((e,t)=>e.name.localeCompare(t.name)):(a=a.filter(e=>I.includes(e.ID)),a.sort((e,t)=>I.indexOf(e.ID)-I.indexOf(t.ID))),p.value.length>0&&(a=a.filter(e=>e.tags.some(t=>p.value.includes(t.name)))),k.value&&(a=a.filter(e=>(e.name+e.description).toUpperCase().includes(k.value.toUpperCase()))),a}),J=S(()=>u.value==0?"None":u.value<0?"Stop Tracking Time":v.value.find(a=>a.ID===u.value).name),T=a=>{u.value=a,a!=0&&ae(()=>{var e;(e=D.value)==null||e.focus()})},K=async()=>{w.value=!0;try{const a=await fetch("https://api.tesc.farm/tasks");a.ok||console.log(a.status),v.value=await a.json(),v.value.forEach(e=>{y.value[e.ID]=0})}catch(a){console.log(a)}finally{V()}},V=async()=>{w.value=!0;try{const a=await fetch("https://api.tesc.farm/hours/working");a.ok||console.log(a.status),v.value.forEach(t=>{y.value[t.ID]=0}),(await a.json()).forEach(t=>{y.value[t.task_id]++})}catch(a){console.log(a)}finally{w.value=!1}},R=async(a,e)=>{const t={barcode:a,task:e};try{const l=await fetch("https://api.tesc.farm/hours/punch",{method:"POST",credentials:"include",body:JSON.stringify(t)});l.ok?(f.value="Tracking Time!",m.value="success",c.value=!0,d.value="mdi-check-circle"):(f.value=l.statusText,m.value="error",c.value=!0,d.value="mdi-alert-circle")}catch(l){f.value=l,m.value="error",c.value=!0}finally{setTimeout(()=>{d.value="mdi-form-textbox"},3e3),V()}},$=async a=>{const e={barcode:a};try{const t=await fetch("https://api.tesc.farm/hours/punch",{method:"POST",credentials:"include",body:JSON.stringify(e)});t.ok?(f.value="Stopped Tracking Time!",m.value="success",c.value=!0,d.value="mdi-check-circle"):(f.value=t.statusText,m.value="error",c.value=!0,d.value="mdi-alert-circle")}catch(t){f.value=t,m.value="error",c.value=!0}finally{setTimeout(()=>{d.value="mdi-form-textbox"},3e3),V()}},_=()=>{r.value!=""&&(u.value==-1?$(r.value):R(r.value,u.value),r.value="")},z=a=>{r.value.length>8&&(_(),a.target.focus())};let O;return W(()=>{K(),O=setInterval(V,6e4)}),G(()=>{clearInterval(O)}),(a,e)=>{const t=H;return b(),C(U,null,[o(le,{fluid:"",id:"taskpanel",class:"fill-height d-flex flex-column withfloat"},{default:i(()=>[o(j,{id:"filters",class:"align-self-start d-flex w-100"},{default:i(()=>[o(x,{cols:"12",sm:"4",md:"8"},{default:i(()=>[o(B,{id:"search",modelValue:s(k),"onUpdate:modelValue":e[0]||(e[0]=l=>g(k)?k.value=l:null),clearable:"",label:"Search",hint:"Search for tasks by name or description"},null,8,["modelValue"])]),_:1}),o(x,{cols:"6",sm:"4",md:"2"},{default:i(()=>[o(P,{clearable:"",chips:"",multiple:"",label:"Tags",modelValue:s(p),"onUpdate:modelValue":e[1]||(e[1]=l=>g(p)?p.value=l:null),items:s(E)},null,8,["modelValue","items"])]),_:1}),o(x,{cols:"6",sm:"4",md:"2",class:"d-flex align-self-start"},{default:i(()=>[o(q,{label:"Show All",inset:"",color:"secondary",modelValue:s(h),"onUpdate:modelValue":e[2]||(e[2]=l=>g(h)?h.value=l:null)},null,8,["modelValue"])]),_:1})]),_:1}),o(j,{id:"main-content",align:"center",justify:"center",class:"d-flex flex-row w-100"},{default:i(()=>[(b(!0),C(U,null,X(s(F),l=>(b(),Y(t,{task:l,anumber:s(r),working:s(y)[l.ID],selected:s(u)==l.ID,onSelect:T},null,8,["task","anumber","working","selected"]))),256)),o(x,{cols:"12"},{default:i(()=>[o(te,{class:Z(["bigbutton",{selected:s(u)==-1}]),variant:"tonal",onClick:e[3]||(e[3]=l=>T(-1))},{default:i(()=>e[7]||(e[7]=[A(" Stop Tracking Time ")])),_:1},8,["class"])]),_:1})]),_:1})]),_:1}),s(u)?(b(),C("div",oe,[o(B,{id:"anum",ref_key:"anum",ref:D,"prepend-icon":s(d),modelValue:s(r),"onUpdate:modelValue":e[4]||(e[4]=l=>g(r)?r.value=l:null),onInput:z,onKeyup:N(_,["enter"]),onKeydown:e[5]||(e[5]=N(l=>T(0),["esc"])),hint:"Enter the A# from your student ID",label:s(J),autocomplete:"off"},null,8,["prepend-icon","modelValue","label"])])):Q("",!0),o(se,{modelValue:s(c),"onUpdate:modelValue":e[6]||(e[6]=l=>g(c)?c.value=l:null),timeout:"2000",location:"top",color:s(m)},{default:i(()=>[A(ee(s(f)),1)]),_:1},8,["modelValue","color"])],64)}}});export{fe as default};
