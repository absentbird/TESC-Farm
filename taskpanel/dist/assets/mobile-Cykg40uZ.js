import{g as Y,p as Z,D as ee,e as d,j as G,I as te,E as U,z as ae,a as le,G as N,c as l,H as ne,d as oe,f as se,h as L,i as re,b as T,o as I,w as o,n as u,q as D,v as V,y as ue,l as R,k as ie,F as ce,s as de,t as _,x as A}from"./index-BwDQ3A82.js";import{j as fe,u as me,k as $,m as ve,l as ge,f as pe,d as H,g as W,h as z,e as J,n as Ve,V as K,a as h,b as be,c as ke,i as ye}from"./VSwitch-BKQbTgEu.js";import{c as xe,f as he,V as M,a as P,d as q,b as we}from"./VContainer-DO6veFyT.js";import"./tag-o2_UV72a.js";import"./ssrBoot-But6tn7h.js";const Ce=fe("v-spacer","div","VSpacer"),Se=Z({fullscreen:Boolean,retainFocus:{type:Boolean,default:!0},scrollable:Boolean,...ve({origin:"center center",scrollStrategy:"block",transition:{component:ge},zIndex:2400})},"VDialog"),Ee=Y()({name:"VDialog",props:Se(),emits:{"update:modelValue":s=>!0,afterEnter:()=>!0,afterLeave:()=>!0},setup(s,f){let{emit:w,slots:v}=f;const m=ee(s,"modelValue"),{scopeId:b}=me(),n=d();function C(r){var p,y;const i=r.relatedTarget,k=r.target;if(i!==k&&((p=n.value)!=null&&p.contentEl)&&((y=n.value)!=null&&y.globalTop)&&![document,n.value.contentEl].includes(k)&&!n.value.contentEl.contains(k)){const c=ne(n.value.contentEl);if(!c.length)return;const x=c[0],S=c[c.length-1];i===x?S.focus():x.focus()}}G(()=>{document.removeEventListener("focusin",C)}),te&&U(()=>m.value&&s.retainFocus,r=>{r?document.addEventListener("focusin",C):document.removeEventListener("focusin",C)},{immediate:!0});function g(){var r;w("afterEnter"),(r=n.value)!=null&&r.contentEl&&!n.value.contentEl.contains(document.activeElement)&&n.value.contentEl.focus({preventScroll:!0})}function E(){w("afterLeave")}return U(m,async r=>{var i;r||(await ae(),(i=n.value.activatorEl)==null||i.focus({preventScroll:!0}))}),le(()=>{const r=$.filterProps(s),i=N({"aria-haspopup":"dialog"},s.activatorProps),k=N({tabindex:-1},s.contentProps);return l($,N({ref:n,class:["v-dialog",{"v-dialog--fullscreen":s.fullscreen,"v-dialog--scrollable":s.scrollable},s.class],style:s.style},r,{modelValue:m.value,"onUpdate:modelValue":p=>m.value=p,"aria-modal":"true",activatorProps:i,contentProps:k,height:s.fullscreen?void 0:s.height,width:s.fullscreen?void 0:s.width,maxHeight:s.fullscreen?void 0:s.maxHeight,maxWidth:s.fullscreen?void 0:s.maxWidth,role:"dialog",onAfterEnter:g,onAfterLeave:E},b),{activator:v.activator,default:function(){for(var p=arguments.length,y=new Array(p),c=0;c<p;c++)y[c]=arguments[c];return l(xe,{root:"VDialog"},{default:()=>{var x;return[(x=v.default)==null?void 0:x.call(v,...y)]}})}})}),he({},n)}}),Oe=oe({__name:"mobile",setup(s){const f=d(!1),w=d(!1),v=d(!1),m=d([]),b=d(""),n=d(""),C=d(""),g=d(0),E=d("mdi-form-textbox"),r=d({}),i=d({}),k=se("anum"),p=L(()=>{const a=new Set;for(const e of Array.from(r.value))for(const t of e.tags)a.add(t.name);return Array.from(a)}),y=L(()=>{let a=Array.from(r.value);return v.value||(a=a.filter(e=>pe.includes(e.ID))),m.value.length>0&&(a=a.filter(e=>e.tags.some(t=>m.value.includes(t.name)))),b.value&&(a=a.filter(e=>(e.name+e.description).toUpperCase().includes(b.value.toUpperCase()))),a}),c=a=>{g.value!=a&&(g.value=a,g.value>0?Q(g.value):X())},x=async()=>{w.value=!0;try{const a=await fetch("https://api.tesc.farm/tasks");a.ok||console.log(a.status),r.value=await a.json(),r.value.forEach(e=>{i.value[e.ID]=0})}catch(a){console.log(a)}finally{S()}},S=async()=>{w.value=!0;try{const a=await fetch("https://api.tesc.farm/hours/working");a.ok||console.log(a.status),r.value.forEach(t=>{i.value[t.ID]=0}),(await a.json()).forEach(t=>{i.value[t.task_id]++,t.worker.barcode==C.value&&(g.value=t.task_id)})}catch(a){console.log(a)}finally{w.value=!1}},O=()=>{n.value!=""&&(localStorage.setItem("anumber",n.value),f.value=!1,B())},j=()=>{n.value.length==9&&n.value[0]=="A"&&!isNaN(Number(n.value.substring(1)))?E.value="mdi-check-circle":E.value="mdi-form-textbox"},Q=async a=>{const e={barcode:n.value,task:a},t=await fetch("https://api.tesc.farm/hours/punch",{method:"POST",credentials:"include",body:JSON.stringify(e)});t.ok||console.log(t),S()},X=async()=>{const a={barcode:n.value},e=await fetch("https://api.tesc.farm/hours/punch",{method:"POST",credentials:"include",body:JSON.stringify(a)});e.ok||console.log(e),S()},B=async()=>{const a={barcode:n.value},e=await fetch("https://api.tesc.farm/worker/lookup",{method:"POST",credentials:"include",body:JSON.stringify(a)});e.ok||console.log(e);const t=await e.json();C.value=t.barcode};let F;return re(()=>{n.value=localStorage.getItem("anumber"),n.value?(j(),B()):f.value=!0,x(),F=setInterval(S,6e4)}),G(()=>{clearInterval(F)}),(a,e)=>(I(),T(we,{fluid:"",id:"taskpanel",class:"fill-height d-flex flex-column"},{default:o(()=>[l(Ee,{modelValue:u(f),"onUpdate:modelValue":e[2]||(e[2]=t=>D(f)?f.value=t:null),persistent:!u(n)},{default:o(()=>[l(H,{class:"ma-auto w-100","max-width":"400","prepend-icon":"mdi-settings"},{default:o(()=>[l(W,null,{default:o(()=>e[9]||(e[9]=[V("Settings")])),_:1}),l(z,null,{default:o(()=>e[10]||(e[10]=[V("Set your A# to track tasks")])),_:1}),l(J,null,{default:o(()=>[l(M,{id:"anum",ref_key:"anum",ref:k,"prepend-icon":u(E),modelValue:u(n),"onUpdate:modelValue":e[0]||(e[0]=t=>D(n)?n.value=t:null),onInput:j,onKeyup:ue(O,["enter"]),hint:"Enter the A# from your student ID",label:"A#"},null,8,["prepend-icon","modelValue"])]),_:1}),l(Ve,null,{default:o(()=>[u(n)?(I(),T(P,{key:0,class:"ms-auto",text:"Close",onClick:e[1]||(e[1]=t=>f.value=!1)})):R("",!0),l(Ce),l(P,{class:"ms-auto",text:"Save",onClick:O})]),_:1})]),_:1})]),_:1},8,["modelValue","persistent"]),l(K,{id:"filters",class:"align-self-start d-flex w-100 flex-grow-0"},{default:o(()=>[l(h,{cols:"9",sm:"4",md:"7"},{default:o(()=>[l(M,{id:"search",modelValue:u(b),"onUpdate:modelValue":e[3]||(e[3]=t=>D(b)?b.value=t:null),clearable:"",label:"Search",hint:"Search for tasks by name or description"},null,8,["modelValue"])]),_:1}),l(h,{cols:"3",class:"mt-2 d-flex d-sm-none"},{default:o(()=>[l(P,{onClick:e[4]||(e[4]=t=>f.value=!0),variant:"tonal"},{default:o(()=>[l(q,null,{default:o(()=>e[11]||(e[11]=[V("mdi-cog")])),_:1})]),_:1})]),_:1}),l(h,{cols:"6",sm:"3",md:"2"},{default:o(()=>[l(be,{clearable:"",chips:"",multiple:"",label:"Tags",modelValue:u(m),"onUpdate:modelValue":e[5]||(e[5]=t=>D(m)?m.value=t:null),items:u(p)},null,8,["modelValue","items"])]),_:1}),l(h,{cols:"6",sm:"3",md:"2",class:"d-flex align-self-start"},{default:o(()=>[l(ke,{label:"Show All",inset:"",color:"secondary",modelValue:u(v),"onUpdate:modelValue":e[6]||(e[6]=t=>D(v)?v.value=t:null)},null,8,["modelValue"])]),_:1}),l(h,{cols:"1",class:"mt-2 d-none d-sm-flex"},{default:o(()=>[l(P,{onClick:e[7]||(e[7]=t=>f.value=!0),variant:"tonal"},{default:o(()=>[l(q,null,{default:o(()=>e[12]||(e[12]=[V("mdi-cog")])),_:1})]),_:1})]),_:1})]),_:1}),l(K,{align:"center",justify:"center",class:"d-flex flex-row w-100"},{default:o(()=>[(I(!0),ie(ce,null,de(u(y),t=>(I(),T(h,{class:"d-flex flex-column",cols:"12",sm:"4",md:"3",lg:"2"},{default:o(()=>[l(H,{class:_(["task-card d-flex flex-column text-center",{selected:u(g)==t.ID}]),variant:"tonal",onClick:Ie=>c(t.ID)},{default:o(()=>[l(J,null,{default:o(()=>[l(W,null,{default:o(()=>[V(A(t.name),1)]),_:2},1024),u(i)[t.ID]?(I(),T(z,{key:0},{default:o(()=>[V(A(u(i)[t.ID])+" "+A(u(i)[t.ID]>1?"People":"Person")+" working ",1)]),_:2},1024)):R("",!0)]),_:2},1024),l(ye,null,{default:o(()=>[V(A(t.description),1)]),_:2},1024)]),_:2},1032,["class","onClick"])]),_:2},1024))),256)),l(h,{cols:"12"},{default:o(()=>[l(P,{class:_(["bigbutton",{selected:u(g)==0}]),variant:"tonal",onClick:e[8]||(e[8]=t=>c(0))},{default:o(()=>e[13]||(e[13]=[V(" Not Tracking Time ")])),_:1},8,["class"])]),_:1})]),_:1})]),_:1}))}});export{Oe as default};
