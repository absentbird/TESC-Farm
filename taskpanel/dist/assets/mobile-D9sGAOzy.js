import{g as te,p as ae,A as le,e as f,j as X,I as oe,B as _,z as ne,a as se,C as j,c as l,D as re,d as ue,f as ie,h as R,i as ce,k as N,o as C,l as O,w as o,n as u,q as S,v as y,y as de,b as B,F as $,s as fe,t as W,x as P}from"./index-CXx_Wm4A.js";import{l as me,u as ve,m as z,n as ge,o as pe,p as Ve,q as ke,e as H,g as J,h as q,f as K,b as M,r as be,j as E,V as G,a as w,s as Q,c as ye,d as he,i as xe,k as we}from"./VSwitch-CzKQYzQO.js";import"./tag-BlNMY1_B.js";const Ce=me("v-spacer","div","VSpacer"),Se=ae({fullscreen:Boolean,retainFocus:{type:Boolean,default:!0},scrollable:Boolean,...Ve({origin:"center center",scrollStrategy:"block",transition:{component:ke},zIndex:2400})},"VDialog"),Ee=te()({name:"VDialog",props:Se(),emits:{"update:modelValue":s=>!0,afterEnter:()=>!0,afterLeave:()=>!0},setup(s,T){let{emit:m,slots:k}=T;const p=le(s,"modelValue"),{scopeId:h}=ve(),r=f();function n(i){var V,x;const c=i.relatedTarget,d=i.target;if(c!==d&&((V=r.value)!=null&&V.contentEl)&&((x=r.value)!=null&&x.globalTop)&&![document,r.value.contentEl].includes(d)&&!r.value.contentEl.contains(d)){const v=re(r.value.contentEl);if(!v.length)return;const b=v[0],A=v[v.length-1];c===b?A.focus():b.focus()}}X(()=>{document.removeEventListener("focusin",n)}),oe&&_(()=>p.value&&s.retainFocus,i=>{i?document.addEventListener("focusin",n):document.removeEventListener("focusin",n)},{immediate:!0});function I(){var i;m("afterEnter"),(i=r.value)!=null&&i.contentEl&&!r.value.contentEl.contains(document.activeElement)&&r.value.contentEl.focus({preventScroll:!0})}function g(){m("afterLeave")}return _(p,async i=>{var c;i||(await ne(),(c=r.value.activatorEl)==null||c.focus({preventScroll:!0}))}),se(()=>{const i=z.filterProps(s),c=j({"aria-haspopup":"dialog"},s.activatorProps),d=j({tabindex:-1},s.contentProps);return l(z,j({ref:r,class:["v-dialog",{"v-dialog--fullscreen":s.fullscreen,"v-dialog--scrollable":s.scrollable},s.class],style:s.style},i,{modelValue:p.value,"onUpdate:modelValue":V=>p.value=V,"aria-modal":"true",activatorProps:c,contentProps:d,height:s.fullscreen?void 0:s.height,width:s.fullscreen?void 0:s.width,maxHeight:s.fullscreen?void 0:s.maxHeight,maxWidth:s.fullscreen?void 0:s.maxWidth,role:"dialog",onAfterEnter:I,onAfterLeave:g},h),{activator:k.activator,default:function(){for(var V=arguments.length,x=new Array(V),v=0;v<V;v++)x[v]=arguments[v];return l(ge,{root:"VDialog"},{default:()=>{var b;return[(b=k.default)==null?void 0:b.call(k,...x)]}})}})}),pe({},r)}}),Ie={key:0,id:"anumfloat",class:"align-self-end"},je=ue({__name:"mobile",setup(s){const T=[12,13,15,19,20,23,27,28,31,33,35,39,42,43,46,48,49,57],m=f(!1),k=f(!1),p=f(!1),h=f([]),r=f(""),n=f(""),I=f(""),g=f(0),i=f("mdi-form-textbox"),c=f({}),d=f({}),V=ie("anum"),x=R(()=>{const a=new Set;for(const e of Array.from(c.value))for(const t of e.tags)a.add(t.name);return Array.from(a)}),v=R(()=>{let a=Array.from(c.value);return p.value||(a=a.filter(e=>T.includes(e.ID))),h.value.length>0&&(a=a.filter(e=>e.tags.some(t=>h.value.includes(t.name)))),r.value&&(a=a.filter(e=>(e.name+e.description).toUpperCase().includes(r.value.toUpperCase()))),a}),b=a=>{g.value!=a&&(g.value=a,g.value>0?Z(g.value):ee())},A=async()=>{k.value=!0;try{const a=await fetch("https://json.tesc.farm/tasks");a.ok||console.log(a.status),c.value=await a.json(),c.value.forEach(e=>{d.value[e.ID]=0})}catch(a){console.log(a)}finally{D()}},D=async()=>{k.value=!0;try{const a=await fetch("https://json.tesc.farm/hours/working");a.ok||console.log(a.status),c.value.forEach(t=>{d.value[t.ID]=0}),(await a.json()).forEach(t=>{d.value[t.task_id]++,t.worker.barcode==I.value&&(g.value=t.task_id)})}catch(a){console.log(a)}finally{k.value=!1}},F=()=>{n.value!=""&&(localStorage.setItem("anumber",n.value),m.value=!1,U())},Y=a=>{n.value.length==9&&n.value[0]=="A"&&!isNaN(Number(n.value.substring(1)))?i.value="mdi-check-circle":i.value="mdi-form-textbox"},Z=async a=>{const e={barcode:n.value,task:a},t=await fetch("https://json.tesc.farm/hours/punch",{method:"POST",body:JSON.stringify(e)});t.ok||console.log(t),D()},ee=async()=>{const a={barcode:n.value},e=await fetch("https://json.tesc.farm/hours/punch",{method:"POST",body:JSON.stringify(a)});e.ok||console.log(e),D()},U=async()=>{const a={barcode:n.value},e=await fetch("https://json.tesc.farm/worker/lookup",{method:"POST",body:JSON.stringify(a)});e.ok||console.log(e);const t=await e.json();I.value=t.barcode};let L;return ce(()=>{n.value=localStorage.getItem("anumber"),console.log(n.value),n.value?U():m.value=!0,A(),L=setInterval(D,6e4)}),X(()=>{clearInterval(L)}),(a,e)=>(C(),N($,null,[l(we,{fluid:"",id:"taskpanel",class:"fill-height d-flex flex-column"},{default:o(()=>[l(Ee,{modelValue:u(m),"onUpdate:modelValue":e[2]||(e[2]=t=>S(m)?m.value=t:null),persistent:!u(n)},{default:o(()=>[l(H,{class:"ma-auto w-100","max-width":"400","prepend-icon":"mdi-settings"},{default:o(()=>[l(J,null,{default:o(()=>e[9]||(e[9]=[y("Settings")])),_:1}),l(q,null,{default:o(()=>e[10]||(e[10]=[y("Set your A# to track tasks")])),_:1}),l(K,null,{default:o(()=>[l(M,{id:"anum",ref_key:"anum",ref:V,"prepend-icon":u(i),modelValue:u(n),"onUpdate:modelValue":e[0]||(e[0]=t=>S(n)?n.value=t:null),onInput:Y,onKeyup:de(F,["enter"]),hint:"Enter the A# from your student ID",label:"A#"},null,8,["prepend-icon","modelValue"])]),_:1}),l(be,null,{default:o(()=>[u(n)?(C(),B(E,{key:0,class:"ms-auto",text:"Close",onClick:e[1]||(e[1]=t=>m.value=!1)})):O("",!0),l(Ce),l(E,{class:"ms-auto",text:"Save",onClick:F})]),_:1})]),_:1})]),_:1},8,["modelValue","persistent"]),l(G,{id:"filters",class:"align-self-start d-flex w-100"},{default:o(()=>[l(w,{cols:"10",sm:"4",md:"7"},{default:o(()=>[l(M,{id:"search",modelValue:u(r),"onUpdate:modelValue":e[3]||(e[3]=t=>S(r)?r.value=t:null),clearable:"",label:"Search",hint:"Search for tasks by name or description"},null,8,["modelValue"])]),_:1}),l(w,{cols:"1",class:"mt-2 d-flex d-sm-none"},{default:o(()=>[l(E,{onClick:e[4]||(e[4]=t=>m.value=!0),variant:"tonal"},{default:o(()=>[l(Q,null,{default:o(()=>e[11]||(e[11]=[y("mdi-cog")])),_:1})]),_:1})]),_:1}),l(w,{cols:"6",sm:"3",md:"2"},{default:o(()=>[l(ye,{clearable:"",chips:"",multiple:"",label:"Tags",modelValue:u(h),"onUpdate:modelValue":e[5]||(e[5]=t=>S(h)?h.value=t:null),items:u(x)},null,8,["modelValue","items"])]),_:1}),l(w,{cols:"6",sm:"3",md:"2",class:"d-flex align-self-start"},{default:o(()=>[l(he,{label:"Show All",inset:"",color:"secondary",modelValue:u(p),"onUpdate:modelValue":e[6]||(e[6]=t=>S(p)?p.value=t:null)},null,8,["modelValue"])]),_:1}),l(w,{cols:"1",class:"mt-2 d-none d-sm-flex"},{default:o(()=>[l(E,{onClick:e[7]||(e[7]=t=>m.value=!0),variant:"tonal"},{default:o(()=>[l(Q,null,{default:o(()=>e[12]||(e[12]=[y("mdi-cog")])),_:1})]),_:1})]),_:1})]),_:1}),l(G,{align:"center",justify:"center",class:"d-flex flex-row w-100"},{default:o(()=>[(C(!0),N($,null,fe(u(v),t=>(C(),B(w,{class:"d-flex flex-column",cols:"12",sm:"4",md:"3",lg:"2"},{default:o(()=>[l(H,{class:W(["task-card d-flex flex-column text-center",{selected:u(g)==t.ID}]),variant:"tonal",onClick:De=>b(t.ID)},{default:o(()=>[l(K,null,{default:o(()=>[l(J,null,{default:o(()=>[y(P(t.name),1)]),_:2},1024),u(d)[t.ID]?(C(),B(q,{key:0},{default:o(()=>[y(P(u(d)[t.ID])+" "+P(u(d)[t.ID]>1?"People":"Person")+" working ",1)]),_:2},1024)):O("",!0)]),_:2},1024),l(xe,null,{default:o(()=>[y(P(t.description),1)]),_:2},1024)]),_:2},1032,["class","onClick"])]),_:2},1024))),256)),l(w,{cols:"12"},{default:o(()=>[l(E,{class:W(["bigbutton",{selected:u(g)==0}]),variant:"tonal",onClick:e[8]||(e[8]=t=>b(0))},{default:o(()=>e[13]||(e[13]=[y(" Not Tracking Time ")])),_:1},8,["class"])]),_:1})]),_:1})]),_:1}),u(g)?(C(),N("div",Ie)):O("",!0)],64))}});export{je as default};
