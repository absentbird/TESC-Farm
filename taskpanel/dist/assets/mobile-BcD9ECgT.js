import{g as te,p as ae,D as le,e as c,j as Y,I as oe,E as L,z as ne,a as se,G as N,c as l,H as re,d as ue,h as R,i as ie,k as $,o as I,w as n,n as u,q as C,v as b,y as ce,b as O,l as H,F as W,s as de,t as z,x as D}from"./index-EiloU_BY.js";import{k as fe,u as me,l as J,m as ve,n as ge,f as pe,d as _,g as K,h as M,e as q,o as Ve,V as G,a as h,b as be,c as ke,i as ye,j as xe}from"./VSwitch--WJE41e7.js";import{c as he,f as we,V as Q,a as P,d as X,b as Se}from"./VContainer-Be6D-Nn5.js";import"./tag-D1tfZ5MW.js";import"./ssrBoot-DYypBNVE.js";const Ce=fe("v-spacer","div","VSpacer"),Ee=ae({fullscreen:Boolean,retainFocus:{type:Boolean,default:!0},scrollable:Boolean,...ve({origin:"center center",scrollStrategy:"block",transition:{component:ge},zIndex:2400})},"VDialog"),Ie=te()({name:"VDialog",props:Ee(),emits:{"update:modelValue":s=>!0,afterEnter:()=>!0,afterLeave:()=>!0},setup(s,m){let{emit:w,slots:g}=m;const v=le(s,"modelValue"),{scopeId:y}=me(),o=c();function S(r){var i,x;const V=r.relatedTarget,d=r.target;if(V!==d&&((i=o.value)!=null&&i.contentEl)&&((x=o.value)!=null&&x.globalTop)&&![document,o.value.contentEl].includes(d)&&!o.value.contentEl.contains(d)){const f=re(o.value.contentEl);if(!f.length)return;const k=f[0],A=f[f.length-1];V===k?A.focus():k.focus()}}Y(()=>{document.removeEventListener("focusin",S)}),oe&&L(()=>v.value&&s.retainFocus,r=>{r?document.addEventListener("focusin",S):document.removeEventListener("focusin",S)},{immediate:!0});function p(){var r;w("afterEnter"),(r=o.value)!=null&&r.contentEl&&!o.value.contentEl.contains(document.activeElement)&&o.value.contentEl.focus({preventScroll:!0})}function E(){w("afterLeave")}return L(v,async r=>{var V;r||(await ne(),(V=o.value.activatorEl)==null||V.focus({preventScroll:!0}))}),se(()=>{const r=J.filterProps(s),V=N({"aria-haspopup":"dialog"},s.activatorProps),d=N({tabindex:-1},s.contentProps);return l(J,N({ref:o,class:["v-dialog",{"v-dialog--fullscreen":s.fullscreen,"v-dialog--scrollable":s.scrollable},s.class],style:s.style},r,{modelValue:v.value,"onUpdate:modelValue":i=>v.value=i,"aria-modal":"true",activatorProps:V,contentProps:d,height:s.fullscreen?void 0:s.height,width:s.fullscreen?void 0:s.width,maxHeight:s.fullscreen?void 0:s.maxHeight,maxWidth:s.fullscreen?void 0:s.maxWidth,role:"dialog",onAfterEnter:p,onAfterLeave:E},y),{activator:g.activator,default:function(){for(var i=arguments.length,x=new Array(i),f=0;f<i;f++)x[f]=arguments[f];return l(he,{root:"VDialog"},{default:()=>{var k;return[(k=g.default)==null?void 0:k.call(g,...x)]}})}})}),we({},o)}}),Ue=ue({__name:"mobile",setup(s){const m=c(!1),w=c(!1),g=c(!1),v=c([]),y=c(""),o=c(""),S=c(""),p=c(0),E=c("mdi-form-textbox"),r=c(!1),V=c("error"),d=c({}),i=c({}),x=R(()=>{const a=new Set;for(const e of Array.from(d.value))for(const t of e.tags)a.add(t.name);return Array.from(a)}),f=R(()=>{let a=Array.from(d.value);return g.value||(a=a.filter(e=>pe.includes(e.ID))),v.value.length>0&&(a=a.filter(e=>e.tags.some(t=>v.value.includes(t.name)))),y.value&&(a=a.filter(e=>(e.name+e.description).toUpperCase().includes(y.value.toUpperCase()))),a}),k=a=>{p.value!=a&&(p.value=a,p.value>0?Z(p.value):ee())},A=async()=>{w.value=!0;try{const a=await fetch("https://api.tesc.farm/tasks");a.ok||console.log(a.status),d.value=await a.json(),d.value.forEach(e=>{i.value[e.ID]=0})}catch(a){console.log(a)}finally{T()}},T=async()=>{w.value=!0;try{const a=await fetch("https://api.tesc.farm/hours/working");a.ok||console.log(a.status),d.value.forEach(t=>{i.value[t.ID]=0}),(await a.json()).forEach(t=>{i.value[t.task_id]++,t.worker.barcode==S.value&&(p.value=t.task_id)})}catch(a){console.log(a)}finally{w.value=!1}},U=()=>{o.value!=""&&(localStorage.setItem("anumber",o.value),m.value=!1,B())},j=()=>{o.value.length==9&&o.value[0]=="A"&&!isNaN(Number(o.value.substring(1)))?E.value="mdi-check-circle":E.value="mdi-form-textbox"},Z=async a=>{const e={barcode:o.value,task:a},t=await fetch("https://api.tesc.farm/hours/punch",{method:"POST",credentials:"include",body:JSON.stringify(e)});t.ok||(r.value=!0,console.log(t)),T()},ee=async()=>{const a={barcode:o.value},e=await fetch("https://api.tesc.farm/hours/punch",{method:"POST",credentials:"include",body:JSON.stringify(a)});e.ok||(r.value=!0,console.log(e)),T()},B=async()=>{const a={barcode:o.value},e=await fetch("https://api.tesc.farm/worker/lookup",{method:"POST",credentials:"include",body:JSON.stringify(a)});e.ok||console.log(e);const t=await e.json();S.value=t.barcode};let F;return ie(()=>{o.value=localStorage.getItem("anumber"),o.value?(j(),B()):m.value=!0,A(),F=setInterval(T,6e4)}),Y(()=>{clearInterval(F)}),(a,e)=>(I(),$(W,null,[l(Se,{fluid:"",id:"taskpanel",class:"fill-height d-flex flex-column"},{default:n(()=>[l(Ie,{modelValue:u(m),"onUpdate:modelValue":e[2]||(e[2]=t=>C(m)?m.value=t:null),persistent:!u(o)},{default:n(()=>[l(_,{class:"ma-auto w-100","max-width":"400","prepend-icon":"mdi-settings"},{default:n(()=>[l(K,null,{default:n(()=>e[10]||(e[10]=[b("Settings")])),_:1}),l(M,null,{default:n(()=>e[11]||(e[11]=[b("Set your A# to track tasks")])),_:1}),l(q,null,{default:n(()=>[l(Q,{id:"anum",ref:"anum","prepend-icon":u(E),modelValue:u(o),"onUpdate:modelValue":e[0]||(e[0]=t=>C(o)?o.value=t:null),onInput:j,onKeyup:ce(U,["enter"]),hint:"Enter the A# from your student ID",label:"A#"},null,8,["prepend-icon","modelValue"])]),_:1}),l(Ve,null,{default:n(()=>[u(o)?(I(),O(P,{key:0,class:"ms-auto",text:"Close",onClick:e[1]||(e[1]=t=>m.value=!1)})):H("",!0),l(Ce),l(P,{class:"ms-auto",text:"Save",onClick:U})]),_:1})]),_:1})]),_:1},8,["modelValue","persistent"]),l(G,{id:"filters",class:"align-self-start d-flex w-100 flex-grow-0"},{default:n(()=>[l(h,{cols:"9",sm:"4",md:"7"},{default:n(()=>[l(Q,{id:"search",modelValue:u(y),"onUpdate:modelValue":e[3]||(e[3]=t=>C(y)?y.value=t:null),clearable:"",label:"Search",hint:"Search for tasks by name or description"},null,8,["modelValue"])]),_:1}),l(h,{cols:"3",class:"mt-2 d-flex d-sm-none"},{default:n(()=>[l(P,{onClick:e[4]||(e[4]=t=>m.value=!0),variant:"tonal"},{default:n(()=>[l(X,null,{default:n(()=>e[12]||(e[12]=[b("mdi-cog")])),_:1})]),_:1})]),_:1}),l(h,{cols:"6",sm:"3",md:"2"},{default:n(()=>[l(be,{clearable:"",chips:"",multiple:"",label:"Tags",modelValue:u(v),"onUpdate:modelValue":e[5]||(e[5]=t=>C(v)?v.value=t:null),items:u(x)},null,8,["modelValue","items"])]),_:1}),l(h,{cols:"6",sm:"3",md:"2",class:"d-flex align-self-start"},{default:n(()=>[l(ke,{label:"Show All",inset:"",color:"secondary",modelValue:u(g),"onUpdate:modelValue":e[6]||(e[6]=t=>C(g)?g.value=t:null)},null,8,["modelValue"])]),_:1}),l(h,{cols:"1",class:"mt-2 d-none d-sm-flex"},{default:n(()=>[l(P,{onClick:e[7]||(e[7]=t=>m.value=!0),variant:"tonal"},{default:n(()=>[l(X,null,{default:n(()=>e[13]||(e[13]=[b("mdi-cog")])),_:1})]),_:1})]),_:1})]),_:1}),l(G,{align:"center",justify:"center",class:"d-flex flex-row w-100"},{default:n(()=>[(I(!0),$(W,null,de(u(f),t=>(I(),O(h,{class:"d-flex flex-column",cols:"12",sm:"4",md:"3",lg:"2"},{default:n(()=>[l(_,{class:z(["task-card d-flex flex-column text-center",{selected:u(p)==t.ID}]),variant:"tonal",onClick:De=>k(t.ID)},{default:n(()=>[l(q,null,{default:n(()=>[l(K,null,{default:n(()=>[b(D(t.name),1)]),_:2},1024),u(i)[t.ID]?(I(),O(M,{key:0},{default:n(()=>[b(D(u(i)[t.ID])+" "+D(u(i)[t.ID]>1?"People":"Person")+" working ",1)]),_:2},1024)):H("",!0)]),_:2},1024),l(ye,null,{default:n(()=>[b(D(t.description),1)]),_:2},1024)]),_:2},1032,["class","onClick"])]),_:2},1024))),256)),l(h,{cols:"12"},{default:n(()=>[l(P,{class:z(["bigbutton",{selected:u(p)==0}]),variant:"tonal",onClick:e[8]||(e[8]=t=>k(0))},{default:n(()=>e[14]||(e[14]=[b(" Not Tracking Time ")])),_:1},8,["class"])]),_:1})]),_:1})]),_:1}),l(xe,{modelValue:u(r),"onUpdate:modelValue":e[9]||(e[9]=t=>C(r)?r.value=t:null),timeout:"2000",location:"top",color:u(V)},{default:n(()=>[b(D(a.flash),1)]),_:1},8,["modelValue","color"])],64))}});export{Ue as default};
