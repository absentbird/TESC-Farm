import{e as ve,u as ge,g as J,m as pe,h as ke,f as Ve,i as $,j as z,k as K,l as he,n as q,V as G,a as T,o as Q,p as X,q as Y,b as be,c as we,_ as ye,d as xe}from"./VSwitch-eWNpfO7o.js";import{g as Se,p as Ce,D as Ee,f as i,k as oe,I as Ae,E as Z,A as Te,a as Ie,G as U,c as a,H as Pe,d as De,C as Oe,J as Le,K as Ne,i as B,j as Ue,b as D,o as b,w as l,q as n,n as S,x as w,y as Be,t as O,l as je,F as L,s as j,v as Fe,z as _e,L as Re}from"./index-Did3IWWa.js";import{c as Me,f as We,V as ee,a as C,d as te,b as He}from"./VTextField-Cy9y6oIh.js";import"./tag-DpZfh0Wh.js";import"./ssrBoot-eRMNWCAP.js";const ae=ve("v-spacer","div","VSpacer"),Je=Ce({fullscreen:Boolean,retainFocus:{type:Boolean,default:!0},scrollable:Boolean,...pe({origin:"center center",scrollStrategy:"block",transition:{component:ke},zIndex:2400})},"VDialog"),le=Se()({name:"VDialog",props:Je(),emits:{"update:modelValue":s=>!0,afterEnter:()=>!0,afterLeave:()=>!0},setup(s,N){let{emit:E,slots:g}=N;const p=Ee(s,"modelValue"),{scopeId:I}=ge(),c=i();function V(v){var f,x;const d=v.relatedTarget,h=v.target;if(d!==h&&((f=c.value)!=null&&f.contentEl)&&((x=c.value)!=null&&x.globalTop)&&![document,c.value.contentEl].includes(h)&&!c.value.contentEl.contains(h)){const m=Pe(c.value.contentEl);if(!m.length)return;const k=m[0],A=m[m.length-1];d===k?A.focus():k.focus()}}oe(()=>{document.removeEventListener("focusin",V)}),Ae&&Z(()=>p.value&&s.retainFocus,v=>{v?document.addEventListener("focusin",V):document.removeEventListener("focusin",V)},{immediate:!0});function y(){var v;E("afterEnter"),(v=c.value)!=null&&v.contentEl&&!c.value.contentEl.contains(document.activeElement)&&c.value.contentEl.focus({preventScroll:!0})}function u(){E("afterLeave")}return Z(p,async v=>{var d;v||(await Te(),(d=c.value.activatorEl)==null||d.focus({preventScroll:!0}))}),Ie(()=>{const v=J.filterProps(s),d=U({"aria-haspopup":"dialog"},s.activatorProps),h=U({tabindex:-1},s.contentProps);return a(J,U({ref:c,class:["v-dialog",{"v-dialog--fullscreen":s.fullscreen,"v-dialog--scrollable":s.scrollable},s.class],style:s.style},v,{modelValue:p.value,"onUpdate:modelValue":f=>p.value=f,"aria-modal":"true",activatorProps:d,contentProps:h,height:s.fullscreen?void 0:s.height,width:s.fullscreen?void 0:s.width,maxHeight:s.fullscreen?void 0:s.maxHeight,maxWidth:s.fullscreen?void 0:s.maxWidth,role:"dialog",onAfterEnter:y,onAfterLeave:u},I),{activator:g.activator,default:function(){for(var f=arguments.length,x=new Array(f),m=0;m<f;m++)x[m]=arguments[m];return a(Me,{root:"VDialog"},{default:()=>{var k;return[(k=g.default)==null?void 0:k.call(g,...x)]}})}})}),We({},c)}}),Qe=De({__name:"mobile",setup(s){const N=Oe(),E=Le(),g=i(!1),p=i(!1),I=i(!1),c=i(!1),V=i([]),y=i(""),u=i(""),v=i(""),d=i(0),h=i("mdi-form-textbox"),f=i(!1),x=i("error"),m=i(""),k=i({}),A=i({}),ne=async()=>{const t=await fetch("https://api.tesc.farm/logout",{credentials:"include"});t.ok?Re.push("/login"):(m.value=t.statusText,f.value=!0)},se=async()=>{const t=await fetch("https://api.tesc.farm/hours/punchoutall",{credentials:"include"});t.ok||(m.value=t.statusText,f.value=!0),P(),p.value=!1,d.value=0},ue=()=>{const t=E.global.current.value.dark?"light":"dark";E.global.name.value=t,localStorage.setItem("theme",t)};Ne(()=>{localStorage.getItem("theme")!=null&&(E.global.name.value=localStorage.getItem("theme"))});const re=i([{title:"Edit A#",action:()=>{g.value=!0},users:["worker","admin"]},{title:"Stop Tracking All",action:()=>{p.value=!0},users:["admin"]},{title:"Light/Dark Mode",action:ue,users:["worker","admin"]},{title:"Logout",action:ne,users:["worker","admin"]}]),F=B(()=>{const t=N.meta.userstatus;return re.value.filter(e=>e.users.includes(t))}),ie=B(()=>{const t=new Set;for(const e of Array.from(k.value))for(const r of e.tags)t.add(r.name);return Array.from(t)}),ce=B(()=>{let t=Array.from(k.value);return c.value||(t=t.filter(e=>Ve.includes(e.ID))),V.value.length>0&&(t=t.filter(e=>e.tags.some(r=>V.value.includes(r.name)))),y.value&&(t=t.filter(e=>(e.name+e.description).toUpperCase().includes(y.value.toUpperCase()))),t}),_=t=>{d.value!=t&&(d.value=t,d.value>0?fe(d.value):me())},de=async()=>{I.value=!0;try{const t=await fetch("https://api.tesc.farm/tasks");t.ok||console.log(t.status),k.value=await t.json(),k.value.forEach(e=>{A.value[e.ID]=0})}catch(t){console.log(t)}finally{P()}},P=async()=>{I.value=!0;try{const t=await fetch("https://api.tesc.farm/hours/working");t.ok||console.log(t.status),k.value.forEach(r=>{A.value[r.ID]=0}),(await t.json()).forEach(r=>{A.value[r.task_id]++,r.worker.barcode==v.value&&(d.value=r.task_id)})}catch(t){console.log(t)}finally{I.value=!1}},R=()=>{u.value!=""&&(localStorage.setItem("anumber",u.value),g.value=!1,W())},M=()=>{u.value.length==9&&u.value[0]=="A"&&!isNaN(Number(u.value.substring(1)))?h.value="mdi-check-circle":h.value="mdi-form-textbox"},fe=async t=>{const e={barcode:u.value,task:t},r=await fetch("https://api.tesc.farm/hours/punch",{method:"POST",credentials:"include",body:JSON.stringify(e)});r.ok||(m.value=r.statusText,f.value=!0,console.log(r)),P()},me=async()=>{const t={barcode:u.value},e=await fetch("https://api.tesc.farm/hours/punch",{method:"POST",credentials:"include",body:JSON.stringify(t)});e.ok||(m.value=e.statusText,f.value=!0,console.log(e)),P()},W=async()=>{const t={barcode:u.value},e=await fetch("https://api.tesc.farm/worker/lookup",{method:"POST",credentials:"include",body:JSON.stringify(t)});e.ok||console.log(e);const r=await e.json();v.value=r.barcode};let H;return Ue(()=>{u.value=localStorage.getItem("anumber"),u.value?(M(),W()):g.value=!0,de(),H=setInterval(P,6e4)}),oe(()=>{clearInterval(H)}),(t,e)=>{const r=ye;return b(),D(L,null,[a(He,{fluid:"",id:"taskpanel",class:"fill-height d-flex flex-column"},{default:l(()=>[a(le,{modelValue:n(g),"onUpdate:modelValue":e[2]||(e[2]=o=>S(g)?g.value=o:null),persistent:!n(u)},{default:l(()=>[a($,{class:"ma-auto w-100","max-width":"400","prepend-icon":"mdi-settings"},{default:l(()=>[a(z,null,{default:l(()=>e[10]||(e[10]=[w("Edit A#")])),_:1}),a(K,null,{default:l(()=>e[11]||(e[11]=[w("Set your A# to track tasks")])),_:1}),a(he,null,{default:l(()=>[a(ee,{id:"anum",ref:"anum","prepend-icon":n(h),modelValue:n(u),"onUpdate:modelValue":e[0]||(e[0]=o=>S(u)?u.value=o:null),onInput:M,onKeyup:Be(R,["enter"]),hint:"Enter the A# from your student ID",label:"A#"},null,8,["prepend-icon","modelValue"])]),_:1}),a(q,null,{default:l(()=>[n(u)?(b(),O(C,{key:0,class:"ms-auto",text:"Close",onClick:e[1]||(e[1]=o=>g.value=!1)})):je("",!0),a(ae),a(C,{class:"ms-auto",text:"Save",onClick:R})]),_:1})]),_:1})]),_:1},8,["modelValue","persistent"]),a(le,{modelValue:n(p),"onUpdate:modelValue":e[4]||(e[4]=o=>S(p)?p.value=o:null)},{default:l(()=>[a($,{class:"ma-auto w-100","max-width":"400","prepend-icon":"mdi-settings"},{default:l(()=>[a(z,null,{default:l(()=>e[12]||(e[12]=[w("Punch Out All Active Workers?")])),_:1}),a(K,null,{default:l(()=>e[13]||(e[13]=[w("Are you Sure?")])),_:1}),a(q,null,{default:l(()=>[a(C,{class:"ms-auto",text:"Cancel",onClick:e[3]||(e[3]=o=>p.value=!1)}),a(ae),a(C,{class:"ms-auto",text:"Confirm",onClick:se})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(G,{id:"filters",class:"align-self-start d-flex w-100 flex-grow-0"},{default:l(()=>[a(T,{cols:"9",sm:"4",md:"7"},{default:l(()=>[a(ee,{id:"search",modelValue:n(y),"onUpdate:modelValue":e[5]||(e[5]=o=>S(y)?y.value=o:null),clearable:"",label:"Search",hint:"Search for tasks by name or description"},null,8,["modelValue"])]),_:1}),a(T,{cols:"3",class:"mt-2 d-flex d-sm-none"},{default:l(()=>[a(C,{variant:"tonal"},{default:l(()=>[a(te,null,{default:l(()=>e[14]||(e[14]=[w("mdi-cog")])),_:1}),a(Q,{activator:"parent"},{default:l(()=>[a(X,null,{default:l(()=>[(b(!0),D(L,null,j(n(F),o=>(b(),O(Y,{title:o.title,onClick:o.action},null,8,["title","onClick"]))),256))]),_:1})]),_:1})]),_:1})]),_:1}),a(T,{cols:"6",sm:"3",md:"2"},{default:l(()=>[a(be,{clearable:"",chips:"",multiple:"",label:"Tags",modelValue:n(V),"onUpdate:modelValue":e[6]||(e[6]=o=>S(V)?V.value=o:null),items:n(ie)},null,8,["modelValue","items"])]),_:1}),a(T,{cols:"6",sm:"3",md:"2",class:"d-flex align-self-start"},{default:l(()=>[a(we,{label:"Show All",inset:"",color:"secondary",modelValue:n(c),"onUpdate:modelValue":e[7]||(e[7]=o=>S(c)?c.value=o:null)},null,8,["modelValue"])]),_:1}),a(T,{cols:"1",class:"mt-2 d-none d-sm-flex"},{default:l(()=>[a(C,{variant:"tonal"},{default:l(()=>[a(te,null,{default:l(()=>e[15]||(e[15]=[w("mdi-cog")])),_:1}),a(Q,{activator:"parent"},{default:l(()=>[a(X,null,{default:l(()=>[(b(!0),D(L,null,j(n(F),o=>(b(),O(Y,{title:o.title,onClick:o.action},null,8,["title","onClick"]))),256))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(G,{id:"main-content",align:"center",justify:"center",class:"d-flex flex-row w-100"},{default:l(()=>[(b(!0),D(L,null,j(n(ce),o=>(b(),O(r,{task:o,anumber:n(u),working:n(A)[o.ID],selected:n(d)==o.ID,onSelect:_},null,8,["task","anumber","working","selected"]))),256)),a(T,{cols:"12"},{default:l(()=>[a(C,{class:Fe(["bigbutton",{selected:n(d)==0}]),variant:"tonal",onClick:e[8]||(e[8]=o=>_(0))},{default:l(()=>e[16]||(e[16]=[w(" Not Tracking Time ")])),_:1},8,["class"])]),_:1})]),_:1})]),_:1}),a(xe,{modelValue:n(f),"onUpdate:modelValue":e[9]||(e[9]=o=>S(f)?f.value=o:null),timeout:"2000",location:"top",color:n(x)},{default:l(()=>[w(_e(n(m)),1)]),_:1},8,["modelValue","color"])],64)}}});export{Qe as default};
