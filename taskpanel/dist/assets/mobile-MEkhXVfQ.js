import{g as ge,p as Ve,D as ke,f as c,k as ue,I as he,E as K,A as be,a as xe,G as _,c as a,H as we,d as ye,C as Ce,i as B,j as Se,b as P,o as x,w as o,q as n,n as y,x as V,z as Ee,t as I,l as q,F as O,s as j,e as Ae,J as Ie,v as G,y as T,K as Te}from"./index-C7V7an1Z.js";import{k as De,u as Pe,l as Q,m as Oe,n as Ne,f as Le,d as F,g as R,h as W,e as X,o as Y,V as Z,a as C,p as ee,q as te,r as ae,b as Ue,c as _e,i as Be,j as je}from"./VSwitch-CKufD-3M.js";import{c as Fe,f as Re,V as le,a as S,d as oe,b as We}from"./VContainer-2E6LMb22.js";import"./tag-BxwXB3Y_.js";import"./ssrBoot-CGkZZ8C1.js";const ne=De("v-spacer","div","VSpacer"),$e=Ve({fullscreen:Boolean,retainFocus:{type:Boolean,default:!0},scrollable:Boolean,...Oe({origin:"center center",scrollStrategy:"block",transition:{component:Ne},zIndex:2400})},"VDialog"),se=ge()({name:"VDialog",props:$e(),emits:{"update:modelValue":u=>!0,afterEnter:()=>!0,afterLeave:()=>!0},setup(u,N){let{emit:k,slots:v}=N;const w=ke(u,"modelValue"),{scopeId:E}=Pe(),i=c();function h(s){var b,g;const p=s.relatedTarget,f=s.target;if(p!==f&&((b=i.value)!=null&&b.contentEl)&&((g=i.value)!=null&&g.globalTop)&&![document,i.value.contentEl].includes(f)&&!i.value.contentEl.contains(f)){const d=we(i.value.contentEl);if(!d.length)return;const m=d[0],L=d[d.length-1];p===m?L.focus():m.focus()}}ue(()=>{document.removeEventListener("focusin",h)}),he&&K(()=>w.value&&u.retainFocus,s=>{s?document.addEventListener("focusin",h):document.removeEventListener("focusin",h)},{immediate:!0});function r(){var s;k("afterEnter"),(s=i.value)!=null&&s.contentEl&&!i.value.contentEl.contains(document.activeElement)&&i.value.contentEl.focus({preventScroll:!0})}function D(){k("afterLeave")}return K(w,async s=>{var p;s||(await be(),(p=i.value.activatorEl)==null||p.focus({preventScroll:!0}))}),xe(()=>{const s=Q.filterProps(u),p=_({"aria-haspopup":"dialog"},u.activatorProps),f=_({tabindex:-1},u.contentProps);return a(Q,_({ref:i,class:["v-dialog",{"v-dialog--fullscreen":u.fullscreen,"v-dialog--scrollable":u.scrollable},u.class],style:u.style},s,{modelValue:w.value,"onUpdate:modelValue":b=>w.value=b,"aria-modal":"true",activatorProps:p,contentProps:f,height:u.fullscreen?void 0:u.height,width:u.fullscreen?void 0:u.width,maxHeight:u.fullscreen?void 0:u.maxHeight,maxWidth:u.fullscreen?void 0:u.maxWidth,role:"dialog",onAfterEnter:r,onAfterLeave:D},E),{activator:v.activator,default:function(){for(var b=arguments.length,g=new Array(b),d=0;d<b;d++)g[d]=arguments[d];return a(Fe,{root:"VDialog"},{default:()=>{var m;return[(m=v.default)==null?void 0:m.call(v,...g)]}})}})}),Re({},i)}}),He=["href","onClick"],Ge=ye({__name:"mobile",setup(u){const N=Ce(),k=c(!1),v=c(!1),w=c(!1),E=c(!1),i=c([]),h=c(""),r=c(""),D=c(""),s=c(0),p=c("mdi-form-textbox"),f=c(!1),b=c("error"),g=c(""),d=c({}),m=c({}),L=async()=>{const l=await fetch("https://api.tesc.farm/logout",{credentials:"include"});l.ok?Te.push("/login"):(g.value=l.statusText,f.value=!0)},re=async()=>{const l=await fetch("https://api.tesc.farm/hours/punchoutall",{credentials:"include"});l.ok||(g.value=l.statusText,f.value=!0),A(),v.value=!1,s.value=0},ie=c([{title:"Edit A#",action:()=>{k.value=!0},users:["worker","admin"]},{title:"Stop Tracking All",action:()=>{v.value=!0},users:["admin"]},{title:"Logout",action:L,users:["worker","admin"]}]),$=B(()=>{const l=N.meta.userstatus;return ie.value.filter(e=>e.users.includes(l))}),ce=B(()=>{const l=new Set;for(const e of Array.from(d.value))for(const t of e.tags)l.add(t.name);return Array.from(l)}),de=B(()=>{let l=Array.from(d.value);return E.value||(l=l.filter(e=>Le.includes(e.ID))),i.value.length>0&&(l=l.filter(e=>e.tags.some(t=>i.value.includes(t.name)))),h.value&&(l=l.filter(e=>(e.name+e.description).toUpperCase().includes(h.value.toUpperCase()))),l}),U=l=>{s.value!=l&&(s.value=l,s.value>0?me(s.value):ve())},fe=async()=>{w.value=!0;try{const l=await fetch("https://api.tesc.farm/tasks");l.ok||console.log(l.status),d.value=await l.json(),d.value.forEach(e=>{m.value[e.ID]=0})}catch(l){console.log(l)}finally{A()}},A=async()=>{w.value=!0;try{const l=await fetch("https://api.tesc.farm/hours/working");l.ok||console.log(l.status),d.value.forEach(t=>{m.value[t.ID]=0}),(await l.json()).forEach(t=>{m.value[t.task_id]++,t.worker.barcode==D.value&&(s.value=t.task_id)})}catch(l){console.log(l)}finally{w.value=!1}},H=()=>{r.value!=""&&(localStorage.setItem("anumber",r.value),k.value=!1,M())},J=()=>{r.value.length==9&&r.value[0]=="A"&&!isNaN(Number(r.value.substring(1)))?p.value="mdi-check-circle":p.value="mdi-form-textbox"},me=async l=>{const e={barcode:r.value,task:l},t=await fetch("https://api.tesc.farm/hours/punch",{method:"POST",credentials:"include",body:JSON.stringify(e)});t.ok||(g.value=t.statusText,f.value=!0,console.log(t)),A()},ve=async()=>{const l={barcode:r.value},e=await fetch("https://api.tesc.farm/hours/punch",{method:"POST",credentials:"include",body:JSON.stringify(l)});e.ok||(g.value=e.statusText,f.value=!0,console.log(e)),A()},M=async()=>{const l={barcode:r.value},e=await fetch("https://api.tesc.farm/worker/lookup",{method:"POST",credentials:"include",body:JSON.stringify(l)});e.ok||console.log(e);const t=await e.json();D.value=t.barcode};let z;return Se(()=>{r.value=localStorage.getItem("anumber"),r.value?(J(),M()):k.value=!0,fe(),z=setInterval(A,6e4)}),ue(()=>{clearInterval(z)}),(l,e)=>(x(),P(O,null,[a(We,{fluid:"",id:"taskpanel",class:"fill-height d-flex flex-column"},{default:o(()=>[a(se,{modelValue:n(k),"onUpdate:modelValue":e[2]||(e[2]=t=>y(k)?k.value=t:null),persistent:!n(r)},{default:o(()=>[a(F,{class:"ma-auto w-100","max-width":"400","prepend-icon":"mdi-settings"},{default:o(()=>[a(R,null,{default:o(()=>e[10]||(e[10]=[V("Edit A#")])),_:1}),a(W,null,{default:o(()=>e[11]||(e[11]=[V("Set your A# to track tasks")])),_:1}),a(X,null,{default:o(()=>[a(le,{id:"anum",ref:"anum","prepend-icon":n(p),modelValue:n(r),"onUpdate:modelValue":e[0]||(e[0]=t=>y(r)?r.value=t:null),onInput:J,onKeyup:Ee(H,["enter"]),hint:"Enter the A# from your student ID",label:"A#"},null,8,["prepend-icon","modelValue"])]),_:1}),a(Y,null,{default:o(()=>[n(r)?(x(),I(S,{key:0,class:"ms-auto",text:"Close",onClick:e[1]||(e[1]=t=>k.value=!1)})):q("",!0),a(ne),a(S,{class:"ms-auto",text:"Save",onClick:H})]),_:1})]),_:1})]),_:1},8,["modelValue","persistent"]),a(se,{modelValue:n(v),"onUpdate:modelValue":e[4]||(e[4]=t=>y(v)?v.value=t:null)},{default:o(()=>[a(F,{class:"ma-auto w-100","max-width":"400","prepend-icon":"mdi-settings"},{default:o(()=>[a(R,null,{default:o(()=>e[12]||(e[12]=[V("Punch Out All Active Workers?")])),_:1}),a(W,null,{default:o(()=>e[13]||(e[13]=[V("Are you Sure?")])),_:1}),a(Y,null,{default:o(()=>[a(S,{class:"ms-auto",text:"Cancel",onClick:e[3]||(e[3]=t=>v.value=!1)}),a(ne),a(S,{class:"ms-auto",text:"Confirm",onClick:re})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(Z,{id:"filters",class:"align-self-start d-flex w-100 flex-grow-0"},{default:o(()=>[a(C,{cols:"9",sm:"4",md:"7"},{default:o(()=>[a(le,{id:"search",modelValue:n(h),"onUpdate:modelValue":e[5]||(e[5]=t=>y(h)?h.value=t:null),clearable:"",label:"Search",hint:"Search for tasks by name or description"},null,8,["modelValue"])]),_:1}),a(C,{cols:"3",class:"mt-2 d-flex d-sm-none"},{default:o(()=>[a(S,{variant:"tonal"},{default:o(()=>[a(oe,null,{default:o(()=>e[14]||(e[14]=[V("mdi-cog")])),_:1}),a(ee,{activator:"parent"},{default:o(()=>[a(te,null,{default:o(()=>[(x(!0),P(O,null,j(n($),t=>(x(),I(ae,{title:t.title,onClick:t.action},null,8,["title","onClick"]))),256))]),_:1})]),_:1})]),_:1})]),_:1}),a(C,{cols:"6",sm:"3",md:"2"},{default:o(()=>[a(Ue,{clearable:"",chips:"",multiple:"",label:"Tags",modelValue:n(i),"onUpdate:modelValue":e[6]||(e[6]=t=>y(i)?i.value=t:null),items:n(ce)},null,8,["modelValue","items"])]),_:1}),a(C,{cols:"6",sm:"3",md:"2",class:"d-flex align-self-start"},{default:o(()=>[a(_e,{label:"Show All",inset:"",color:"secondary",modelValue:n(E),"onUpdate:modelValue":e[7]||(e[7]=t=>y(E)?E.value=t:null)},null,8,["modelValue"])]),_:1}),a(C,{cols:"1",class:"mt-2 d-none d-sm-flex"},{default:o(()=>[a(S,{variant:"tonal"},{default:o(()=>[a(oe,null,{default:o(()=>e[15]||(e[15]=[V("mdi-cog")])),_:1}),a(ee,{activator:"parent"},{default:o(()=>[a(te,null,{default:o(()=>[(x(!0),P(O,null,j(n($),t=>(x(),I(ae,{title:t.title,onClick:t.action},null,8,["title","onClick"]))),256))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(Z,{id:"main-content",align:"center",justify:"center",class:"d-flex flex-row w-100"},{default:o(()=>[(x(!0),P(O,null,j(n(de),t=>(x(),I(C,{class:"d-flex flex-column",cols:"12",sm:"4",md:"3",lg:"2"},{default:o(()=>[Ae("a",{class:"card-button",href:"/punch/"+t.ID+"?anum="+n(r),onClick:Ie(pe=>U(t.ID),["prevent"])},[a(F,{class:G(["task-card d-flex flex-column text-center",{selected:n(s)==t.ID}]),variant:"tonal",onClick:pe=>U(t.ID)},{default:o(()=>[a(X,null,{default:o(()=>[a(R,null,{default:o(()=>[V(T(t.name),1)]),_:2},1024),n(m)[t.ID]?(x(),I(W,{key:0},{default:o(()=>[V(T(n(m)[t.ID])+" "+T(n(m)[t.ID]>1?"People":"Person")+" working ",1)]),_:2},1024)):q("",!0)]),_:2},1024),a(Be,null,{default:o(()=>[V(T(t.description),1)]),_:2},1024)]),_:2},1032,["class","onClick"])],8,He)]),_:2},1024))),256)),a(C,{cols:"12"},{default:o(()=>[a(S,{class:G(["bigbutton",{selected:n(s)==0}]),variant:"tonal",onClick:e[8]||(e[8]=t=>U(0))},{default:o(()=>e[16]||(e[16]=[V(" Not Tracking Time ")])),_:1},8,["class"])]),_:1})]),_:1})]),_:1}),a(je,{modelValue:n(f),"onUpdate:modelValue":e[9]||(e[9]=t=>y(f)?f.value=t:null),timeout:"2000",location:"top",color:n(b)},{default:o(()=>[V(T(n(g)),1)]),_:1},8,["modelValue","color"])],64))}});export{Ge as default};
