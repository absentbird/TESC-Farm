import{g as Z,p as ee,A as te,e as f,j as G,I as ae,B as U,z as le,a as oe,C as N,c as l,D as ne,d as se,f as re,h as L,i as ue,b as P,o as C,w as o,n as i,q as S,v as y,y as ie,l as R,k as ce,F as de,s as fe,t as _,x as T}from"./index-J7l29yK0.js";import{l as me,u as ve,m as $,n as ge,o as pe,p as Ve,q as ke,e as W,g as z,h as H,f as J,b as q,r as be,j as E,V as K,a as w,s as M,c as ye,d as xe,i as he,k as we}from"./VSwitch-BlTmVPIV.js";import"./tag-BAj80nAJ.js";const Ce=me("v-spacer","div","VSpacer"),Se=ee({fullscreen:Boolean,retainFocus:{type:Boolean,default:!0},scrollable:Boolean,...Ve({origin:"center center",scrollStrategy:"block",transition:{component:ke},zIndex:2400})},"VDialog"),Ee=Z()({name:"VDialog",props:Se(),emits:{"update:modelValue":n=>!0,afterEnter:()=>!0,afterLeave:()=>!0},setup(n,A){let{emit:m,slots:k}=A;const g=te(n,"modelValue"),{scopeId:x}=ve(),r=f();function s(u){var V,h;const c=u.relatedTarget,d=u.target;if(c!==d&&((V=r.value)!=null&&V.contentEl)&&((h=r.value)!=null&&h.globalTop)&&![document,r.value.contentEl].includes(d)&&!r.value.contentEl.contains(d)){const v=ne(r.value.contentEl);if(!v.length)return;const b=v[0],j=v[v.length-1];c===b?j.focus():b.focus()}}G(()=>{document.removeEventListener("focusin",s)}),ae&&U(()=>g.value&&n.retainFocus,u=>{u?document.addEventListener("focusin",s):document.removeEventListener("focusin",s)},{immediate:!0});function I(){var u;m("afterEnter"),(u=r.value)!=null&&u.contentEl&&!r.value.contentEl.contains(document.activeElement)&&r.value.contentEl.focus({preventScroll:!0})}function p(){m("afterLeave")}return U(g,async u=>{var c;u||(await le(),(c=r.value.activatorEl)==null||c.focus({preventScroll:!0}))}),oe(()=>{const u=$.filterProps(n),c=N({"aria-haspopup":"dialog"},n.activatorProps),d=N({tabindex:-1},n.contentProps);return l($,N({ref:r,class:["v-dialog",{"v-dialog--fullscreen":n.fullscreen,"v-dialog--scrollable":n.scrollable},n.class],style:n.style},u,{modelValue:g.value,"onUpdate:modelValue":V=>g.value=V,"aria-modal":"true",activatorProps:c,contentProps:d,height:n.fullscreen?void 0:n.height,width:n.fullscreen?void 0:n.width,maxHeight:n.fullscreen?void 0:n.maxHeight,maxWidth:n.fullscreen?void 0:n.maxWidth,role:"dialog",onAfterEnter:I,onAfterLeave:p},x),{activator:k.activator,default:function(){for(var V=arguments.length,h=new Array(V),v=0;v<V;v++)h[v]=arguments[v];return l(ge,{root:"VDialog"},{default:()=>{var b;return[(b=k.default)==null?void 0:b.call(k,...h)]}})}})}),pe({},r)}}),Ae=se({__name:"mobile",setup(n){const A=[12,13,15,19,20,23,27,28,31,33,35,39,42,43,46,48,49,57],m=f(!1),k=f(!1),g=f(!1),x=f([]),r=f(""),s=f(""),I=f(""),p=f(0),u=f("mdi-form-textbox"),c=f({}),d=f({}),V=re("anum"),h=L(()=>{const a=new Set;for(const e of Array.from(c.value))for(const t of e.tags)a.add(t.name);return Array.from(a)}),v=L(()=>{let a=Array.from(c.value);return g.value||(a=a.filter(e=>A.includes(e.ID))),x.value.length>0&&(a=a.filter(e=>e.tags.some(t=>x.value.includes(t.name)))),r.value&&(a=a.filter(e=>(e.name+e.description).toUpperCase().includes(r.value.toUpperCase()))),a}),b=a=>{p.value!=a&&(p.value=a,p.value>0?X(p.value):Y())},j=async()=>{k.value=!0;try{const a=await fetch("https://json.tesc.farm/tasks");a.ok||console.log(a.status),c.value=await a.json(),c.value.forEach(e=>{d.value[e.ID]=0})}catch(a){console.log(a)}finally{D()}},D=async()=>{k.value=!0;try{const a=await fetch("https://json.tesc.farm/hours/working");a.ok||console.log(a.status),c.value.forEach(t=>{d.value[t.ID]=0}),(await a.json()).forEach(t=>{d.value[t.task_id]++,t.worker.barcode==I.value&&(p.value=t.task_id)})}catch(a){console.log(a)}finally{k.value=!1}},O=()=>{s.value!=""&&(localStorage.setItem("anumber",s.value),m.value=!1,B())},Q=a=>{s.value.length==9&&s.value[0]=="A"&&!isNaN(Number(s.value.substring(1)))?u.value="mdi-check-circle":u.value="mdi-form-textbox"},X=async a=>{const e={barcode:s.value,task:a},t=await fetch("https://json.tesc.farm/hours/punch",{method:"POST",body:JSON.stringify(e)});t.ok||console.log(t),D()},Y=async()=>{const a={barcode:s.value},e=await fetch("https://json.tesc.farm/hours/punch",{method:"POST",body:JSON.stringify(a)});e.ok||console.log(e),D()},B=async()=>{const a={barcode:s.value},e=await fetch("https://json.tesc.farm/worker/lookup",{method:"POST",body:JSON.stringify(a)});e.ok||console.log(e);const t=await e.json();I.value=t.barcode};let F;return ue(()=>{s.value=localStorage.getItem("anumber"),s.value?B():m.value=!0,j(),F=setInterval(D,6e4)}),G(()=>{clearInterval(F)}),(a,e)=>(C(),P(we,{fluid:"",id:"taskpanel",class:"fill-height d-flex flex-column"},{default:o(()=>[l(Ee,{modelValue:i(m),"onUpdate:modelValue":e[2]||(e[2]=t=>S(m)?m.value=t:null),persistent:!i(s)},{default:o(()=>[l(W,{class:"ma-auto w-100","max-width":"400","prepend-icon":"mdi-settings"},{default:o(()=>[l(z,null,{default:o(()=>e[9]||(e[9]=[y("Settings")])),_:1}),l(H,null,{default:o(()=>e[10]||(e[10]=[y("Set your A# to track tasks")])),_:1}),l(J,null,{default:o(()=>[l(q,{id:"anum",ref_key:"anum",ref:V,"prepend-icon":i(u),modelValue:i(s),"onUpdate:modelValue":e[0]||(e[0]=t=>S(s)?s.value=t:null),onInput:Q,onKeyup:ie(O,["enter"]),hint:"Enter the A# from your student ID",label:"A#"},null,8,["prepend-icon","modelValue"])]),_:1}),l(be,null,{default:o(()=>[i(s)?(C(),P(E,{key:0,class:"ms-auto",text:"Close",onClick:e[1]||(e[1]=t=>m.value=!1)})):R("",!0),l(Ce),l(E,{class:"ms-auto",text:"Save",onClick:O})]),_:1})]),_:1})]),_:1},8,["modelValue","persistent"]),l(K,{id:"filters",class:"align-self-start d-flex w-100 flex-grow-0"},{default:o(()=>[l(w,{cols:"9",sm:"4",md:"7"},{default:o(()=>[l(q,{id:"search",modelValue:i(r),"onUpdate:modelValue":e[3]||(e[3]=t=>S(r)?r.value=t:null),clearable:"",label:"Search",hint:"Search for tasks by name or description"},null,8,["modelValue"])]),_:1}),l(w,{cols:"3",class:"mt-2 d-flex d-sm-none"},{default:o(()=>[l(E,{onClick:e[4]||(e[4]=t=>m.value=!0),variant:"tonal"},{default:o(()=>[l(M,null,{default:o(()=>e[11]||(e[11]=[y("mdi-cog")])),_:1})]),_:1})]),_:1}),l(w,{cols:"6",sm:"3",md:"2"},{default:o(()=>[l(ye,{clearable:"",chips:"",multiple:"",label:"Tags",modelValue:i(x),"onUpdate:modelValue":e[5]||(e[5]=t=>S(x)?x.value=t:null),items:i(h)},null,8,["modelValue","items"])]),_:1}),l(w,{cols:"6",sm:"3",md:"2",class:"d-flex align-self-start"},{default:o(()=>[l(xe,{label:"Show All",inset:"",color:"secondary",modelValue:i(g),"onUpdate:modelValue":e[6]||(e[6]=t=>S(g)?g.value=t:null)},null,8,["modelValue"])]),_:1}),l(w,{cols:"1",class:"mt-2 d-none d-sm-flex"},{default:o(()=>[l(E,{onClick:e[7]||(e[7]=t=>m.value=!0),variant:"tonal"},{default:o(()=>[l(M,null,{default:o(()=>e[12]||(e[12]=[y("mdi-cog")])),_:1})]),_:1})]),_:1})]),_:1}),l(K,{align:"center",justify:"center",class:"d-flex flex-row w-100"},{default:o(()=>[(C(!0),ce(de,null,fe(i(v),t=>(C(),P(w,{class:"d-flex flex-column",cols:"12",sm:"4",md:"3",lg:"2"},{default:o(()=>[l(W,{class:_(["task-card d-flex flex-column text-center",{selected:i(p)==t.ID}]),variant:"tonal",onClick:Ie=>b(t.ID)},{default:o(()=>[l(J,null,{default:o(()=>[l(z,null,{default:o(()=>[y(T(t.name),1)]),_:2},1024),i(d)[t.ID]?(C(),P(H,{key:0},{default:o(()=>[y(T(i(d)[t.ID])+" "+T(i(d)[t.ID]>1?"People":"Person")+" working ",1)]),_:2},1024)):R("",!0)]),_:2},1024),l(he,null,{default:o(()=>[y(T(t.description),1)]),_:2},1024)]),_:2},1032,["class","onClick"])]),_:2},1024))),256)),l(w,{cols:"12"},{default:o(()=>[l(E,{class:_(["bigbutton",{selected:i(p)==0}]),variant:"tonal",onClick:e[8]||(e[8]=t=>b(0))},{default:o(()=>e[13]||(e[13]=[y(" Not Tracking Time ")])),_:1},8,["class"])]),_:1})]),_:1})]),_:1}))}});export{Ae as default};
