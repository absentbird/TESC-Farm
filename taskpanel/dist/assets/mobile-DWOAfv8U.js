import{e as ge,u as pe,g as $,m as ke,h as Ve,f as B,i as z,j as K,k as q,l as he,n as G,V as Q,a as A,o as X,p as Y,q as Z,b as be,c as we,_ as xe,d as ye}from"./VSwitch-DtQOQ_Bf.js";import{g as Se,p as Ce,D as Ee,f as i,k as ne,I as Ie,E as ee,A as Ae,a as Te,G as j,c as a,H as De,d as Pe,C as Oe,J as Le,K as Ne,i as F,j as Ue,b as P,o as b,w as l,q as u,n as S,x as w,y as Be,t as O,l as je,F as L,s as _,v as Fe,z as _e,L as Me}from"./index-BQTjwA9g.js";import{c as Re,f as We,V as te,a as C,d as ae,b as He}from"./VTextField-CqnGSVSr.js";import"./tag-BShUIVGr.js";import"./ssrBoot-BJ0gsDiV.js";const le=ge("v-spacer","div","VSpacer"),Je=Ce({fullscreen:Boolean,retainFocus:{type:Boolean,default:!0},scrollable:Boolean,...ke({origin:"center center",scrollStrategy:"block",transition:{component:Ve},zIndex:2400})},"VDialog"),oe=Se()({name:"VDialog",props:Je(),emits:{"update:modelValue":r=>!0,afterEnter:()=>!0,afterLeave:()=>!0},setup(r,N){let{emit:E,slots:g}=N;const p=Ee(r,"modelValue"),{scopeId:T}=pe(),c=i();function V(v){var f,y;const d=v.relatedTarget,h=v.target;if(d!==h&&((f=c.value)!=null&&f.contentEl)&&((y=c.value)!=null&&y.globalTop)&&![document,c.value.contentEl].includes(h)&&!c.value.contentEl.contains(h)){const m=De(c.value.contentEl);if(!m.length)return;const k=m[0],I=m[m.length-1];d===k?I.focus():k.focus()}}ne(()=>{document.removeEventListener("focusin",V)}),Ie&&ee(()=>p.value&&r.retainFocus,v=>{v?document.addEventListener("focusin",V):document.removeEventListener("focusin",V)},{immediate:!0});function x(){var v;E("afterEnter"),(v=c.value)!=null&&v.contentEl&&!c.value.contentEl.contains(document.activeElement)&&c.value.contentEl.focus({preventScroll:!0})}function s(){E("afterLeave")}return ee(p,async v=>{var d;v||(await Ae(),(d=c.value.activatorEl)==null||d.focus({preventScroll:!0}))}),Te(()=>{const v=$.filterProps(r),d=j({"aria-haspopup":"dialog"},r.activatorProps),h=j({tabindex:-1},r.contentProps);return a($,j({ref:c,class:["v-dialog",{"v-dialog--fullscreen":r.fullscreen,"v-dialog--scrollable":r.scrollable},r.class],style:r.style},v,{modelValue:p.value,"onUpdate:modelValue":f=>p.value=f,"aria-modal":"true",activatorProps:d,contentProps:h,height:r.fullscreen?void 0:r.height,width:r.fullscreen?void 0:r.width,maxHeight:r.fullscreen?void 0:r.maxHeight,maxWidth:r.fullscreen?void 0:r.maxWidth,role:"dialog",onAfterEnter:x,onAfterLeave:s},T),{activator:g.activator,default:function(){for(var f=arguments.length,y=new Array(f),m=0;m<f;m++)y[m]=arguments[m];return a(Re,{root:"VDialog"},{default:()=>{var k;return[(k=g.default)==null?void 0:k.call(g,...y)]}})}})}),We({},c)}}),Qe=Pe({__name:"mobile",setup(r){const N=Oe(),E=Le(),g=i(!1),p=i(!1),T=i(!1),c=i(!1),V=i([]),x=i(""),s=i(""),v=i(""),d=i(0),h=i("mdi-form-textbox"),f=i(!1),y=i("error"),m=i(""),k=i({}),I=i({}),se=async()=>{const t=await fetch("https://api.tesc.farm/logout",{credentials:"include"});t.ok?Me.push("/login"):(m.value=t.statusText,f.value=!0)},ue=async()=>{const t=await fetch("https://api.tesc.farm/hours/punchoutall",{credentials:"include"});t.ok||(m.value=t.statusText,f.value=!0),D(),p.value=!1,d.value=0},re=()=>{const t=E.global.current.value.dark?"light":"dark";E.global.name.value=t,localStorage.setItem("theme",t)};Ne(()=>{localStorage.getItem("theme")!=null&&(E.global.name.value=localStorage.getItem("theme"))});const ie=i([{title:"Edit A#",action:()=>{g.value=!0},users:["worker","admin"]},{title:"Stop Tracking All",action:()=>{p.value=!0},users:["admin"]},{title:"Light/Dark Mode",action:re,users:["worker","admin"]},{title:"Logout",action:se,users:["worker","admin"]}]),M=F(()=>{const t=N.meta.userstatus;return ie.value.filter(e=>e.users.includes(t))}),ce=F(()=>{const t=new Set;for(const e of Array.from(k.value))for(const n of e.tags)t.add(n.name);return Array.from(t)}),de=F(()=>{let t=Array.from(k.value);return c.value?t.sort((e,n)=>e.name.localeCompare(n.name)):(t=t.filter(e=>B.includes(e.ID)),t.sort((e,n)=>B.indexOf(e.ID)-B.indexOf(n.ID))),V.value.length>0&&(t=t.filter(e=>e.tags.some(n=>V.value.includes(n.name)))),x.value&&(t=t.filter(e=>(e.name+e.description).toUpperCase().includes(x.value.toUpperCase()))),t}),R=t=>{d.value!=t&&(d.value=t,d.value>0?me(d.value):ve())},fe=async()=>{T.value=!0;try{const t=await fetch("https://api.tesc.farm/tasks");t.ok||console.log(t.status),k.value=await t.json(),k.value.forEach(e=>{I.value[e.ID]=0})}catch(t){console.log(t)}finally{D()}},D=async()=>{T.value=!0;try{const t=await fetch("https://api.tesc.farm/hours/working");t.ok||console.log(t.status),k.value.forEach(n=>{I.value[n.ID]=0}),(await t.json()).forEach(n=>{I.value[n.task_id]++,n.worker.barcode==v.value&&(d.value=n.task_id)})}catch(t){console.log(t)}finally{T.value=!1}},W=()=>{s.value!=""&&(localStorage.setItem("anumber",s.value),g.value=!1,U())},H=()=>{s.value.length==9&&s.value[0]=="A"&&!isNaN(Number(s.value.substring(1)))?h.value="mdi-check-circle":h.value="mdi-form-textbox"},me=async t=>{const e={barcode:s.value,task:t},n=await fetch("https://api.tesc.farm/hours/punch",{method:"POST",credentials:"include",body:JSON.stringify(e)});n.ok||(m.value=n.statusText,f.value=!0,console.log(n)),D()},ve=async()=>{const t={barcode:s.value},e=await fetch("https://api.tesc.farm/hours/punch",{method:"POST",credentials:"include",body:JSON.stringify(t)});e.ok||(m.value=e.statusText,f.value=!0,console.log(e)),D()},U=async()=>{const t={barcode:s.value},e=await fetch("https://api.tesc.farm/worker/lookup",{method:"POST",credentials:"include",body:JSON.stringify(t)});e.ok||console.log(e);const n=await e.json();v.value=n.barcode};let J;return Ue(()=>{s.value=localStorage.getItem("anumber"),s.value?(H(),U()):(s.value=Math.floor(Math.random()*1e9),localStorage.setItem("anumber",s.value),g.value=!1,U()),fe(),J=setInterval(D,6e4)}),ne(()=>{clearInterval(J)}),(t,e)=>{const n=xe;return b(),P(L,null,[a(He,{fluid:"",id:"taskpanel",class:"fill-height d-flex flex-column"},{default:l(()=>[a(oe,{modelValue:u(g),"onUpdate:modelValue":e[2]||(e[2]=o=>S(g)?g.value=o:null),persistent:!u(s)},{default:l(()=>[a(z,{class:"ma-auto w-100","max-width":"400","prepend-icon":"mdi-settings"},{default:l(()=>[a(K,null,{default:l(()=>e[10]||(e[10]=[w("Edit A#")])),_:1}),a(q,null,{default:l(()=>e[11]||(e[11]=[w("Set your A# to track tasks")])),_:1}),a(he,null,{default:l(()=>[a(te,{id:"anum",ref:"anum","prepend-icon":u(h),modelValue:u(s),"onUpdate:modelValue":e[0]||(e[0]=o=>S(s)?s.value=o:null),onInput:H,onKeyup:Be(W,["enter"]),hint:"Enter the A# from your student ID",label:"A#"},null,8,["prepend-icon","modelValue"])]),_:1}),a(G,null,{default:l(()=>[u(s)?(b(),O(C,{key:0,class:"ms-auto",text:"Close",onClick:e[1]||(e[1]=o=>g.value=!1)})):je("",!0),a(le),a(C,{class:"ms-auto",text:"Save",onClick:W})]),_:1})]),_:1})]),_:1},8,["modelValue","persistent"]),a(oe,{modelValue:u(p),"onUpdate:modelValue":e[4]||(e[4]=o=>S(p)?p.value=o:null)},{default:l(()=>[a(z,{class:"ma-auto w-100","max-width":"400","prepend-icon":"mdi-settings"},{default:l(()=>[a(K,null,{default:l(()=>e[12]||(e[12]=[w("Punch Out All Active Workers?")])),_:1}),a(q,null,{default:l(()=>e[13]||(e[13]=[w("Are you Sure?")])),_:1}),a(G,null,{default:l(()=>[a(C,{class:"ms-auto",text:"Cancel",onClick:e[3]||(e[3]=o=>p.value=!1)}),a(le),a(C,{class:"ms-auto",text:"Confirm",onClick:ue})]),_:1})]),_:1})]),_:1},8,["modelValue"]),a(Q,{id:"filters",class:"align-self-start d-flex w-100 flex-grow-0"},{default:l(()=>[a(A,{cols:"9",sm:"4",md:"7"},{default:l(()=>[a(te,{id:"search",modelValue:u(x),"onUpdate:modelValue":e[5]||(e[5]=o=>S(x)?x.value=o:null),clearable:"",label:"Search",hint:"Search for tasks by name or description"},null,8,["modelValue"])]),_:1}),a(A,{cols:"3",class:"mt-2 d-flex d-sm-none"},{default:l(()=>[a(C,{variant:"tonal"},{default:l(()=>[a(ae,null,{default:l(()=>e[14]||(e[14]=[w("mdi-cog")])),_:1}),a(X,{activator:"parent"},{default:l(()=>[a(Y,null,{default:l(()=>[(b(!0),P(L,null,_(u(M),o=>(b(),O(Z,{title:o.title,onClick:o.action},null,8,["title","onClick"]))),256))]),_:1})]),_:1})]),_:1})]),_:1}),a(A,{cols:"6",sm:"3",md:"2"},{default:l(()=>[a(be,{clearable:"",chips:"",multiple:"",label:"Tags",modelValue:u(V),"onUpdate:modelValue":e[6]||(e[6]=o=>S(V)?V.value=o:null),items:u(ce)},null,8,["modelValue","items"])]),_:1}),a(A,{cols:"6",sm:"3",md:"2",class:"d-flex align-self-start"},{default:l(()=>[a(we,{label:"Show All",inset:"",color:"secondary",modelValue:u(c),"onUpdate:modelValue":e[7]||(e[7]=o=>S(c)?c.value=o:null)},null,8,["modelValue"])]),_:1}),a(A,{cols:"1",class:"mt-2 d-none d-sm-flex"},{default:l(()=>[a(C,{variant:"tonal"},{default:l(()=>[a(ae,null,{default:l(()=>e[15]||(e[15]=[w("mdi-cog")])),_:1}),a(X,{activator:"parent"},{default:l(()=>[a(Y,null,{default:l(()=>[(b(!0),P(L,null,_(u(M),o=>(b(),O(Z,{title:o.title,onClick:o.action},null,8,["title","onClick"]))),256))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),a(Q,{id:"main-content",align:"center",justify:"center",class:"d-flex flex-row w-100"},{default:l(()=>[(b(!0),P(L,null,_(u(de),o=>(b(),O(n,{task:o,anumber:u(s),working:u(I)[o.ID],selected:u(d)==o.ID,onSelect:R},null,8,["task","anumber","working","selected"]))),256)),a(A,{cols:"12"},{default:l(()=>[a(C,{class:Fe(["bigbutton",{selected:u(d)==0}]),variant:"tonal",onClick:e[8]||(e[8]=o=>R(0))},{default:l(()=>e[16]||(e[16]=[w(" Not Tracking Time ")])),_:1},8,["class"])]),_:1})]),_:1})]),_:1}),a(ye,{modelValue:u(f),"onUpdate:modelValue":e[9]||(e[9]=o=>S(f)?f.value=o:null),timeout:"2000",location:"top",color:u(y)},{default:l(()=>[w(_e(u(m)),1)]),_:1},8,["modelValue","color"])],64)}}});export{Qe as default};
